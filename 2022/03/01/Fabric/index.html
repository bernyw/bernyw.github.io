<!DOCTYPE html>
<html lang="zh-cn">
    <!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>Fabric - Berny&#39;s blog</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
<link rel="stylesheet" href="/css/waline.css">

  
  
  
<link rel="stylesheet" href="/css/post.css">

  

  
    
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
 
  

  
<meta name="generator" content="Hexo 5.4.0"></head>
    <body data-color-scheme="auto">
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">主页</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/projects">Projects</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/bernyw" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="https://codepen.io/bernyw" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="https://www.zhihu.com/people/ber-16-41" target="_blank">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="https://noc.social/@bernyw" target="_blank">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        <article class="post">
    <div class="meta">
        
        <div class="date" id="date">
            
            
            
            <span>March</span>
            
            
            
            
            
            
            
            
            
            
            <span>1,</span>
            <span>2022</span>
        </div>
        

        <h2 class="title">Fabric</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol>
<li><strong>检查操作系统</strong></li>
<li><strong>检查并安装所需工具</strong></li>
<li><strong>可选安装Node及npm</strong></li>
</ol>
<h2 id="任务实现"><a href="#任务实现" class="headerlink" title="任务实现"></a>任务实现</h2><h3 id="1-操作系统"><a href="#1-操作系统" class="headerlink" title="1. 操作系统"></a>1. 操作系统</h3><blockquote>
<p>学习，必须要有一个好的场地，我们耗费精力给你挑选好了一个安全又方便的场地。但是该场地有一些硬性条件，请一定要注意。</p>
</blockquote>
<p>推荐使用的操作系统为64位的 <strong>Ubuntu 16.04 LTS</strong>，系统内核为 GNU/Linux 4.13.0-36-generic x86_64。</p>
<p>硬件资源要求：内存最低为2GB，最好3G以上； 磁盘空间为30GB或更高。</p>
<p>如果计算机默认为Windows操作系统， 可以在Windows系统中安装一个VMware虚拟机应用程序， 然后在VMWare虚拟机中安装Ubuntu 16.04系统， 最后在Window操作系统中再安装一个远程连接工具（如XShell或SecureCRT），以方便连接并操作Ubuntu系统。</p>
<blockquote>
<p>如果你使用的是Mac本本，同样建议安装使用虚拟机的方式来学习。</p>
</blockquote>
<h3 id="2-安装所需工具"><a href="#2-安装所需工具" class="headerlink" title="2. 安装所需工具"></a>2. 安装所需工具</h3><blockquote>
<p>选好学习场地之后，挑选一些趁手的武器放在场地中，将来就不会再去费尽心血去考虑什么情况下使用什么武器解决的事情了。</p>
</blockquote>
<h4 id="2-1-安装git"><a href="#2-1-安装git" class="headerlink" title="2.1 安装git"></a>2.1 安装git</h4><p>首先，我们来安装git工具，git是一个非常优秀的免费、开源的版本管理控制工具， 我们可以使用git工具方便地下载官方（Golang、Hyperledger Fabric等等）在Github网站上发布的相关源代码或其它内容。</p>
<p>安装git工具使用如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install git</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>MAC OS系统中默认已安装。如未安装，可以在git官方网站：<a target="_blank" rel="noopener" href="https://git-scm.com/downloads">https://git-scm.com/downloads</a> 页面中选择相应系统的安装包下载并安装</p>
</blockquote>
<h4 id="2-2-安装cURL"><a href="#2-2-安装cURL" class="headerlink" title="2.2 安装cURL"></a>2.2 安装cURL</h4><p>使用如下命令安装cURL:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install curl</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>各系统的cURL安装包可以在 <a target="_blank" rel="noopener" href="https://curl.haxx.se/download.html">https://curl.haxx.se/download.html</a> 页面中选择下载并安装</p>
</blockquote>
<h4 id="2-3-安装Docker"><a href="#2-3-安装Docker" class="headerlink" title="2.3 安装Docker"></a>2.3 安装Docker</h4><blockquote>
<p>欲练神功，挥刀自宫，噢，停下停下，说错了。要学的这门神功，必须先有一副金刚不坏之躯，而不是自残，所以先服下这颗神丹。达到金刚不坏、万毒不侵之躯。</p>
</blockquote>
<p>查看系统中是否已经安装Docker：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker --version</span></span><br></pre></td></tr></table></figure>

<p>使用如下命令安装Docker的最新版本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install docker.io</span></span><br></pre></td></tr></table></figure>

<p><strong>查看Docker版本信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker --version</span></span><br></pre></td></tr></table></figure>

<p>输出: <code>Docker version 20.10.12, build e91ed57</code></p>
<h4 id="2-4-安装Docker-compose"><a href="#2-4-安装Docker-compose" class="headerlink" title="2.4 安装Docker-compose"></a>2.4 安装Docker-compose</h4><p>确定系统中是否已安装docker－compose工具</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-compose --version</span></span><br></pre></td></tr></table></figure>

<p>如系统提示未安装，则使用如下命令安装docker-compose工具：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt install docker-compose</span></span><br></pre></td></tr></table></figure>

<p>安装成功后，查看Docker－Compose版本信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker-compose --version</span></span><br></pre></td></tr></table></figure>

<p>输出: <code>docker-compose version 1.29.2, build 5becea4c</code></p>
<h4 id="2-5-安装Golang"><a href="#2-5-安装Golang" class="headerlink" title="2.5 安装Golang"></a>2.5 安装Golang</h4><blockquote>
<p>Fabric1.0.0版本要求Go语言1.7以上版本，Fabric1.1.0版本要求Go1.9以上版本，Fabric1.2.0版本要求Go1.10以上版本， 我们使用Fabric1.2.0版本， 所以从官方下载最新版本的Golang。</p>
</blockquote>
<h5 id="2-5-1-下载Golang"><a href="#2-5-1-下载Golang" class="headerlink" title="2.5.1 下载Golang"></a>2.5.1 下载Golang</h5><p>使用wget工具下载Golang的最新版本压缩包文件 go1.17.5.linux-amd64.tar.gz</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget https://dl.google.com/go/go1.17.5.linux-amd64.tar.gz</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>下载Golang压缩包文件，需要操作系统能够保证正常访问Golang官方网站</strong>。</p>
<p>下载过程可能耗时较长（取决于具体网络情况），请耐心等待。</p>
<p>其它系统可以在Golang官方： <a target="_blank" rel="noopener" href="https://golang.org/dl/">https://golang.org/dl/</a> 下载页面中查找相应的安装包下载安装。</p>
</blockquote>
<p>下载完成后，文件会保存在当前目录下。可以使用 <code>ll</code> 命令查看</p>
<p><img src="http://image.chaindesk.cn/1.1.jpg/mark" alt="Golang下载文件"></p>
<h5 id="2-5-2-解压文件"><a href="#2-5-2-解压文件" class="headerlink" title="2.5.2 解压文件"></a>2.5.2 解压文件</h5><p>使用 tar 命令将下载后的压缩包文件解压到指定的 /usr/local/ 路径下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo tar -zxvf go1.17.5.linux-amd64.tar.gz -C /usr/<span class="built_in">local</span>/</span></span><br></pre></td></tr></table></figure>

<hr>
<p>如果在解压过程中出现如下错误：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gzip: stdin: unexpected end of file</span><br><span class="line">tar: Unexpected EOF in archive</span><br><span class="line">tar: Unexpected EOF in archive</span><br><span class="line">tar: Error is not recoverable: exiting now</span><br><span class="line">或</span><br><span class="line">gzip: stdin: unexpected end of file</span><br><span class="line">tar: 归档文件中异常的 EOF</span><br><span class="line">tar: 归档文件中异常的 EOF</span><br><span class="line">tar: Error is not recoverable: exiting now</span><br></pre></td></tr></table></figure>

<p>说明下载的tar压缩包文件有问题， 如没有下载完整或压缩包数据损坏。请删除后重新下载并解压至指定的目录中。</p>
<hr>
<h5 id="2-5-3-配置环境变量"><a href="#2-5-3-配置环境变量" class="headerlink" title="2.5.3 配置环境变量"></a>2.5.3 配置环境变量</h5><p>解压后，Golang可以让系统的所有用户正常使用， 所以我们使用 vim 文件编辑工具打开系统的 profile 文件进行编辑：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vim /etc/profile</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果只想让当前登录用户使用Golang， 其它用户不能使用， 则编辑当前用户$HOME目录下的 .bashrc 或 .profile 文件， 在该文件中添加相应的环境变量即可。</p>
</blockquote>
<p>在profile文件最后添加如下内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export GOPATH=$HOME/go</span><br><span class="line">export GOROOT=/usr/local/go</span><br><span class="line">export PATH=$GOROOT/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>使用 source 命令，使刚刚添加的配置信息生效：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /etc/profile</span></span><br></pre></td></tr></table></figure>

<p>通过 go version命令验证是否成功：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go version</span></span><br></pre></td></tr></table></figure>

<p>输出: <code>go version go1.17.5 linux/amd64</code></p>
<blockquote>
<p>如果系统中有旧版本的golang,则使用如下命令卸载旧版本的golang,然后再重新安装并配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> su -</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> apt-get remove golang-go --purge &amp;&amp; apt-get autoremove --purge &amp;&amp; apt-get clean</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="3-安装Node及npm"><a href="#3-安装Node及npm" class="headerlink" title="3. 安装Node及npm"></a>3. 安装Node及npm</h3><h4 id="3-1-安装nvm"><a href="#3-1-安装nvm" class="headerlink" title="3.1 安装nvm"></a>3.1 安装nvm</h4><p>nvm：Node Version Manager，Node.js的版本管理软件， 可以根据不同的需求场景方便地随时在Node.js的各个版本之间进行切换。</p>
<p>由于Node.js版本更新较快，且各版本之间差异较大；直接从Node官网安装可能需要很长时间，而且中间可能会因为网络访问及数据传输原因造成下载中断或失败等问题。为了方便安装及后期管理Node.js的版本，我们首先需要在系统中安装nvm管理工具。</p>
<p>使用如下命令安装nvm：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.10/install.sh | bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> NVM_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/.nvm&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> [ -s <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span> ] &amp;&amp; \. <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-安装Node"><a href="#3-2-安装Node" class="headerlink" title="3.2 安装Node"></a>3.2 安装Node</h4><p>nvm工具安装并配置成功后， 可以直接使用nvm命令安装Node；且Node安装成功后，nvm会自动将npm工具进行安装。</p>
<p>使用如下命令安装Node：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nvm install v8.11.1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装Node时须注意：安装版本为8.9.x或以上的Node.js，<strong>Fabric目前不支持9.x系列的Node.js版本.</strong></p>
</blockquote>
<p>安装成功输出如下内容：</p>
<p><img src="http://image.chaindesk.cn/1.2.jpg/mark" alt="Node安装成功"></p>
<h4 id="3-3-检查Node及npm版本"><a href="#3-3-检查Node及npm版本" class="headerlink" title="3.3 检查Node及npm版本"></a>3.3 检查Node及npm版本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node -v &amp;&amp; npm -v</span></span><br></pre></td></tr></table></figure>

<p>输出内容如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v8.11.1</span><br><span class="line">5.6.0</span><br></pre></td></tr></table></figure>

<h1 id="二、安装Fabric"><a href="#二、安装Fabric" class="headerlink" title="二、安装Fabric"></a>二、安装Fabric</h1><h2 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h2><ol>
<li><strong>安装Fabric</strong></li>
<li><strong>明确bootstrap.sh脚本做了哪些事</strong></li>
<li><strong>安装Fabric-ca</strong></li>
</ol>
<h2 id="任务实现-1"><a href="#任务实现-1" class="headerlink" title="任务实现"></a>任务实现</h2><h3 id="1-源码安装"><a href="#1-源码安装" class="headerlink" title="1. 源码安装"></a>1. 源码安装</h3><h4 id="1-1-安装fabric源码"><a href="#1-1-安装fabric源码" class="headerlink" title="1.1 安装fabric源码"></a>1.1 安装fabric源码</h4><p>以release-2.2分支为例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $GOPATH/src/github.com/hyperledger</span><br><span class="line">cd $GOPATH/src/github.com/hyperledger</span><br><span class="line">git clone -b release-2.2 https://github.com/hyperledger/fabric.git</span><br></pre></td></tr></table></figure>

<h4 id="1-2-读懂Makefile"><a href="#1-2-读懂Makefile" class="headerlink" title="1.2 读懂Makefile"></a>1.2 读懂Makefile</h4><h5 id="1-2-1-找到Makefile"><a href="#1-2-1-找到Makefile" class="headerlink" title="1.2.1 找到Makefile"></a>1.2.1 找到Makefile</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric</span><br><span class="line">vim Makefile</span><br></pre></td></tr></table></figure>

<h5 id="1-2-2-Makefile基本语法"><a href="#1-2-2-Makefile基本语法" class="headerlink" title="1.2.2 Makefile基本语法"></a>1.2.2 Makefile基本语法</h5><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PROJECT=<span class="string">&quot;example&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">default:</span></span><br><span class="line">    echo $&#123;PROJECT&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">install:</span></span><br><span class="line">    @govendor sync -v</span><br><span class="line">    </span><br><span class="line"><span class="section">test: install</span></span><br><span class="line">    @go test ./...</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: default install test</span></span><br></pre></td></tr></table></figure>

<p>上文是一个非常简单的 Makefile 文件，通过这些命令的编写，直接执行 <code>make</code> , <code>make install</code>, <code>make test</code> 等就能完成对应的命令。</p>
<p><strong>格式介绍：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span>&gt;</span> : <span class="tag">&lt;<span class="name">prerequisites</span>&gt;</span> </span><br><span class="line">[tab]  <span class="tag">&lt;<span class="name">commands</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<ul>
<li>target : 即自定义的想要执行的命令</li>
<li>prerequisites: 前置条件，即执行 target 命令之前执行的命令</li>
<li>commands : 具体的执行的命令</li>
<li>.PHONY 伪指令，内置的关键字</li>
<li>不带参数，默认执行第一个 target</li>
<li>@ 表示禁止回声，即终端不会打印真实的执行命令</li>
<li><code>#</code> 表示注释</li>
<li>${val} 表示变量，和 shell 脚本中的变量的声明和使用一致</li>
<li>允许使用 通配符</li>
</ul>
<blockquote>
<p>makefile语法问题汇总：<a target="_blank" rel="noopener" href="https://blog.csdn.net/LWD_D/article/details/119948945">https://blog.csdn.net/LWD_D/article/details/119948945</a></p>
</blockquote>
<h5 id="1-2-3-Makefile功能总结"><a href="#1-2-3-Makefile功能总结" class="headerlink" title="1.2.3 Makefile功能总结"></a>1.2.3 Makefile功能总结</h5><blockquote>
<p>根据源代码：编译，构建项目</p>
</blockquote>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   - all (default) - builds all targets and runs all non-integration tests/checks</span></span><br><span class="line"><span class="comment">#   - basic-checks - performs basic checks like license, spelling, trailing spaces and linter</span></span><br><span class="line"><span class="comment">#   - check-deps - check for vendored dependencies that are no longer used</span></span><br><span class="line"><span class="comment">#   - checks - runs all non-integration tests/checks</span></span><br><span class="line"><span class="comment">#   - clean-all - superset of &#x27;clean&#x27; that also removes persistent state</span></span><br><span class="line"><span class="comment">#   - clean - cleans the build area</span></span><br><span class="line"><span class="comment">#   - configtxgen - builds a native configtxgen binary</span></span><br><span class="line"><span class="comment">#   - configtxlator - builds a native configtxlator binary</span></span><br><span class="line"><span class="comment">#   - cryptogen - builds a native cryptogen binary</span></span><br><span class="line"><span class="comment">#   - desk-check - runs linters and verify to test changed packages</span></span><br><span class="line"><span class="comment">#   - dist-clean - clean release packages for all target platforms</span></span><br><span class="line"><span class="comment">#   - docker[-clean] - ensures all docker images are available[/cleaned]</span></span><br><span class="line"><span class="comment">#   - docker-list - generates a list of docker images that &#x27;make docker&#x27; produces</span></span><br><span class="line"><span class="comment">#   - docker-tag-latest - re-tags the images made by &#x27;make docker&#x27; with the :latest tag</span></span><br><span class="line"><span class="comment">#   - docker-tag-stable - re-tags the images made by &#x27;make docker&#x27; with the :stable tag</span></span><br><span class="line"><span class="comment">#   - docker-thirdparty - pulls thirdparty images (kafka,zookeeper,couchdb)</span></span><br><span class="line"><span class="comment">#   - gotools - installs go tools like golint</span></span><br><span class="line"><span class="comment">#   - help-docs - generate the command reference docs </span></span><br><span class="line"><span class="comment">#   - idemixgen - builds a native idemixgen binary</span></span><br><span class="line"><span class="comment">#   - integration-test-prereqs - setup prerequisites for integration tests</span></span><br><span class="line"><span class="comment">#   - integration-test - runs the integration tests</span></span><br><span class="line"><span class="comment">#   - license - checks go source files for Apache license header</span></span><br><span class="line"><span class="comment">#   - linter - runs all code checks</span></span><br><span class="line"><span class="comment">#   - native - ensures all native binaries are available</span></span><br><span class="line"><span class="comment">#   - orderer - builds a native fabric orderer binary</span></span><br><span class="line"><span class="comment">#   - orderer-docker[-clean] - ensures the orderer container is available[/cleaned]</span></span><br><span class="line"><span class="comment">#   - peer - builds a native fabric peer binary</span></span><br><span class="line"><span class="comment">#   - peer-docker[-clean] - ensures the peer container is available[/cleaned]</span></span><br><span class="line"><span class="comment">#   - profile - runs unit tests for all packages in coverprofile mode (slow)</span></span><br><span class="line"><span class="comment">#   - protos - generate all protobuf artifacts based on .proto files</span></span><br><span class="line"><span class="comment">#   - publish-images - publishes release docker images to nexus3 or docker hub.</span></span><br><span class="line"><span class="comment">#   - release-all - builds release packages for all target platforms</span></span><br><span class="line"><span class="comment">#   - release - builds release packages for the host platform</span></span><br><span class="line"><span class="comment">#   - tools-docker[-clean] - ensures the tools container is available[/cleaned]</span></span><br><span class="line"><span class="comment">#   - unit-test-clean - cleans unit test state (particularly from docker)</span></span><br><span class="line"><span class="comment">#   - unit-test - runs the go-test based unit tests</span></span><br><span class="line"><span class="comment">#   - verify - runs unit tests for only the changed package tree</span></span><br></pre></td></tr></table></figure>

<h5 id="1-2-4-Makefile详解"><a href="#1-2-4-Makefile详解" class="headerlink" title="1.2.4 Makefile详解"></a>1.2.4 Makefile详解</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. Building build/bin/orderer</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. Building build/bin/configtxgen</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. Building build/bin/configtxlator</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. Building build/bin/cryptogen</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. Building build/bin/discover</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. Building build/bin/idemixgen</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 7. Building build/bin/peer</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 8. Building Docker image hyperledger/fabric-baseos</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 9. Building Docker image hyperledger/fabric-ccenv</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 10.Building Docker image hyperledger/fabric-orderer</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 11.Building Docker image hyperledger/fabric-peer</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 12.Building Docker image hyperledger/fabric-tools</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-读懂bootstrap-sh"><a href="#1-3-读懂bootstrap-sh" class="headerlink" title="1.3 读懂bootstrap.sh"></a>1.3 读懂bootstrap.sh</h4><h5 id="1-3-1-找到bootstrap-sh"><a href="#1-3-1-找到bootstrap-sh" class="headerlink" title="1.3.1 找到bootstrap.sh"></a>1.3.1 找到bootstrap.sh</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $GOPATH/src/github.com/hyperledger/fabric/scripts</span><br><span class="line">vim bootstrap.sh</span><br></pre></td></tr></table></figure>

<h5 id="1-3-2-bootstrap-sh总结"><a href="#1-3-2-bootstrap-sh总结" class="headerlink" title="1.3.2 bootstrap.sh总结"></a>1.3.2 bootstrap.sh总结</h5><blockquote>
<p>引导脚本</p>
</blockquote>
<ol>
<li><p>cloneSamplesRepo()：从github上克隆 hyperledger/fabric-samples并进入该目录，然后检出适当的版本</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b master https://github.com/hyperledger/fabric-samples.git &amp;&amp; cd fabric-samples &amp;&amp; git checkout v$&#123;VERSION&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>pullBinaries()：在fabric-samples目录下安装特定平台的 Hyperledger Fabric 二进制可执行文件 和配置文件</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">download &quot;$&#123;BINARY_FILE&#125;&quot; &quot;https://github.com/hyperledger/fabric/releases/download/v$&#123;VERSION&#125;/$&#123;BINARY_FILE&#125;&quot;</span><br><span class="line">download &quot;$&#123;CA_BINARY_FILE&#125;&quot; &quot;https://github.com/hyperledger/fabric-ca/releases/download/v$&#123;CA_VERSION&#125;/$&#123;CA_BINARY_FILE&#125;&quot;</span><br><span class="line"></span><br><span class="line">download()</span><br><span class="line">curl -L --retry 5 --retry-delay 3 &quot;$&#123;URL&#125;&quot; | tar xz || rc=$?</span><br></pre></td></tr></table></figure></li>
<li><p>pullDockerImages：下载 指定版本的Hyperledger Fabric 的docker镜像</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">       ```</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">if [ &quot;$SAMPLES&quot; == &quot;true&quot; ]; then</span><br><span class="line">    echo</span><br><span class="line">    echo &quot;Clone hyperledger/fabric-samples repo&quot;</span><br><span class="line">    echo</span><br><span class="line">    cloneSamplesRepo</span><br><span class="line">fi</span><br><span class="line">if [ &quot;$BINARIES&quot; == &quot;true&quot; ]; then</span><br><span class="line">    echo</span><br><span class="line">    echo &quot;Pull Hyperledger Fabric binaries&quot;</span><br><span class="line">    echo</span><br><span class="line">    pullBinaries</span><br><span class="line">fi</span><br><span class="line">if [ &quot;$DOCKER&quot; == &quot;true&quot; ]; then</span><br><span class="line">    echo</span><br><span class="line">    echo &quot;Pull Hyperledger Fabric docker images&quot;</span><br><span class="line">    echo</span><br><span class="line">    pullDockerImages</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></li>
</ol>
<p>其中cloneSamplesRepo对应的是克隆fabric-samples，pullBinaries对应的是安装二进制文件，pullDockerImages对应的是下载docker镜像。</p>
<p>可参考旧版本<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/aa7b20f2bb76">https://www.jianshu.com/p/aa7b20f2bb76</a></p>
<h4 id="1-4-下载fabric-ca源码："><a href="#1-4-下载fabric-ca源码：" class="headerlink" title="1.4 下载fabric-ca源码："></a>1.4 下载fabric-ca源码：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $GOPATH/src/github.com/hyperledger</span><br><span class="line">git clone https://github.com/hyperledger/fabric-ca.git</span><br></pre></td></tr></table></figure>

<h3 id="2-编译源码"><a href="#2-编译源码" class="headerlink" title="2. 编译源码"></a>2. 编译源码</h3><h4 id="2-1-编译fabric源码"><a href="#2-1-编译fabric源码" class="headerlink" title="2.1 编译fabric源码"></a>2.1 编译fabric源码</h4><p>编译之前请确保系统中已经安装了Go语言运行环境和正确的配置了环境变量。然后执行make release编译。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@iZbp1b1jw4l12jaocmialxZ:~/go/src# cd github.com/hyperledger/fabric/</span><br><span class="line">root@iZbp1b1jw4l12jaocmialxZ:~/go/src/github.com/hyperledger/fabric# make release</span><br><span class="line">Building release/linux-amd64/bin/orderer for linux-amd64</span><br><span class="line">mkdir -p release/linux-amd64/bin</span><br><span class="line">GOOS=linux GOARCH=amd64 go build -o release/linux-amd64/bin/orderer -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/orderer</span><br><span class="line">Building release/linux-amd64/bin/configtxgen for linux-amd64</span><br><span class="line">mkdir -p release/linux-amd64/bin</span><br><span class="line">GOOS=linux GOARCH=amd64 go build -o release/linux-amd64/bin/configtxgen -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/configtxgen</span><br><span class="line">Building release/linux-amd64/bin/configtxlator for linux-amd64</span><br><span class="line">mkdir -p release/linux-amd64/bin</span><br><span class="line">GOOS=linux GOARCH=amd64 go build -o release/linux-amd64/bin/configtxlator -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/configtxlator</span><br><span class="line">Building release/linux-amd64/bin/cryptogen for linux-amd64</span><br><span class="line">mkdir -p release/linux-amd64/bin</span><br><span class="line">GOOS=linux GOARCH=amd64 go build -o release/linux-amd64/bin/cryptogen -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/cryptogen</span><br><span class="line">Building release/linux-amd64/bin/discover for linux-amd64</span><br><span class="line">mkdir -p release/linux-amd64/bin</span><br><span class="line">GOOS=linux GOARCH=amd64 go build -o release/linux-amd64/bin/discover -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/discover</span><br><span class="line">Building release/linux-amd64/bin/idemixgen for linux-amd64</span><br><span class="line">mkdir -p release/linux-amd64/bin</span><br><span class="line">GOOS=linux GOARCH=amd64 go build -o release/linux-amd64/bin/idemixgen -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/idemixgen</span><br><span class="line">Building release/linux-amd64/bin/peer for linux-amd64</span><br><span class="line">mkdir -p release/linux-amd64/bin</span><br><span class="line">GOOS=linux GOARCH=amd64 go build -o release/linux-amd64/bin/peer -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/peer</span><br></pre></td></tr></table></figure>

<p>查看是否编译成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/hyperledger/fabric/release/linux-amd64/bin/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">configtxgen  configtxlator  cryptogen  discover  idemixgen  orderer  peer</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>peer</td>
<td>负责启动节点，存储区块链数据，运行维护链码</td>
</tr>
<tr>
<td>order</td>
<td>负责启动排序节点，对交易进行排序，并将排序好的交易打包成模块</td>
</tr>
<tr>
<td>cryptogen</td>
<td>生成组织结构及相应的的身份文件的工具</td>
</tr>
<tr>
<td>configtxgen</td>
<td>生成初始区块及通道交易配置文件的工具</td>
</tr>
<tr>
<td>configtxlator</td>
<td>解读配置信息，将指定的文件在二进制格式与JSON格式之间进行转换</td>
</tr>
<tr>
<td>fabric-ca-client</td>
<td>fabric-ca客户端命令</td>
</tr>
<tr>
<td>discover</td>
<td>fabric发现服务的客户端命令</td>
</tr>
<tr>
<td>idemixgen</td>
<td>身份混合机制</td>
</tr>
</tbody></table>
<h4 id="2-2-编译fabric-ca源码"><a href="#2-2-编译fabric-ca源码" class="headerlink" title="2.2 编译fabric-ca源码"></a>2.2 编译fabric-ca源码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fabric-ca</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make fabric-ca-server</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make fabric-ca-client</span></span><br><span class="line"></span><br><span class="line">docker build  -f images/fabric-ca/Dockerfile \</span><br><span class="line">	--build-arg GO_VER=1.16.7 \</span><br><span class="line">	--build-arg GO_TAGS=pkcs11 \</span><br><span class="line">	--build-arg GO_LDFLAGS=&quot;-X github.com/hyperledger/fabric-ca/lib/metadata.Version=1.5.3-snapshot-fc42d91b -linkmode external -extldflags &#x27;-lpthread&#x27;&quot; \</span><br><span class="line">	--build-arg ALPINE_VER=3.14 \</span><br><span class="line">	-t hyperledger/fabric-ca .</span><br><span class="line">docker tag hyperledger/fabric-ca hyperledger/fabric-ca:1.5.3</span><br><span class="line">docker tag hyperledger/fabric-ca hyperledger/fabric-ca:amd64-1.5.3-snapshot-fc42d91b</span><br></pre></td></tr></table></figure>

<p>查看是否编译成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> bin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -l</span></span><br><span class="line">total 59588</span><br><span class="line">-rwxr-xr-x 1 root root 28775152 Feb  8 12:27 fabric-ca-client</span><br><span class="line">-rwxr-xr-x 1 root root 32237464 Feb  8 12:26 fabric-ca-server</span><br></pre></td></tr></table></figure>

<h4 id="2-3-生成Docker镜像"><a href="#2-3-生成Docker镜像" class="headerlink" title="2.3 生成Docker镜像"></a>2.3 生成Docker镜像</h4><p>利用Makefile</p>
<p>当前在fabric目录<br>打开控制台进入fabric目录，执行以下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make all</span><br></pre></td></tr></table></figure>

<p>中间可能提示没有安装gcc，此时只需要安装即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br></pre></td></tr></table></figure>

<h1 id="三、动手实践"><a href="#三、动手实践" class="headerlink" title="三、动手实践"></a>三、动手实践</h1><h2 id="问题探究"><a href="#问题探究" class="headerlink" title="问题探究"></a>问题探究</h2><p>参考fabric-samples/test-network（<strong>release-2.2</strong>分支）搞懂以下问题：</p>
<ul>
<li>编译源码</li>
<li><code>test-network</code>区块链网络全过程</li>
<li>理解<code>锚节点</code></li>
<li>CA证书全过程全种类</li>
<li>理解重要yaml文件</li>
<li>启动节点和DockerCompose文件</li>
<li>组织到联盟/通道的<code>动态添加</code></li>
</ul>
<h2 id="任务实现-2"><a href="#任务实现-2" class="headerlink" title="任务实现"></a>任务实现</h2><h3 id="1-编译源码"><a href="#1-编译源码" class="headerlink" title="1. 编译源码"></a>1. 编译源码</h3><blockquote>
<p>通过fabric和fabric-ca的源代码编译出相应的docker镜像和二进制命令</p>
</blockquote>
<h4 id="1-1-编译Docker-images"><a href="#1-1-编译Docker-images" class="headerlink" title="1.1 编译Docker images"></a>1.1 编译Docker images</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker build --force-rm  -f images/baseos/Dockerfile \</span><br><span class="line">	--build-arg GO_VER=1.17.5 \</span><br><span class="line">	--build-arg ALPINE_VER=3.14 \</span><br><span class="line">	 \</span><br><span class="line">	-t hyperledger/fabric-baseos ./images/baseos</span><br><span class="line">	</span><br><span class="line">docker tag hyperledger/fabric-baseos hyperledger/fabric-baseos:2.2.5</span><br><span class="line">docker tag hyperledger/fabric-baseos hyperledger/fabric-baseos:2.2</span><br><span class="line">docker tag hyperledger/fabric-baseos hyperledger/fabric-baseos:amd64-2.2.5-snapshot-68b6b90fe</span><br></pre></td></tr></table></figure>

<ul>
<li>-f Name of the Dockerfile (Default is ‘PATH/Dockerfile’)</li>
<li>–force-rm Always remove intermediate containers</li>
<li>–build-arg 设置构建时变量</li>
<li>-t 可选的’ Name:tag’格式的标签</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">cd fabric</span><br><span class="line">	docker build --force-rm  -f images/ccenv/Dockerfile \</span><br><span class="line">	--build-arg GO_VER=1.17.5 \</span><br><span class="line">	--build-arg ALPINE_VER=3.14 \</span><br><span class="line">	 \</span><br><span class="line">	-t hyperledger/fabric-ccenv ./images/ccenv</span><br><span class="line">docker tag hyperledger/fabric-ccenv hyperledger/fabric-ccenv:2.2.5</span><br><span class="line">docker tag hyperledger/fabric-ccenv hyperledger/fabric-ccenv:2.2</span><br><span class="line">docker tag hyperledger/fabric-ccenv hyperledger/fabric-ccenv:amd64-2.2.5-snapshot-68b6b90fe</span><br><span class="line">	</span><br><span class="line">	docker build --force-rm  -f images/orderer/Dockerfile \</span><br><span class="line">	--build-arg GO_VER=1.17.5 \</span><br><span class="line">	--build-arg ALPINE_VER=3.14 \</span><br><span class="line">	--build-arg GO_TAGS= \</span><br><span class="line">	-t hyperledger/fabric-orderer ./</span><br><span class="line">docker tag hyperledger/fabric-orderer hyperledger/fabric-orderer:2.2.5</span><br><span class="line">docker tag hyperledger/fabric-orderer hyperledger/fabric-orderer:2.2</span><br><span class="line">docker tag hyperledger/fabric-orderer hyperledger/fabric-orderer:amd64-2.2.5-snapshot-68b6b90fe</span><br><span class="line">	</span><br><span class="line">	docker build --force-rm  -f images/peer/Dockerfile \</span><br><span class="line">	--build-arg GO_VER=1.17.5 \</span><br><span class="line">	--build-arg ALPINE_VER=3.14 \</span><br><span class="line">	--build-arg GO_TAGS= \</span><br><span class="line">	-t hyperledger/fabric-peer ./</span><br><span class="line">docker tag hyperledger/fabric-peer hyperledger/fabric-peer:2.2.5</span><br><span class="line">docker tag hyperledger/fabric-peer hyperledger/fabric-peer:2.2</span><br><span class="line">docker tag hyperledger/fabric-peer hyperledger/fabric-peer:amd64-2.2.5-snapshot-68b6b90fe</span><br><span class="line"></span><br><span class="line">	docker build --force-rm  -f images/tools/Dockerfile \</span><br><span class="line">	--build-arg GO_VER=1.17.5 \</span><br><span class="line">	--build-arg ALPINE_VER=3.14 \</span><br><span class="line">	--build-arg GO_TAGS= \</span><br><span class="line">	-t hyperledger/fabric-tools ./</span><br><span class="line">docker tag hyperledger/fabric-tools hyperledger/fabric-tools:2.2.5</span><br><span class="line">docker tag hyperledger/fabric-tools hyperledger/fabric-tools:2.2</span><br><span class="line">docker tag hyperledger/fabric-tools hyperledger/fabric-tools:amd64-2.2.5-snapshot-68b6b90fe</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">cd fabric-ca</span><br><span class="line">	docker build  -f images/fabric-ca/Dockerfile \</span><br><span class="line">	--build-arg GO_VER=1.16.7 \</span><br><span class="line">	--build-arg GO_TAGS=pkcs11 \</span><br><span class="line">	--build-arg GO_LDFLAGS=&quot;-X github.com/hyperledger/fabric-ca/lib/metadata.Version=1.5.3-snapshot-fc42d91b -linkmode external -extldflags &#x27;-lpthread&#x27;&quot; \</span><br><span class="line">	--build-arg ALPINE_VER=3.14 \</span><br><span class="line">	-t hyperledger/fabric-ca .</span><br><span class="line">	docker tag hyperledger/fabric-ca hyperledger/fabric-ca:1.5.3</span><br><span class="line">	docker tag hyperledger/fabric-ca hyperledger/fabric-ca:amd64-1.5.3-snapshot-fc42d91b</span><br></pre></td></tr></table></figure>

<h4 id="1-2-编译可执行文件"><a href="#1-2-编译可执行文件" class="headerlink" title="1.2 编译可执行文件"></a>1.2 编译可执行文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">go install -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/orderer</span><br><span class="line">go install -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/configtxgen</span><br><span class="line">go install -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/configtxlator</span><br><span class="line">go install -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/cryptogen</span><br><span class="line">go install -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/discover</span><br><span class="line">go install -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/idemixgen</span><br><span class="line">go install -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/peer</span><br><span class="line"></span><br><span class="line">cd fabric-ca</span><br><span class="line">go install -tags &quot;$&#123;GO_TAGS&#125;&quot; -ldflags &quot;$&#123;GO_LDFLAGS&#125;&quot; 	github.com/hyperledger/fabric-ca/cmd/fabric-ca-server</span><br><span class="line">go install -tags &quot;$&#123;GO_TAGS&#125;&quot; -ldflags &quot;$&#123;GO_LDFLAGS&#125;&quot; 	github.com/hyperledger/fabric-ca/cmd/fabric-ca-client</span><br></pre></td></tr></table></figure>

<ul>
<li>此标记用于指定需要传递给<code>go tool link</code>命令的标记的列表</li>
<li>常用-X来指定版本号</li>
</ul>
<h3 id="2-test-network详解"><a href="#2-test-network详解" class="headerlink" title="2. test-network详解"></a>2. test-network详解</h3><blockquote>
<p>./network.sh</p>
</blockquote>
<ol>
<li><p>设置环境变量（bin二进制文件、configtx网络配置文件）</p>
</li>
<li><p>载入<code>. scripts/utils.sh</code>：帮助文档</p>
</li>
<li><p>为每个组织生成加密材料</p>
<ul>
<li><p>使用Cryptogen（默认）：使用每个组织organizations/cryptogen中的配置文件，快速生成加密材料</p>
</li>
<li><p>使用Fabric CAs：对生成的证书和密钥进行签名，为每个组织创建有效的信任根。</p>
<p>该脚本使用Docker Compose生成三个CA，每个对等组织和订购组织各一个。用于创建结构CA服务器的配置文件位于“organizations/Fabric CA”目录中。在同一个目录中，<code>registerEnroll.sh</code>脚本使用Fabric CA客户端在organizations/OrderOrganizations中创建测试网络所需的标识、证书和MSP文件夹</p>
</li>
</ul>
</li>
<li><p>创建应用程序通道的genesis块</p>
<ul>
<li>使用configtxgen：按照<code>configtx.yaml</code>进行网络的定义，上genesis块</li>
<li><code>configtx.yaml</code>：指向成员MSP；TwoOrgsApplicationGenesis配置application channel；通道MSP</li>
</ul>
</li>
<li><p>启动peers and ordering service</p>
<ul>
<li>默认使用docker/docker-compose-test-net.yaml</li>
</ul>
</li>
<li><p>调用脚本创建频道，加入org1和org2的peer，然后更新每个组织的锚节点</p>
</li>
<li><p>调用脚本将链码部署到通道</p>
</li>
<li><p>拆除正在运行的网络</p>
</li>
</ol>
<h4 id="2-1-编译源码"><a href="#2-1-编译源码" class="headerlink" title="2.1 编译源码"></a>2.1 编译源码</h4><p>要求：使用自己编译出来的镜像和命令，启动test-network</p>
<h5 id="2-1-1编译可执行文件和镜像"><a href="#2-1-1编译可执行文件和镜像" class="headerlink" title="2.1.1编译可执行文件和镜像"></a>2.1.1编译可执行文件和镜像</h5><h5 id="2-1-2-生成加密材料"><a href="#2-1-2-生成加密材料" class="headerlink" title="2.1.2 生成加密材料"></a>2.1.2 生成加密材料</h5><ol>
<li><p>健全性检查：fabric binaries/images(略)</p>
<ul>
<li><p>configtxgen，cryptogen等</p>
</li>
<li><p>hyperledger/fabric-ca</p>
<p>hyperledger/fabric-tools</p>
<p>hyperledger/fabric-orderer</p>
<p>hyperledger/fabric-peer</p>
</li>
</ul>
</li>
<li><p>基于configtx.yaml生成创世区块和通道相关信息</p>
</li>
<li><p>生成organizations/peerOrganizations目录，并执行createOrgs，在该目录下生成MSP</p>
<p>基于crypto-config-org1.yaml crypto-config-org2.yaml crypto-config-orderer.yaml</p>
<p>生成公私钥和证书信息，并保存在crypto-config文件夹中</p>
<blockquote>
<p>参考network.sh中的createOrgs()</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rm -Rf organizations/peerOrganizations &amp;&amp; rm -Rf organizations/ordererOrganizations</span><br><span class="line"><span class="meta">#</span><span class="bash"> Create crypto material using cryptogen</span></span><br><span class="line">which cryptogen</span><br><span class="line"><span class="meta">#</span><span class="bash"> Generating certificates using cryptogen tool</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Creating Org1 Identities</span></span><br><span class="line">set -x </span><br><span class="line">cryptogen generate --config=./organizations/cryptogen/crypto-config-org1.yaml --output=&quot;organizations&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Creating Org2 Identities</span></span><br><span class="line">cryptogen generate --config=./organizations/cryptogen/crypto-config-org2.yaml --output=&quot;organizations&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Creating Orderer Org Identities</span></span><br><span class="line">cryptogen generate --config=./organizations/cryptogen/crypto-config-orderer.yaml --output=&quot;organizations&quot;</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br></pre></td></tr></table></figure></li>
<li><p>生成CCP文件</p>
</li>
</ol>
<blockquote>
<p>参考./organizations/ccp-generate.sh</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Generating CCP files <span class="keyword">for</span> Org1 and Org2(connection-orgX.json;connection-org1.yaml)</span></span><br><span class="line">ORG=1</span><br><span class="line">P0PORT=7051</span><br><span class="line">CAPORT=7054</span><br><span class="line">PEERPEM=organizations/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem</span><br><span class="line">CAPEM=organizations/peerOrganizations/org1.example.com/ca/ca.org1.example.com-cert.pem</span><br><span class="line">PP=$(echo &quot;`awk &#x27;NF &#123;sub(/\\n/, &quot;&quot;); printf &quot;%s\\\\\\\n&quot;,$0;&#125;&#x27; $PEERPEM`&quot;)</span><br><span class="line">CP=$(echo &quot;`awk &#x27;NF &#123;sub(/\\n/, &quot;&quot;); printf &quot;%s\\\\\\\n&quot;,$0;&#125;&#x27; $CAPEM`&quot;)</span><br><span class="line">echo &quot;$(sed -e &quot;s/\$&#123;ORG&#125;/$ORG/&quot; \</span><br><span class="line">        -e &quot;s/\$&#123;P0PORT&#125;/$P0PORT/&quot; \</span><br><span class="line">        -e &quot;s/\$&#123;CAPORT&#125;/$CAPORT/&quot; \</span><br><span class="line">        -e &quot;s#\$&#123;PEERPEM&#125;#$PP#&quot; \</span><br><span class="line">        -e &quot;s#\$&#123;CAPEM&#125;#$CP#&quot; \</span><br><span class="line">        organizations/ccp-template.json)&quot; &gt; organizations/peerOrganizations/org1.example.com/connection-org1.json</span><br><span class="line">        </span><br><span class="line">echo &quot;$(sed -e &quot;s/\$&#123;ORG&#125;/$ORG/&quot; \</span><br><span class="line">        -e &quot;s/\$&#123;P0PORT&#125;/$P0PORT/&quot; \</span><br><span class="line">        -e &quot;s/\$&#123;CAPORT&#125;/$CAPORT/&quot; \</span><br><span class="line">        -e &quot;s#\$&#123;PEERPEM&#125;#$PP#&quot; \</span><br><span class="line">        -e &quot;s#\$&#123;CAPEM&#125;#$CP#&quot; \</span><br><span class="line">        organizations/ccp-template.yaml | sed -e $&#x27;s/\\\\n/\\\n          /g&#x27;)&quot; &gt; organizations/peerOrganizations/org1.example.com/connection-org1.yaml</span><br><span class="line">        </span><br><span class="line">ORG=2</span><br><span class="line">P0PORT=9051</span><br><span class="line">CAPORT=8054</span><br><span class="line">PEERPEM=organizations/peerOrganizations/org2.example.com/tlsca/tlsca.org2.example.com-cert.pem</span><br><span class="line">CAPEM=organizations/peerOrganizations/org2.example.com/ca/ca.org2.example.com-cert.pem</span><br><span class="line">PP=$(echo &quot;`awk &#x27;NF &#123;sub(/\\n/, &quot;&quot;); printf &quot;%s\\\\\\\n&quot;,$0;&#125;&#x27; $PEERPEM`&quot;)</span><br><span class="line">CP=$(echo &quot;`awk &#x27;NF &#123;sub(/\\n/, &quot;&quot;); printf &quot;%s\\\\\\\n&quot;,$0;&#125;&#x27; $CAPEM`&quot;)</span><br><span class="line">echo &quot;$(sed -e &quot;s/\$&#123;ORG&#125;/$ORG/&quot; \</span><br><span class="line">        -e &quot;s/\$&#123;P0PORT&#125;/$P0PORT/&quot; \</span><br><span class="line">        -e &quot;s/\$&#123;CAPORT&#125;/$CAPORT/&quot; \</span><br><span class="line">        -e &quot;s#\$&#123;PEERPEM&#125;#$PP#&quot; \</span><br><span class="line">        -e &quot;s#\$&#123;CAPEM&#125;#$CP#&quot; \</span><br><span class="line">        organizations/ccp-template.json)&quot; &gt; organizations/peerOrganizations/org2.example.com/connection-org2.json</span><br><span class="line">        </span><br><span class="line">echo &quot;$(sed -e &quot;s/\$&#123;ORG&#125;/$ORG/&quot; \</span><br><span class="line">        -e &quot;s/\$&#123;P0PORT&#125;/$P0PORT/&quot; \</span><br><span class="line">        -e &quot;s/\$&#123;CAPORT&#125;/$CAPORT/&quot; \</span><br><span class="line">        -e &quot;s#\$&#123;PEERPEM&#125;#$PP#&quot; \</span><br><span class="line">        -e &quot;s#\$&#123;CAPEM&#125;#$CP#&quot; \</span><br><span class="line">        organizations/ccp-template.yaml | sed -e $&#x27;s/\\\\n/\\\n          /g&#x27;)&quot; &gt; organizations/peerOrganizations/org2.example.com/connection-org2.yaml</span><br></pre></td></tr></table></figure>

<h4 id="2-2-启动Fabric-CA"><a href="#2-2-启动Fabric-CA" class="headerlink" title="2.2 启动Fabric CA"></a>2.2 启动Fabric CA</h4><p>要求：Fabric CA如何启动？Docker Compose配置文件怎么编写（说明每个环境变量的含义）？fabric-ca-server-config.yaml文件中的内容含义是什么？</p>
<h5 id="2-2-1-详解Fabric-CA-Docker-Compose"><a href="#2-2-1-详解Fabric-CA-Docker-Compose" class="headerlink" title="2.2.1 详解Fabric CA Docker Compose"></a>2.2.1 详解Fabric CA Docker Compose</h5><blockquote>
<p>docker-compose-ca.yaml</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.7&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fabric_test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ca_org1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-ca:latest</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">hyperledger-fabric</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_CA_NAME=ca-org1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_PORT=7054</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_OPERATIONS_LISTENADDRESS=0.0.0.0:17054</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7054:7054&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;17054:17054&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&#x27;fabric-ca-server start -b admin:adminpw -d&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/fabric-ca/org1:/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ca_org1</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ca_org2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-ca:latest</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">hyperledger-fabric</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_CA_NAME=ca-org2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_PORT=8054</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_OPERATIONS_LISTENADDRESS=0.0.0.0:18054</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8054:8054&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18054:18054&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&#x27;fabric-ca-server start -b admin:adminpw -d&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/fabric-ca/org2:/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ca_org2</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ca_orderer:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-ca:latest</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">hyperledger-fabric</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_CA_NAME=ca-orderer</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_PORT=9054</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_OPERATIONS_LISTENADDRESS=0.0.0.0:19054</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9054:9054&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;19054:19054&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&#x27;fabric-ca-server start -b admin:adminpw -d&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/fabric-ca/ordererOrg:/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ca_orderer</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<h5 id="2-2-2-详解fabric-ca-server-config-yaml"><a href="#2-2-2-详解fabric-ca-server-config-yaml" class="headerlink" title="2.2.2 详解fabric-ca-server-config.yaml"></a>2.2.2 详解fabric-ca-server-config.yaml</h5><blockquote>
<p>fabric-ca-server-config.yaml</p>
<p>作用：配置命令行参数；环境变量；配置文件；默认值</p>
<p>⚠️：名称以“file”或“files”结尾的所有字段的值都是其他文件的名称。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37133717/article/details/80932933?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.pc_relevant_paycolumn_v3&spm=1001.2101.3001.4242.1&utm_relevant_index=3">Fabric–CA 应用与配置</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9cee3d0980c4">实操Hyperledger Fabric——Fabric的证书（账号）体系</a></p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Version of config file</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.2</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># Server&#x27;s listening port (default: 7054)</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">7054</span></span><br><span class="line"><span class="comment"># Enables debug logging (default: false)</span></span><br><span class="line"><span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># Size limit of an acceptable CRL in bytes (default: 512000)</span></span><br><span class="line"><span class="attr">crlsizelimit:</span> <span class="number">512000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否在服务端启用TLS,如果启用TLS后进行身份验证的证书和签名的私钥</span></span><br><span class="line"><span class="attr">tls:</span></span><br><span class="line">  <span class="comment"># Enable TLS (default: false)</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># TLS for the server&#x27;s listening port</span></span><br><span class="line">  <span class="attr">certfile:</span></span><br><span class="line">  <span class="attr">keyfile:</span></span><br><span class="line">  <span class="attr">clientauth:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">noclientcert</span></span><br><span class="line">    <span class="attr">certfiles:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 包括实例的名称、签名私钥文件、身份验证证书和证书链文件等；</span></span><br><span class="line"><span class="comment"># 这些私钥和证书文件会用来作为生成ECert、TCert的根证书</span></span><br><span class="line"><span class="attr">ca:</span></span><br><span class="line">  <span class="comment"># Name of this CA</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">Org1CA</span></span><br><span class="line">  <span class="comment"># Key file (is only used to import a private key into BCCSP)</span></span><br><span class="line">  <span class="attr">keyfile:</span></span><br><span class="line">  <span class="comment"># Certificate file (default: ca-cert.pem)</span></span><br><span class="line">  <span class="attr">certfile:</span></span><br><span class="line">  <span class="comment"># Chain file</span></span><br><span class="line">  <span class="attr">chainfile:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">crl:</span></span><br><span class="line">  <span class="attr">expiry:</span> <span class="string">24h</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当fabric-ca-server自身提供用户的注册管理时使用, 此情况下需要禁用LDAP功能, 否则fabric-ca-server将会把注册管理数据转发到LDAP进行查询</span></span><br><span class="line"><span class="attr">registry:</span></span><br><span class="line">  <span class="comment"># 允许同一个用户名和密码进行enrollment的最大次数, -1为无限制, 0为不支持登记</span></span><br><span class="line">  <span class="attr">maxenrollments:</span> <span class="number">-1</span></span><br><span class="line">  <span class="comment"># 注册的实体信息, 可以进行enroll. 只有当LDAP未启用时起作用</span></span><br><span class="line">  <span class="attr">identities:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">admin</span></span><br><span class="line">       <span class="attr">pass:</span> <span class="string">adminpw</span></span><br><span class="line">       <span class="attr">type:</span> <span class="string">client</span></span><br><span class="line">       <span class="attr">affiliation:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">       <span class="attr">attrs:</span></span><br><span class="line">          <span class="attr">hf.Registrar.Roles:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># &quot;peer,orderer,client,user&quot;</span></span><br><span class="line">          <span class="attr">hf.Registrar.DelegateRoles:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">          <span class="attr">hf.Revoker:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">hf.IntermediateCA:</span> <span class="literal">true</span> <span class="comment"># 该id是否是一个中间层的CA</span></span><br><span class="line">          <span class="attr">hf.GenCRL:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">hf.Registrar.Attributes:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">          <span class="attr">hf.AffiliationMgr:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># 数据库支持SQLite3、MySQL、Postgres. 默认为SQLite3类型的本地数据库. 如果要配置集群, 则需要选用MySQL或Postgres后端数据库, 并在前端部署负载均衡器(如Nginx或HAProxy)</span></span><br><span class="line"><span class="attr">db:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">sqlite3</span></span><br><span class="line">  <span class="attr">datasource:</span> <span class="string">fabric-ca-server.db</span> <span class="comment"># SQLite3文件路径</span></span><br><span class="line">  <span class="comment"># 是否启用TLS</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span> <span class="comment"># 是否启用TLS来连接到数据库</span></span><br><span class="line">      <span class="attr">certfiles:</span> <span class="comment"># PEM格式的数据库服务器的TLS根证书, 可以指定多个, 用逗号隔开</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">certfile:</span> <span class="comment"># PEM格式的客户端证书文件</span></span><br><span class="line">        <span class="attr">keyfile:</span> <span class="comment"># PEM格式的客户端证书私钥文件</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 轻量目录访问协议</span></span><br><span class="line"><span class="attr">ldap:</span></span><br><span class="line">   <span class="attr">enabled:</span> <span class="literal">false</span> <span class="comment"># 是否启用LDAP, 默认不启用</span></span><br><span class="line">   <span class="attr">url:</span> <span class="string">ldap://&lt;adminDN&gt;:&lt;adminPassword&gt;@&lt;host&gt;:&lt;port&gt;/&lt;base&gt;</span></span><br><span class="line">   <span class="attr">tls:</span></span><br><span class="line">      <span class="attr">certfiles:</span> <span class="comment"># PEM格式的LDAP服务器的TLS根证书, 可以为多个, 用逗号隔开</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">         <span class="attr">certfile:</span> <span class="comment"># PEM格式的客户端证书文件</span></span><br><span class="line">         <span class="attr">keyfile:</span> <span class="comment"># PEM格式的客户端证书私钥文件</span></span><br><span class="line">   <span class="attr">attribute:</span></span><br><span class="line">      <span class="attr">names:</span> [<span class="string">&#x27;uid&#x27;</span>,<span class="string">&#x27;member&#x27;</span>]</span><br><span class="line">      <span class="attr">converters:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="attr">name:</span></span><br><span class="line">           <span class="attr">value:</span></span><br><span class="line">      <span class="attr">maps:</span></span><br><span class="line">         <span class="attr">groups:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span></span><br><span class="line">              <span class="attr">value:</span></span><br><span class="line">              </span><br><span class="line"><span class="comment"># 组织结构配置</span></span><br><span class="line"><span class="attr">affiliations:</span></span><br><span class="line">   <span class="attr">org1:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">department1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">department2</span></span><br><span class="line">   <span class="attr">org2:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">department1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 签发证书相关的配置包括签名方法、证书超时时间等. </span></span><br><span class="line"><span class="comment"># fabric-ca-server可以作为用户证书的签发CA(默认情况下), 也可以作为根CA来进一步支持其它中间CA</span></span><br><span class="line"><span class="attr">signing:</span></span><br><span class="line">    <span class="attr">default:</span> <span class="comment"># 默认情况下,用于签署Ecert</span></span><br><span class="line">      <span class="attr">usage:</span> <span class="comment"># 所签发证书的KeyUsage extension域</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">digital</span> <span class="string">signature</span></span><br><span class="line">      <span class="attr">expiry:</span> <span class="string">8760h</span></span><br><span class="line">    <span class="attr">profiles:</span> <span class="comment"># 不同的签发配置</span></span><br><span class="line">      <span class="attr">ca:</span> <span class="comment"># 签署中间层CA证书时的配置模板</span></span><br><span class="line">         <span class="attr">usage:</span></span><br><span class="line">           <span class="bullet">-</span> <span class="string">cert</span> <span class="string">sign</span> <span class="comment"># 所签发证书的KeyUsage extension域</span></span><br><span class="line">           <span class="bullet">-</span> <span class="string">crl</span> <span class="string">sign</span></span><br><span class="line">         <span class="attr">expiry:</span> <span class="string">43800h</span></span><br><span class="line">         <span class="attr">caconstraint:</span></span><br><span class="line">           <span class="attr">isca:</span> <span class="literal">true</span></span><br><span class="line">           <span class="attr">maxpathlen:</span> <span class="number">0</span> <span class="comment"># 限制该中间层CA无法进一步签署中间层CA</span></span><br><span class="line">      <span class="attr">tls:</span></span><br><span class="line">         <span class="attr">usage:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">signing</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">key</span> <span class="string">encipherment</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">server</span> <span class="string">auth</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">client</span> <span class="string">auth</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">key</span> <span class="string">agreement</span></span><br><span class="line">         <span class="attr">expiry:</span> <span class="string">8760h</span></span><br><span class="line">         </span><br><span class="line"><span class="comment"># CA自身证书的申请请求配置. 当CA作为根证书服务时, 将基于请求生成一个自签名的证书; 当CA作为中间证书服务时, 将请求发送给上层的根证书进行签署</span></span><br><span class="line"><span class="attr">csr:</span></span><br><span class="line">   <span class="attr">cn:</span> <span class="string">ca.org1.example.com</span> <span class="comment"># 建议与服务器名一致</span></span><br><span class="line">   <span class="attr">names:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">C:</span> <span class="string">US</span></span><br><span class="line">        <span class="attr">ST:</span> <span class="string">&quot;North Carolina&quot;</span></span><br><span class="line">        <span class="attr">L:</span> <span class="string">&quot;Durham&quot;</span></span><br><span class="line">        <span class="attr">O:</span> <span class="string">org1.example.com</span></span><br><span class="line">        <span class="attr">OU:</span></span><br><span class="line">   <span class="attr">hosts:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">localhost</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">org1.example.com</span></span><br><span class="line">   <span class="attr">ca:</span> <span class="comment"># 配置后会加入到证书的扩展字段</span></span><br><span class="line">      <span class="attr">expiry:</span> <span class="string">131400h</span> <span class="comment"># 超时时间</span></span><br><span class="line">      <span class="attr">pathlength:</span> <span class="number">1</span> <span class="comment"># 允许产生的中间证书的深度</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置所选择的加密库</span></span><br><span class="line"><span class="attr">bccsp:</span></span><br><span class="line">    <span class="attr">default:</span> <span class="string">SW</span></span><br><span class="line">    <span class="attr">sw:</span></span><br><span class="line">        <span class="attr">hash:</span> <span class="string">SHA2</span></span><br><span class="line">        <span class="attr">security:</span> <span class="number">256</span></span><br><span class="line">        <span class="attr">filekeystore:</span></span><br><span class="line">            <span class="attr">keystore:</span> <span class="string">msp/keystore</span> <span class="comment"># 存放密钥文件的路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动创建除了默认CA外的多个CA实例, 如ca1、ca2等</span></span><br><span class="line"><span class="attr">cacount:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以指定多个CA配置文件路径, 每个配置文件会启动一个CA服务,注意不同配置文件之间需要避免出现冲突(如服务端口、TLS证书等)</span></span><br><span class="line"><span class="attr">cafiles:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当CA作为中间层CA服务时的相关配置. 包括父CA的地址和名称、登记信息、TLS配置等.</span></span><br><span class="line"><span class="comment"># 注意: 当intermediate.parentserver.url非空时, 意味着本CA是中间层CA服务,否则为根CA服务</span></span><br><span class="line"><span class="attr">intermediate:</span></span><br><span class="line">  <span class="attr">parentserver:</span> <span class="comment"># 父CA相关信息</span></span><br><span class="line">    <span class="attr">url:</span></span><br><span class="line">    <span class="attr">caname:</span></span><br><span class="line">  <span class="attr">enrollment:</span> <span class="comment"># 在父CA侧的登记信息</span></span><br><span class="line">    <span class="attr">hosts:</span> <span class="comment"># 证书主机名列表</span></span><br><span class="line">    <span class="attr">profile:</span> <span class="comment"># 签发所用的profile</span></span><br><span class="line">    <span class="attr">label:</span> <span class="comment"># HSM操作中的标签信息</span></span><br><span class="line">  <span class="attr">tls:</span> <span class="comment"># TLS相关配置</span></span><br><span class="line">    <span class="attr">certfiles:</span> <span class="comment"># 信任的根CA证书</span></span><br><span class="line">    <span class="attr">client:</span> <span class="comment"># 客户端验证启用时的相关文件</span></span><br><span class="line">      <span class="attr">certfile:</span></span><br><span class="line">      <span class="attr">keyfile:</span></span><br></pre></td></tr></table></figure>

<h5 id="2-2-3-启动Fabric-CA并生成MSP"><a href="#2-2-3-启动Fabric-CA并生成MSP" class="headerlink" title="2.2.3 启动Fabric CA并生成MSP"></a>2.2.3 启动Fabric CA并生成MSP</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">COMPOSE_FILE_CA=docker/docker-compose-ca.yaml</span><br><span class="line">docker-compose -f $COMPOSE_FILE_CA up -d 2&gt;&amp;1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker-compose中包含初始化fabric-ca-server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认的配置文件的名称为 fabric-ca-server-config.yaml</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化 fabric-ca-server init -b admin:pass</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 快速启动 fabric-ca-server start -b admin:adminpw -d</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -b：提供注册用户的名称与密码, 如果没有使用 LDAP，这个选项为必需。</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-向CA登记和注册证书"><a href="#2-3-向CA登记和注册证书" class="headerlink" title="2.3 向CA登记和注册证书"></a>2.3 向CA登记和注册证书</h4><p>要求：向CA登记和注册证书使用哪些命令？这些命令的每个选项是什么含义？证书有多少种类型？每种证书用来干什么？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. organizations/fabric-ca/registerEnroll.sh</span><br></pre></td></tr></table></figure>

<p>可参考</p>
<ul>
<li><p><code>organizations/fabric-ca/registerEnroll.sh</code></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37133717/article/details/80932933?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.pc_relevant_paycolumn_v3&spm=1001.2101.3001.4242.1&utm_relevant_index=3">Fabric–CA 应用与配置</a></p>
</li>
</ul>
<p>流程</p>
<ol>
<li>以管理员身份使用CA Client连接到CA Server，并生成相应的文件</li>
<li>注册用户</li>
<li>登记节点</li>
</ol>
<h5 id="2-3-1-交互命令和选项"><a href="#2-3-1-交互命令和选项" class="headerlink" title="2.3.1 交互命令和选项"></a>2.3.1 交互命令和选项</h5><p>fabric-ca-client命令可以与服务端进行交互, 包括以下子命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">  fabric-ca-client [command]</span><br><span class="line">  </span><br><span class="line">Available Commands:</span><br><span class="line">  affiliation Manage affiliations</span><br><span class="line">  certificate Manage certificates</span><br><span class="line">  enroll      Enroll an identity</span><br><span class="line">  gencrl      Generate a CRL</span><br><span class="line">  gencsr      Generate a CSR</span><br><span class="line">  getcainfo   Get CA certificate chain and Idemix public key</span><br><span class="line">  help        Help about any command</span><br><span class="line">  identity    Manage identities</span><br><span class="line">  reenroll    Reenroll an identity</span><br><span class="line">  register    Register an identity</span><br><span class="line">  revoke      Revoke an identity</span><br><span class="line">  version     Prints Fabric CA Client version</span><br><span class="line">  </span><br><span class="line">  Flags:</span><br><span class="line">      --caname string                Name of CA</span><br><span class="line">      --csr.cn string                The common name field of the certificate signing request</span><br><span class="line">      --csr.hosts strings            A list of comma-separated host names in a certificate signing request</span><br><span class="line">      --csr.keyrequest.algo string   Specify key algorithm</span><br><span class="line">      --csr.keyrequest.reusekey      Reuse existing key during reenrollment</span><br><span class="line">      --csr.keyrequest.size int      Specify key size</span><br><span class="line">      --csr.names strings            A list of comma-separated CSR names of the form &lt;name&gt;=&lt;value&gt; (e.g. C=CA,O=Org1)</span><br><span class="line">      --csr.serialnumber string      The serial number in a certificate signing request</span><br><span class="line">      --enrollment.attrs strings     A list of comma-separated attribute requests of the form &lt;name&gt;[:opt] (e.g. foo,bar:opt)</span><br><span class="line">      --enrollment.label string      Label to use in HSM operations</span><br><span class="line">      --enrollment.profile string    Name of the signing profile to use in issuing the certificate</span><br><span class="line">      --enrollment.type string       The type of enrollment request: &#x27;x509&#x27; or &#x27;idemix&#x27; (default &quot;x509&quot;)</span><br><span class="line">  -h, --help                         help for fabric-ca-client</span><br><span class="line">  -H, --home string                  Client&#x27;s home directory (default &quot;/root/.fabric-ca-client&quot;)</span><br><span class="line">      --id.affiliation string        The identity&#x27;s affiliation</span><br><span class="line">      --id.attrs strings             A list of comma-separated attributes of the form &lt;name&gt;=&lt;value&gt; (e.g. foo=foo1,bar=bar1)</span><br><span class="line">      --id.maxenrollments int        The maximum number of times the secret can be reused to enroll (default CA&#x27;s Max Enrollment)</span><br><span class="line">      --id.name string               Unique name of the identity</span><br><span class="line">      --id.secret string             The enrollment secret for the identity being registered</span><br><span class="line">      --id.type string               Type of identity being registered (e.g. &#x27;peer, app, user&#x27;) (default &quot;client&quot;)</span><br><span class="line">      --loglevel string              Set logging level (info, warning, debug, error, fatal, critical)</span><br><span class="line">  -M, --mspdir string                Membership Service Provider directory (default &quot;msp&quot;)</span><br><span class="line">  -m, --myhost string                Hostname to include in the certificate signing request during enrollment (default &quot;iZbp1b1jw4l12jaocmialxZ&quot;)</span><br><span class="line">  -a, --revoke.aki string            AKI (Authority Key Identifier) of the certificate to be revoked</span><br><span class="line">  -e, --revoke.name string           Identity whose certificates should be revoked</span><br><span class="line">  -r, --revoke.reason string         Reason for revocation</span><br><span class="line">  -s, --revoke.serial string         Serial number of the certificate to be revoked</span><br><span class="line">      --tls.certfiles strings        A list of comma-separated PEM-encoded trusted certificate files (e.g. root1.pem,root2.pem)</span><br><span class="line">      --tls.client.certfile string   PEM-encoded certificate file when mutual authenticate is enabled</span><br><span class="line">      --tls.client.keyfile string    PEM-encoded key file when mutual authentication is enabled</span><br><span class="line">  -u, --url string                   URL of fabric-ca-server (default &quot;http://localhost:7054&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="2-4-证书类型与用途"><a href="#2-4-证书类型与用途" class="headerlink" title="2.4 证书类型与用途"></a>2.4 证书类型与用途</h4><p>Fabric CA 是 Hyperledger Fabric 的官方配套认证设施。</p>
<p>Fabric中Orderer、Peer、客户端SDK、CLI接口等操作都需要用到证书。Fabric中的每个具体的动作，创建通道、部署chaincode、调用chaincode等都需要指定证书。</p>
<p><a target="_blank" rel="noopener" href="http://hyperledger-fabric.readthedocs.io/en/latest/Setup/ca-setup.html">原文链接：http://hyperledger-fabric.readthedocs.io/en/latest/Setup/ca-setup.html</a></p>
<p>Fabric CA 属于典型的 CS (Client and Server) 架构，官方代码库：<a target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-ca">https://github.com/hyperledger/fabric-ca</a> 。</p>
<p>它提供的功能有：</p>
<ol>
<li>身份认证，或者从 LDAP 中获取注册信息；</li>
<li>发行担保证书 ECerts (Enrollment Certificates)；</li>
<li>发行交易证书 TCerts (Transaction Certificates)，保障 Hyperledger Fabric 区域链交易平台上的信息匿名性和不可追踪性；</li>
<li>证书更新和撤销。</li>
</ol>
<blockquote>
<p>证书类型</p>
</blockquote>
<ul>
<li><p>cacerts ：文件夹中包含根CA（CA：Certificate Authorities）的自签名 X.509 证书列表。用于自签名及给中间 CA 证书签名。</p>
</li>
<li><p>config.yaml ：配置文件，代替初始化–flag参数</p>
</li>
<li><p>IssuerPublicKey ：发行者公钥</p>
</li>
<li><p>IssuerRevocationPublicKey ：发行者撤销公钥</p>
</li>
<li><p>keystore ：此文件夹是为 Peer 或 Orderer 节点（或客户端的本地MSP）的本地MSP定义的，并包含节点的<strong>签名密钥</strong>。此密钥以加密方式匹配 SCA 文件夹中包含的签名证书，并用于签署数据（如签署交易提议响应，作为认可阶段的一部分）。此文件夹对于本地MSP是必需的，并且必须只包含一个私钥。</p>
</li>
<li><p>signcerts/cert.pem ：背书节点在交易提案响应中的签名证书。此文件夹对于本地 MSP 是必需的，并且该节点必须只有一个 X.509 证书。</p>
</li>
<li><p>tlscacerts ：TLS证书文件</p>
</li>
</ul>
<h4 id="2-5-生成创世区块"><a href="#2-5-生成创世区块" class="headerlink" title="2.5 生成创世区块"></a>2.5 生成创世区块</h4><p>要求：生成区块链网络的创世区块使用什么命令？命令的每个选项含义是什么？需要哪些环境变量？</p>
<p>这里的创始区块是指生成系统通道的创世区块，主要用于启动Ordering服务，配置网络中的策略。而Channel配置区块，主要用于新建应用通道，指定通道成员，以及访问策略等等。</p>
<h5 id="2-5-1-编译生成configtxgen"><a href="#2-5-1-编译生成configtxgen" class="headerlink" title="2.5.1 编译生成configtxgen"></a>2.5.1 编译生成configtxgen</h5><p>configtxgen的作用是生成配置区块和配置交易。我们可以通过make命令生成configtxgen程序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~/go/src/github.com/hyperledger/fabric</span><br><span class="line">make configtxgen</span><br><span class="line"></span><br><span class="line">go install -tags &quot;&quot; -ldflags &quot;-X github.com/hyperledger/fabric/common/metadata.Version=2.2.5 -X github.com/hyperledger/fabric/common/metadata.CommitSHA=68b6b90fe -X github.com/hyperledger/fabric/common/metadata.BaseDockerLabel=org.hyperledger.fabric -X github.com/hyperledger/fabric/common/metadata.DockerNamespace=hyperledger&quot; github.com/hyperledger/fabric/cmd/configtxgen</span><br></pre></td></tr></table></figure>

<h5 id="2-5-2-配置configtx-yaml"><a href="#2-5-2-配置configtx-yaml" class="headerlink" title="2.5.2  配置configtx.yaml"></a>2.5.2  配置configtx.yaml</h5><h5 id="2-5-3-生成创世区块"><a href="#2-5-3-生成创世区块" class="headerlink" title="2.5.3 生成创世区块"></a>2.5.3 生成创世区块</h5><p>配置修改好后，我们就用configtxgen 生成创世区块。并把这个区块保存到本地system-genesis-block文件夹中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</span><br></pre></td></tr></table></figure>

<p>再次重申，创世区块的作用是开启Ordering service服务，配置网络中的策略。</p>
<h5 id="2-5-4-锚节点的更新"><a href="#2-5-4-锚节点的更新" class="headerlink" title="2.5.4 锚节点的更新"></a>2.5.4 锚节点的更新</h5><p>我们使用configtxgen工具来生成的锚节点配置更新文件，锚节点负责代表组织与其他组织中的节点进行Gossip通信。具体命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</span><br><span class="line"></span><br><span class="line">configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP</span><br></pre></td></tr></table></figure>

<h4 id="2-6-docker-compose"><a href="#2-6-docker-compose" class="headerlink" title="2.6 docker-compose"></a>2.6 docker-compose</h4><p>前面对节点和用户的公私钥以及证书，还有创世区块都生成完毕了。这里采用的是docker-compose的方式来部署环境的，所以接下来我们就可以配置docker-compose的yaml文件，以便顺利启动Fabric的Docker环境。</p>
<h5 id="2-6-1-配置Orderer"><a href="#2-6-1-配置Orderer" class="headerlink" title="2.6.1 配置Orderer"></a>2.6.1 配置Orderer</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">orderer.example.com:</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">orderer.example.com</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">hyperledger/fabric-orderer:latest</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">hyperledger-fabric</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LISTENPORT=7050</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span></span><br><span class="line">    <span class="comment"># enabled TLS</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_ENABLED=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_CLUSTER_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_BOOTSTRAPMETHOD=none</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_CHANNELPARTICIPATION_ENABLED=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_ADMIN_TLS_ENABLED=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_ADMIN_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_ADMIN_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_ADMIN_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_ADMIN_TLS_CLIENTROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_ADMIN_LISTENADDRESS=0.0.0.0:7053</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ORDERER_OPERATIONS_LISTENADDRESS=0.0.0.0:17050</span></span><br><span class="line">  <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric</span></span><br><span class="line">  <span class="attr">command:</span> <span class="string">orderer</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../system-genesis-block/genesis.block:/var/hyperledger/orderer/orderer.genesis.block</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">orderer.example.com:/var/hyperledger/production/orderer</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">7050</span><span class="string">:7050</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">7053</span><span class="string">:7053</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">17050</span><span class="string">:17050</span></span><br><span class="line">  <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<h5 id="2-6-2-配置Peer"><a href="#2-6-2-配置Peer" class="headerlink" title="2.6.2 配置Peer"></a>2.6.2 配置Peer</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">peer0.org1.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.org1.example.com</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-peer:latest</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">hyperledger-fabric</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment">#Generic peer variables</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=fabric_test</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line">      <span class="comment">#- FABRIC_LOGGING_SPEC=DEBUG</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_PROFILE_ENABLED=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span></span><br><span class="line">      <span class="comment"># Peer specific variables 分配好各种服务的地址</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer0.org1.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LISTENADDRESS=0.0.0.0:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODEADDRESS=peer0.org1.example.com:7052</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:7052</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org1.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=Org1MSP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_OPERATIONS_LISTENADDRESS=0.0.0.0:17051</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">$&#123;DOCKER_SOCK&#125;:/host/var/run/docker.sock</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">peer0.org1.example.com:/var/hyperledger/production</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">peer</span> <span class="string">node</span> <span class="string">start</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7051</span><span class="string">:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">17051</span><span class="string">:17051</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<h5 id="2-6-3-配置CLI"><a href="#2-6-3-配置CLI" class="headerlink" title="2.6.3 配置CLI"></a>2.6.3 配置CLI</h5><p>CLI在整个Fabric网络中扮演客户端的角色，我们在开发测试的时候可以用CLI来代替SDK，执行各种SDK能执行的操作。CLI会和Peer相连，把指令发送给对应的Peer执行。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cli:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">cli</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-tools:latest</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">hyperledger-fabric</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">stdin_open:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GOPATH=/opt/gopath</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line">      <span class="comment">#- FABRIC_LOGGING_SPEC=DEBUG</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/bash</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../organizations:/opt/gopath/src/github.com/hyperledger/fabric/peer/organizations</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.org1.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.org2.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<h4 id="2-7-初始化Fabric环境"><a href="#2-7-初始化Fabric环境" class="headerlink" title="2.7 初始化Fabric环境"></a>2.7 初始化Fabric环境</h4><p>docker-compose  up</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> use this as the default docker-compose yaml definition</span></span><br><span class="line">COMPOSE_FILE_BASE=docker/docker-compose-test-net.yaml</span><br><span class="line">COMPOSE_FILES=&quot;-f $&#123;COMPOSE_FILE_BASE&#125;&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default database</span></span><br><span class="line">DATABASE=&quot;leveldb&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 也可选couchdb：COMPOSE_FILES=<span class="string">&quot;docker/docker-compose-test-net.yaml -f docker/docker-compose-couch.yaml&quot;</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从环境变量获取docker sock路径</span></span><br><span class="line">SOCK=&quot;$&#123;DOCKER_HOST:-/var/run/docker.sock&#125;&quot;</span><br><span class="line">DOCKER_SOCK=&quot;$&#123;SOCK##unix://&#125;&quot;</span><br><span class="line">DOCKER_SOCK=&quot;$&#123;DOCKER_SOCK&#125;&quot; docker-compose $&#123;COMPOSE_FILES&#125; up -d 2&gt;&amp;1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最后这个-d参数如果不加，那么当前终端就会一直附加在docker-compose上，而如果加上的话，那么docker容器就在后台运行。</span></span><br></pre></td></tr></table></figure>

<p>docker ps -a</p>
<h4 id="2-8-创建Channel"><a href="#2-8-创建Channel" class="headerlink" title="2.8 创建Channel"></a>2.8 创建Channel</h4><p>要求：创建通道使用什么命令？命令的每个选项含义是什么？需要哪些环境变量？</p>
<p>Create channel genesis block</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir channel-artifacts</span><br><span class="line">CHANNEL_NAME=&quot;mychannel&quot;</span><br><span class="line">DELAY=&quot;3&quot;</span><br><span class="line">MAX_RETRY=&quot;5&quot;</span><br><span class="line">FABRIC_CFG_PATH=$&#123;PWD&#125;/configtx</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Create channel genesis block</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> createChannelTx()</span></span><br><span class="line">which configtxgen</span><br><span class="line">set -x</span><br><span class="line">configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/$&#123;CHANNEL_NAME&#125;.tx -channelID $CHANNEL_NAME</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>Create channel</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 为peer组织设置环境变量</span></span><br><span class="line">FABRIC_CFG_PATH=$PWD/../config/</span><br><span class="line">BLOCKFILE=&quot;./channel-artifacts/$&#123;CHANNEL_NAME&#125;.block&quot;</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export PEER0_ORG1_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG1_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建通道</span></span><br><span class="line">set -x</span><br><span class="line">peer channel create -o localhost:7050 -c $CHANNEL_NAME --ordererTLSHostnameOverride orderer.example.com -f ./channel-artifacts/$&#123;CHANNEL_NAME&#125;.tx --outputBlock $BLOCKFILE --tls --cafile $ORDERER_CA &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>joinChannel 1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 为peer组织设置环境变量</span></span><br><span class="line">FABRIC_CFG_PATH=$PWD/../config/</span><br><span class="line">ORG=1</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export PEER0_ORG1_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG1_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br><span class="line">BLOCKFILE=&quot;./channel-artifacts/$&#123;CHANNEL_NAME&#125;.block&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 加入channel</span></span><br><span class="line">set -x</span><br><span class="line">peer channel join -b $BLOCKFILE &gt;&amp;log.txt</span><br><span class="line">cat log.txt</span><br></pre></td></tr></table></figure>

<p>createAnchorPeerUpdate 1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 注意：这必须在 CLI 容器中运行，因为它需要 jq 和 configtxlator</span></span><br><span class="line">docker exec -it cli /bin/bash</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Fetching the most recent configuration block for the channel</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置环境变量</span></span><br><span class="line">ORG=1</span><br><span class="line">CHANNEL_NAME=&quot;mychannel&quot;</span><br><span class="line">OUTPUT=$&#123;CORE_PEER_LOCALMSPID&#125;config.json</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG1_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br><span class="line"><span class="meta">#</span><span class="bash"> Fetching channel config <span class="keyword">for</span> channel mychannel</span></span><br><span class="line">set -x</span><br><span class="line">peer channel fetch config config_block.pb -o orderer.example.com:7050 --ordererTLSHostnameOverride orderer.example.com -c $CHANNEL --tls --cafile $ORDERER_CA</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br></pre></td></tr></table></figure></li>
<li><p>Decoding config block to JSON and isolating config to ${OUTPUT}</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set -x</span><br><span class="line">configtxlator proto_decode --input config_block.pb --type common.Block | jq .data.data[0].payload.data.config &gt;&quot;$&#123;OUTPUT&#125;&quot;</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br></pre></td></tr></table></figure></li>
<li><p>Modify the configuration to append the anchor peer</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set -x</span><br><span class="line">jq &#x27;.channel_group.groups.Application.groups.&#x27;$&#123;CORE_PEER_LOCALMSPID&#125;&#x27;.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;&#x27;$HOST&#x27;&quot;,&quot;port&quot;: &#x27;$PORT&#x27;&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; $&#123;CORE_PEER_LOCALMSPID&#125;config.json &gt; $&#123;CORE_PEER_LOCALMSPID&#125;modified_config.json</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> joinChannel 2</span></span><br><span class="line">ORG=2</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export PEER0_ORG2_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG2_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br><span class="line"></span><br><span class="line">BLOCKFILE=&quot;./channel-artifacts/$&#123;CHANNEL_NAME&#125;.block&quot;</span><br><span class="line">set -x</span><br><span class="line">peer channel join -b $BLOCKFILE &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Set the anchor peers for each org in the channel</span></span></span><br><span class="line"></span><br><span class="line">ORG=1</span><br><span class="line">docker exec cli ./scripts/setAnchorPeer.sh $ORG $CHANNEL_NAME</span><br><span class="line"><span class="meta">#</span><span class="bash"> setAnchorPeer 2</span></span><br><span class="line">ORG=2</span><br><span class="line">docker exec cli ./scripts/setAnchorPeer.sh $ORG $CHANNEL_NAME</span><br></pre></td></tr></table></figure>

<p>系统会在cli内部的当前目录创建一个mychannel.block文件，这个文件非常重要，接下来其他节点要加入这个Channel就必须使用这个文件</p>
<h3 id="3-重点yaml文件"><a href="#3-重点yaml文件" class="headerlink" title="3 重点yaml文件"></a>3 重点yaml文件</h3><h4 id="3-1-core-yaml"><a href="#3-1-core-yaml" class="headerlink" title="3.1 core.yaml"></a>3.1 core.yaml</h4><blockquote>
<p> 文件：fabric-sample/config/<strong>core.yaml</strong></p>
</blockquote>
<p>作用：</p>
<ul>
<li>peer 节点的各项配置</li>
<li>Peer section（节点配置），VM section（链码运行环境配置），chaincode section（链码配置），ledger section（账本配置），operations section（操作服务器），metrics section（度量配置）</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    Peer section</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="attr">peer:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># peer id提供此peer实例的名称，并在命名docker资源时使用。</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">jdoe</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># The networkId 允许网络的逻辑分离，并在命名docker资源时使用。</span></span><br><span class="line">    <span class="attr">networkId:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># The Address at local network interface this Peer will listen on.</span></span><br><span class="line">    <span class="comment"># By default, it will listen on all network interfaces</span></span><br><span class="line">    <span class="attr">listenAddress:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:7051</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:7051</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># peer是否应以编程方式确定其地址</span></span><br><span class="line">    <span class="comment"># 这个案例对docker容器很有用。</span></span><br><span class="line">    <span class="comment"># 设置为true时，将覆盖peer地址。</span></span><br><span class="line">    <span class="attr">addressAutoDetect:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Keepalive settings for peer server and clients</span></span><br><span class="line">    <span class="attr">keepalive:</span></span><br><span class="line">        <span class="comment"># Interval is the duration after which if the server does not see</span></span><br><span class="line">        <span class="comment"># any activity from the client it pings the client to see if it&#x27;s alive</span></span><br><span class="line">        <span class="attr">interval:</span> <span class="string">7200s</span></span><br><span class="line">        <span class="comment"># Timeout is the duration the server waits for a response</span></span><br><span class="line">        <span class="comment"># from the client after sending a ping before closing the connection</span></span><br><span class="line">        <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">        <span class="comment"># MinInterval is the minimum permitted time between client pings.</span></span><br><span class="line">        <span class="comment"># If clients send pings more frequently, the peer server will</span></span><br><span class="line">        <span class="comment"># disconnect them</span></span><br><span class="line">        <span class="attr">minInterval:</span> <span class="string">60s</span></span><br><span class="line">        <span class="comment"># Client keepalive settings for communicating with other peer nodes</span></span><br><span class="line">        <span class="attr">client:</span></span><br><span class="line">            <span class="comment"># Interval is the time between pings to peer nodes.  This must</span></span><br><span class="line">            <span class="comment"># greater than or equal to the minInterval specified by peer</span></span><br><span class="line">            <span class="comment"># nodes</span></span><br><span class="line">            <span class="attr">interval:</span> <span class="string">60s</span></span><br><span class="line">            <span class="comment"># Timeout is the duration the client waits for a response from</span></span><br><span class="line">            <span class="comment"># peer nodes before closing the connection</span></span><br><span class="line">            <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">        <span class="comment"># DeliveryClient keepalive settings for communication with ordering</span></span><br><span class="line">        <span class="comment"># nodes.</span></span><br><span class="line">        <span class="attr">deliveryClient:</span></span><br><span class="line">            <span class="comment"># Interval is the time between pings to ordering nodes.  This must</span></span><br><span class="line">            <span class="comment"># greater than or equal to the minInterval specified by ordering</span></span><br><span class="line">            <span class="comment"># nodes.</span></span><br><span class="line">            <span class="attr">interval:</span> <span class="string">60s</span></span><br><span class="line">            <span class="comment"># Timeout is the duration the client waits for a response from</span></span><br><span class="line">            <span class="comment"># ordering nodes before closing the connection</span></span><br><span class="line">            <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Gossip related configuration</span></span><br><span class="line">    <span class="attr">gossip:</span></span><br><span class="line">        <span class="comment"># Bootstrap set to initialize gossip with.</span></span><br><span class="line">        <span class="comment"># This is a list of other peers that this peer reaches out to at startup.</span></span><br><span class="line">        <span class="comment"># Important: The endpoints here have to be endpoints of peers in the same</span></span><br><span class="line">        <span class="comment"># organization, because the peer would refuse connecting to these endpoints</span></span><br><span class="line">        <span class="comment"># unless they are in the same organization as the peer.</span></span><br><span class="line">        <span class="attr">bootstrap:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:7051</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># <span class="doctag">NOTE:</span> orgLeader and useLeaderElection parameters are mutual exclusive.</span></span><br><span class="line">        <span class="comment"># Setting both to true would result in the termination of the peer</span></span><br><span class="line">        <span class="comment"># since this is undefined state. If the peers are configured with</span></span><br><span class="line">        <span class="comment"># useLeaderElection=false, make sure there is at least 1 peer in the</span></span><br><span class="line">        <span class="comment"># organization that its orgLeader is set to true.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Defines whenever peer will initialize dynamic algorithm for</span></span><br><span class="line">        <span class="comment"># &quot;leader&quot; selection, where leader is the peer to establish</span></span><br><span class="line">        <span class="comment"># connection with ordering service and use delivery protocol</span></span><br><span class="line">        <span class="comment"># to pull ledger blocks from ordering service.</span></span><br><span class="line">        <span class="attr">useLeaderElection:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># Statically defines peer to be an organization &quot;leader&quot;,</span></span><br><span class="line">        <span class="comment"># where this means that current peer will maintain connection</span></span><br><span class="line">        <span class="comment"># with ordering service and disseminate block across peers in</span></span><br><span class="line">        <span class="comment"># its own organization. Multiple peers or all peers in an organization</span></span><br><span class="line">        <span class="comment"># may be configured as org leaders, so that they all pull</span></span><br><span class="line">        <span class="comment"># blocks directly from ordering service.</span></span><br><span class="line">        <span class="attr">orgLeader:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Interval for membershipTracker polling</span></span><br><span class="line">        <span class="attr">membershipTrackerInterval:</span> <span class="string">5s</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Overrides the endpoint that the peer publishes to peers</span></span><br><span class="line">        <span class="comment"># in its organization. For peers in foreign organizations</span></span><br><span class="line">        <span class="comment"># see &#x27;externalEndpoint&#x27;</span></span><br><span class="line">        <span class="attr">endpoint:</span></span><br><span class="line">        <span class="comment"># Maximum count of blocks stored in memory</span></span><br><span class="line">        <span class="attr">maxBlockCountToStore:</span> <span class="number">10</span></span><br><span class="line">        <span class="comment"># Max time between consecutive message pushes(unit: millisecond)</span></span><br><span class="line">        <span class="attr">maxPropagationBurstLatency:</span> <span class="string">10ms</span></span><br><span class="line">        <span class="comment"># Max number of messages stored until a push is triggered to remote peers</span></span><br><span class="line">        <span class="attr">maxPropagationBurstSize:</span> <span class="number">10</span></span><br><span class="line">        <span class="comment"># Number of times a message is pushed to remote peers</span></span><br><span class="line">        <span class="attr">propagateIterations:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment"># Number of peers selected to push messages to</span></span><br><span class="line">        <span class="attr">propagatePeerNum:</span> <span class="number">3</span></span><br><span class="line">        <span class="comment"># Determines frequency of pull phases(unit: second)</span></span><br><span class="line">        <span class="comment"># Must be greater than digestWaitTime + responseWaitTime</span></span><br><span class="line">        <span class="attr">pullInterval:</span> <span class="string">4s</span></span><br><span class="line">        <span class="comment"># Number of peers to pull from</span></span><br><span class="line">        <span class="attr">pullPeerNum:</span> <span class="number">3</span></span><br><span class="line">        <span class="comment"># Determines frequency of pulling state info messages from peers(unit: second)</span></span><br><span class="line">        <span class="attr">requestStateInfoInterval:</span> <span class="string">4s</span></span><br><span class="line">        <span class="comment"># Determines frequency of pushing state info messages to peers(unit: second)</span></span><br><span class="line">        <span class="attr">publishStateInfoInterval:</span> <span class="string">4s</span></span><br><span class="line">        <span class="comment"># Maximum time a stateInfo message is kept until expired</span></span><br><span class="line">        <span class="attr">stateInfoRetentionInterval:</span></span><br><span class="line">        <span class="comment"># Time from startup certificates are included in Alive messages(unit: second)</span></span><br><span class="line">        <span class="attr">publishCertPeriod:</span> <span class="string">10s</span></span><br><span class="line">        <span class="comment"># Should we skip verifying block messages or not (currently not in use)</span></span><br><span class="line">        <span class="attr">skipBlockVerification:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># Dial timeout(unit: second)</span></span><br><span class="line">        <span class="attr">dialTimeout:</span> <span class="string">3s</span></span><br><span class="line">        <span class="comment"># Connection timeout(unit: second)</span></span><br><span class="line">        <span class="attr">connTimeout:</span> <span class="string">2s</span></span><br><span class="line">        <span class="comment"># Buffer size of received messages</span></span><br><span class="line">        <span class="attr">recvBuffSize:</span> <span class="number">20</span></span><br><span class="line">        <span class="comment"># Buffer size of sending messages</span></span><br><span class="line">        <span class="attr">sendBuffSize:</span> <span class="number">200</span></span><br><span class="line">        <span class="comment"># Time to wait before pull engine processes incoming digests (unit: second)</span></span><br><span class="line">        <span class="comment"># Should be slightly smaller than requestWaitTime</span></span><br><span class="line">        <span class="attr">digestWaitTime:</span> <span class="string">1s</span></span><br><span class="line">        <span class="comment"># Time to wait before pull engine removes incoming nonce (unit: milliseconds)</span></span><br><span class="line">        <span class="comment"># Should be slightly bigger than digestWaitTime</span></span><br><span class="line">        <span class="attr">requestWaitTime:</span> <span class="string">1500ms</span></span><br><span class="line">        <span class="comment"># Time to wait before pull engine ends pull (unit: second)</span></span><br><span class="line">        <span class="attr">responseWaitTime:</span> <span class="string">2s</span></span><br><span class="line">        <span class="comment"># Alive check interval(unit: second)</span></span><br><span class="line">        <span class="attr">aliveTimeInterval:</span> <span class="string">5s</span></span><br><span class="line">        <span class="comment"># Alive expiration timeout(unit: second)</span></span><br><span class="line">        <span class="attr">aliveExpirationTimeout:</span> <span class="string">25s</span></span><br><span class="line">        <span class="comment"># Reconnect interval(unit: second)</span></span><br><span class="line">        <span class="attr">reconnectInterval:</span> <span class="string">25s</span></span><br><span class="line">        <span class="comment"># Max number of attempts to connect to a peer</span></span><br><span class="line">        <span class="attr">maxConnectionAttempts:</span> <span class="number">120</span></span><br><span class="line">        <span class="comment"># Message expiration factor for alive messages</span></span><br><span class="line">        <span class="attr">msgExpirationFactor:</span> <span class="number">20</span></span><br><span class="line">        <span class="comment"># This is an endpoint that is published to peers outside of the organization.</span></span><br><span class="line">        <span class="comment"># If this isn&#x27;t set, the peer will not be known to other organizations.</span></span><br><span class="line">        <span class="attr">externalEndpoint:</span></span><br><span class="line">        <span class="comment"># Leader election service configuration</span></span><br><span class="line">        <span class="attr">election:</span></span><br><span class="line">            <span class="comment"># Longest time peer waits for stable membership during leader election startup (unit: second)</span></span><br><span class="line">            <span class="attr">startupGracePeriod:</span> <span class="string">15s</span></span><br><span class="line">            <span class="comment"># Interval gossip membership samples to check its stability (unit: second)</span></span><br><span class="line">            <span class="attr">membershipSampleInterval:</span> <span class="string">1s</span></span><br><span class="line">            <span class="comment"># Time passes since last declaration message before peer decides to perform leader election (unit: second)</span></span><br><span class="line">            <span class="attr">leaderAliveThreshold:</span> <span class="string">10s</span></span><br><span class="line">            <span class="comment"># Time between peer sends propose message and declares itself as a leader (sends declaration message) (unit: second)</span></span><br><span class="line">            <span class="attr">leaderElectionDuration:</span> <span class="string">5s</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">pvtData:</span></span><br><span class="line">            <span class="comment"># pullRetryThreshold determines the maximum duration of time private data corresponding for a given block</span></span><br><span class="line">            <span class="comment"># would be attempted to be pulled from peers until the block would be committed without the private data</span></span><br><span class="line">            <span class="attr">pullRetryThreshold:</span> <span class="string">60s</span></span><br><span class="line">            <span class="comment"># As private data enters the transient store, it is associated with the peer&#x27;s ledger&#x27;s height at that time.</span></span><br><span class="line">            <span class="comment"># transientstoreMaxBlockRetention defines the maximum difference between the current ledger&#x27;s height upon commit,</span></span><br><span class="line">            <span class="comment"># and the private data residing inside the transient store that is guaranteed not to be purged.</span></span><br><span class="line">            <span class="comment"># Private data is purged from the transient store when blocks with sequences that are multiples</span></span><br><span class="line">            <span class="comment"># of transientstoreMaxBlockRetention are committed.</span></span><br><span class="line">            <span class="attr">transientstoreMaxBlockRetention:</span> <span class="number">1000</span></span><br><span class="line">            <span class="comment"># pushAckTimeout is the maximum time to wait for an acknowledgement from each peer</span></span><br><span class="line">            <span class="comment"># at private data push at endorsement time.</span></span><br><span class="line">            <span class="attr">pushAckTimeout:</span> <span class="string">3s</span></span><br><span class="line">            <span class="comment"># Block to live pulling margin, used as a buffer</span></span><br><span class="line">            <span class="comment"># to prevent peer from trying to pull private data</span></span><br><span class="line">            <span class="comment"># from peers that is soon to be purged in next N blocks.</span></span><br><span class="line">            <span class="comment"># This helps a newly joined peer catch up to current</span></span><br><span class="line">            <span class="comment"># blockchain height quicker.</span></span><br><span class="line">            <span class="attr">btlPullMargin:</span> <span class="number">10</span></span><br><span class="line">            <span class="comment"># the process of reconciliation is done in an endless loop, while in each iteration reconciler tries to</span></span><br><span class="line">            <span class="comment"># pull from the other peers the most recent missing blocks with a maximum batch size limitation.</span></span><br><span class="line">            <span class="comment"># reconcileBatchSize determines the maximum batch size of missing private data that will be reconciled in a</span></span><br><span class="line">            <span class="comment"># single iteration.</span></span><br><span class="line">            <span class="attr">reconcileBatchSize:</span> <span class="number">10</span></span><br><span class="line">            <span class="comment"># reconcileSleepInterval determines the time reconciler sleeps from end of an iteration until the beginning</span></span><br><span class="line">            <span class="comment"># of the next reconciliation iteration.</span></span><br><span class="line">            <span class="attr">reconcileSleepInterval:</span> <span class="string">1m</span></span><br><span class="line">            <span class="comment"># reconciliationEnabled is a flag that indicates whether private data reconciliation is enable or not.</span></span><br><span class="line">            <span class="attr">reconciliationEnabled:</span> <span class="literal">true</span></span><br><span class="line">            <span class="comment"># skipPullingInvalidTransactionsDuringCommit is a flag that indicates whether pulling of invalid</span></span><br><span class="line">            <span class="comment"># transaction&#x27;s private data from other peers need to be skipped during the commit time and pulled</span></span><br><span class="line">            <span class="comment"># only through reconciler.</span></span><br><span class="line">            <span class="attr">skipPullingInvalidTransactionsDuringCommit:</span> <span class="literal">false</span></span><br><span class="line">            <span class="comment"># implicitCollectionDisseminationPolicy specifies the dissemination  policy for the peer&#x27;s own implicit collection.</span></span><br><span class="line">            <span class="comment"># When a peer endorses a proposal that writes to its own implicit collection, below values override the default values</span></span><br><span class="line">            <span class="comment"># for disseminating private data.</span></span><br><span class="line">            <span class="comment"># Note that it is applicable to all channels the peer has joined. The implication is that requiredPeerCount has to</span></span><br><span class="line">            <span class="comment"># be smaller than the number of peers in a channel that has the lowest numbers of peers from the organization.</span></span><br><span class="line">            <span class="attr">implicitCollectionDisseminationPolicy:</span></span><br><span class="line">               <span class="comment"># requiredPeerCount defines the minimum number of eligible peers to which the peer must successfully</span></span><br><span class="line">               <span class="comment"># disseminate private data for its own implicit collection during endorsement. Default value is 0.</span></span><br><span class="line">               <span class="attr">requiredPeerCount:</span> <span class="number">0</span></span><br><span class="line">               <span class="comment"># maxPeerCount defines the maximum number of eligible peers to which the peer will attempt to</span></span><br><span class="line">               <span class="comment"># disseminate private data for its own implicit collection during endorsement. Default value is 1.</span></span><br><span class="line">               <span class="attr">maxPeerCount:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Gossip state transfer related configuration</span></span><br><span class="line">        <span class="attr">state:</span></span><br><span class="line">            <span class="comment"># indicates whenever state transfer is enabled or not</span></span><br><span class="line">            <span class="comment"># default value is true, i.e. state transfer is active</span></span><br><span class="line">            <span class="comment"># and takes care to sync up missing blocks allowing</span></span><br><span class="line">            <span class="comment"># lagging peer to catch up to speed with rest network.</span></span><br><span class="line">            <span class="comment"># Keep in mind that when peer.gossip.useLeaderElection is true</span></span><br><span class="line">            <span class="comment"># and there are several peers in the organization,</span></span><br><span class="line">            <span class="comment"># or peer.gossip.useLeaderElection is false alongside with</span></span><br><span class="line">            <span class="comment"># peer.gossip.orgleader being false, the peer&#x27;s ledger may lag behind</span></span><br><span class="line">            <span class="comment"># the rest of the peers and will never catch up due to state transfer</span></span><br><span class="line">            <span class="comment"># being disabled.</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">            <span class="comment"># checkInterval interval to check whether peer is lagging behind enough to</span></span><br><span class="line">            <span class="comment"># request blocks via state transfer from another peer.</span></span><br><span class="line">            <span class="attr">checkInterval:</span> <span class="string">10s</span></span><br><span class="line">            <span class="comment"># responseTimeout amount of time to wait for state transfer response from</span></span><br><span class="line">            <span class="comment"># other peers</span></span><br><span class="line">            <span class="attr">responseTimeout:</span> <span class="string">3s</span></span><br><span class="line">            <span class="comment"># batchSize the number of blocks to request via state transfer from another peer</span></span><br><span class="line">            <span class="attr">batchSize:</span> <span class="number">10</span></span><br><span class="line">            <span class="comment"># blockBufferSize reflects the size of the re-ordering buffer</span></span><br><span class="line">            <span class="comment"># which captures blocks and takes care to deliver them in order</span></span><br><span class="line">            <span class="comment"># down to the ledger layer. The actual buffer size is bounded between</span></span><br><span class="line">            <span class="comment"># 0 and 2*blockBufferSize, each channel maintains its own buffer</span></span><br><span class="line">            <span class="attr">blockBufferSize:</span> <span class="number">20</span></span><br><span class="line">            <span class="comment"># maxRetries maximum number of re-tries to ask</span></span><br><span class="line">            <span class="comment"># for single state transfer request</span></span><br><span class="line">            <span class="attr">maxRetries:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># TLS Settings</span></span><br><span class="line">    <span class="attr">tls:</span></span><br><span class="line">        <span class="comment"># Require server-side TLS</span></span><br><span class="line">        <span class="attr">enabled:</span>  <span class="literal">false</span></span><br><span class="line">        <span class="comment"># Require client certificates / mutual TLS for inbound connections.</span></span><br><span class="line">        <span class="comment"># Note that clients that are not configured to use a certificate will</span></span><br><span class="line">        <span class="comment"># fail to connect to the peer.</span></span><br><span class="line">        <span class="attr">clientAuthRequired:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># X.509 certificate used for TLS server</span></span><br><span class="line">        <span class="attr">cert:</span></span><br><span class="line">            <span class="attr">file:</span> <span class="string">tls/server.crt</span></span><br><span class="line">        <span class="comment"># Private key used for TLS server</span></span><br><span class="line">        <span class="attr">key:</span></span><br><span class="line">            <span class="attr">file:</span> <span class="string">tls/server.key</span></span><br><span class="line">        <span class="comment"># rootcert.file represents the trusted root certificate chain used for verifying certificates</span></span><br><span class="line">        <span class="comment"># of other nodes during outbound connections.</span></span><br><span class="line">        <span class="comment"># It is not required to be set, but can be used to augment the set of TLS CA certificates</span></span><br><span class="line">        <span class="comment"># available from the MSPs of each channel’s configuration.</span></span><br><span class="line">        <span class="attr">rootcert:</span></span><br><span class="line">            <span class="attr">file:</span> <span class="string">tls/ca.crt</span></span><br><span class="line">        <span class="comment"># If mutual TLS is enabled, clientRootCAs.files contains a list of additional root certificates</span></span><br><span class="line">        <span class="comment"># used for verifying certificates of client connections.</span></span><br><span class="line">        <span class="comment"># It augments the set of TLS CA certificates available from the MSPs of each channel’s configuration.</span></span><br><span class="line">        <span class="comment"># Minimally, set your organization&#x27;s TLS CA root certificate so that the peer can receive join channel requests.</span></span><br><span class="line">        <span class="attr">clientRootCAs:</span></span><br><span class="line">            <span class="attr">files:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">tls/ca.crt</span></span><br><span class="line">        <span class="comment"># Private key used for TLS when making client connections.</span></span><br><span class="line">        <span class="comment"># If not set, peer.tls.key.file will be used instead</span></span><br><span class="line">        <span class="attr">clientKey:</span></span><br><span class="line">            <span class="attr">file:</span></span><br><span class="line">        <span class="comment"># X.509 certificate used for TLS when making client connections.</span></span><br><span class="line">        <span class="comment"># If not set, peer.tls.cert.file will be used instead</span></span><br><span class="line">        <span class="attr">clientCert:</span></span><br><span class="line">            <span class="attr">file:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Authentication 包含与验证客户端消息相关的配置参数</span></span><br><span class="line">    <span class="attr">authentication:</span></span><br><span class="line">        <span class="comment"># the acceptable difference between the current server time and the</span></span><br><span class="line">        <span class="comment"># client&#x27;s time as specified in a client request message</span></span><br><span class="line">        <span class="attr">timewindow:</span> <span class="string">15m</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对等方存储数据的文件系统路径（如分类账）。</span></span><br><span class="line">    <span class="comment"># 此位置必须受到访问控制保护，以防止可能损坏对等操作的意外修改。</span></span><br><span class="line">    <span class="attr">fileSystemPath:</span> <span class="string">/var/hyperledger/production</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># BCCSP（区块链加密提供商）：选择要使用的加密实现或库</span></span><br><span class="line">    <span class="attr">BCCSP:</span></span><br><span class="line">        <span class="attr">Default:</span> <span class="string">SW</span></span><br><span class="line">        <span class="comment"># Settings for the SW crypto provider (i.e. when DEFAULT: SW)</span></span><br><span class="line">        <span class="attr">SW:</span></span><br><span class="line">            <span class="comment"># <span class="doctag">TODO:</span> The default Hash and Security level needs refactoring to be</span></span><br><span class="line">            <span class="comment"># fully configurable. Changing these defaults requires coordination</span></span><br><span class="line">            <span class="comment"># SHA2 is hardcoded in several places, not only BCCSP</span></span><br><span class="line">            <span class="attr">Hash:</span> <span class="string">SHA2</span></span><br><span class="line">            <span class="attr">Security:</span> <span class="number">256</span></span><br><span class="line">            <span class="comment"># Location of Key Store</span></span><br><span class="line">            <span class="attr">FileKeyStore:</span></span><br><span class="line">                <span class="comment"># If &quot;&quot;, defaults to &#x27;mspConfigPath&#x27;/keystore</span></span><br><span class="line">                <span class="attr">KeyStore:</span></span><br><span class="line">        <span class="comment"># Settings for the PKCS#11 crypto provider (i.e. when DEFAULT: PKCS11)</span></span><br><span class="line">        <span class="attr">PKCS11:</span></span><br><span class="line">            <span class="comment"># Location of the PKCS11 module library</span></span><br><span class="line">            <span class="attr">Library:</span></span><br><span class="line">            <span class="comment"># Token Label</span></span><br><span class="line">            <span class="attr">Label:</span></span><br><span class="line">            <span class="comment"># User PIN</span></span><br><span class="line">            <span class="attr">Pin:</span></span><br><span class="line">            <span class="attr">Hash:</span></span><br><span class="line">            <span class="attr">Security:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对等方将在其中找到MSP本地配置的文件系统上的路径</span></span><br><span class="line">    <span class="attr">mspConfigPath:</span> <span class="string">msp</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 本地MSP的标识符</span></span><br><span class="line">    <span class="comment"># ----!!!!IMPORTANT!!!-!!!IMPORTANT!!!-!!!IMPORTANT!!!!----</span></span><br><span class="line">    <span class="comment"># 部署人员需要更改localMspId字符串的值。</span></span><br><span class="line">    <span class="comment"># 尤其是，对等方的本地MSP ID的名称需要与该对等方所属的每个通道中的一个MSP的名称相匹配。</span></span><br><span class="line">    <span class="comment"># 否则，该对等方的消息将不会被其他节点识别为有效。</span></span><br><span class="line">    <span class="attr">localMspId:</span> <span class="string">SampleOrg</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># CLI 通用客户端配置选项</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">        <span class="comment"># connection timeout</span></span><br><span class="line">        <span class="attr">connTimeout:</span> <span class="string">3s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Delivery service related config</span></span><br><span class="line">    <span class="attr">deliveryclient:</span></span><br><span class="line">        <span class="comment"># Enables this peer to disseminate blocks it pulled from the ordering service</span></span><br><span class="line">        <span class="comment"># via gossip.</span></span><br><span class="line">        <span class="comment"># Note that &#x27;gossip.state.enabled&#x27; controls point to point block replication</span></span><br><span class="line">        <span class="comment"># of blocks committed in the past.</span></span><br><span class="line">        <span class="attr">blockGossipEnabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># It sets the total time the delivery service may spend in reconnection</span></span><br><span class="line">        <span class="comment"># attempts until its retry logic gives up and returns an error</span></span><br><span class="line">        <span class="attr">reconnectTotalTimeThreshold:</span> <span class="string">3600s</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># It sets the delivery service &lt;-&gt; ordering service node connection timeout</span></span><br><span class="line">        <span class="attr">connTimeout:</span> <span class="string">3s</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># It sets the delivery service maximal delay between consecutive retries</span></span><br><span class="line">        <span class="attr">reConnectBackoffThreshold:</span> <span class="string">3600s</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># A list of orderer endpoint addresses which should be overridden</span></span><br><span class="line">        <span class="comment"># when found in channel configurations.</span></span><br><span class="line">        <span class="attr">addressOverrides:</span></span><br><span class="line">        <span class="comment">#  - from:</span></span><br><span class="line">        <span class="comment">#    to:</span></span><br><span class="line">        <span class="comment">#    caCertsFile:</span></span><br><span class="line">        <span class="comment">#  - from:</span></span><br><span class="line">        <span class="comment">#    to:</span></span><br><span class="line">        <span class="comment">#    caCertsFile:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 本地MSP的类型-默认情况下为bccsp类型</span></span><br><span class="line">    <span class="attr">localMspType:</span> <span class="string">bccsp</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 仅在非生产环境中与Go分析工具一起使用。在生产中，它应该被禁用（例如启用：false）</span></span><br><span class="line">    <span class="attr">profile:</span></span><br><span class="line">        <span class="attr">enabled:</span>     <span class="literal">false</span></span><br><span class="line">        <span class="attr">listenAddress:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:6060</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Handlers defines 可以过滤和变异的自定义处理程序 within the peer</span></span><br><span class="line">    <span class="attr">handlers:</span></span><br><span class="line">        <span class="attr">authFilters:</span></span><br><span class="line">          <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">DefaultAuth</span></span><br><span class="line">          <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">ExpirationCheck</span>    </span><br><span class="line">        <span class="attr">decorators:</span></span><br><span class="line">          <span class="bullet">-</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">DefaultDecorator</span></span><br><span class="line">        <span class="attr">endorsers:</span></span><br><span class="line">          <span class="attr">escc:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">DefaultEndorsement</span></span><br><span class="line">            <span class="attr">library:</span></span><br><span class="line">        <span class="attr">validators:</span></span><br><span class="line">          <span class="attr">vscc:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">DefaultValidation</span></span><br><span class="line">            <span class="attr">library:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    library: /etc/hyperledger/fabric/plugin/escc.so</span></span><br><span class="line">    <span class="comment"># Number of goroutines that will execute transaction validation in parallel.</span></span><br><span class="line">    <span class="comment"># By default, the peer chooses the number of CPUs on the machine. Set this</span></span><br><span class="line">    <span class="comment"># variable to override that choice.</span></span><br><span class="line">    <span class="comment"># <span class="doctag">NOTE:</span> overriding this value might negatively influence the performance of</span></span><br><span class="line">    <span class="comment"># the peer so please change this value only if you know what you&#x27;re doing</span></span><br><span class="line">    <span class="attr">validatorPoolSize:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 客户端使用发现服务来查询有关对等方的信息，</span></span><br><span class="line">    <span class="comment"># 例如——哪些对等方加入了某个渠道，最新的渠道配置是什么，</span></span><br><span class="line">    <span class="comment"># 最重要的是——给定链码和渠道，哪些可能的对等方满足认可策略。</span></span><br><span class="line">    <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># Whether the authentication cache is enabled or not.</span></span><br><span class="line">        <span class="attr">authCacheEnabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># The maximum size of the cache, after which a purge takes place</span></span><br><span class="line">        <span class="attr">authCacheMaxSize:</span> <span class="number">1000</span></span><br><span class="line">        <span class="comment"># The proportion (0 to 1) of entries that remain in the cache after the cache is purged due to overpopulation</span></span><br><span class="line">        <span class="attr">authCachePurgeRetentionRatio:</span> <span class="number">0.75</span></span><br><span class="line">        <span class="comment"># Whether to allow non-admins to perform non channel scoped queries.</span></span><br><span class="line">        <span class="comment"># When this is false, it means that only peer admins can perform non channel scoped queries.</span></span><br><span class="line">        <span class="attr">orgMembersAllowedAccess:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Limits is used to configure some internal resource limits.</span></span><br><span class="line">    <span class="attr">limits:</span></span><br><span class="line">        <span class="comment"># Concurrency limits the number of concurrently running requests to a service on each peer.</span></span><br><span class="line">        <span class="comment"># Currently this option is only applied to endorser service and deliver service.</span></span><br><span class="line">        <span class="comment"># When the property is missing or the value is 0, the concurrency limit is disabled for the service.</span></span><br><span class="line">        <span class="attr">concurrency:</span></span><br><span class="line">            <span class="comment"># endorserService limits concurrent requests to endorser service that handles chaincode deployment, query and invocation,</span></span><br><span class="line">            <span class="comment"># including both user chaincodes and system chaincodes.</span></span><br><span class="line">            <span class="attr">endorserService:</span> <span class="number">2500</span></span><br><span class="line">            <span class="comment"># deliverService limits concurrent event listeners registered to deliver service for blocks and transaction events.</span></span><br><span class="line">            <span class="attr">deliverService:</span> <span class="number">2500</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Since all nodes should be consistent it is recommended to keep</span></span><br><span class="line">    <span class="comment"># the default value of 100MB for MaxRecvMsgSize &amp; MaxSendMsgSize</span></span><br><span class="line">    <span class="comment"># Max message size in bytes GRPC server and client can receive</span></span><br><span class="line">    <span class="attr">maxRecvMsgSize:</span> <span class="number">104857600</span></span><br><span class="line">    <span class="comment"># Max message size in bytes GRPC server and client can send</span></span><br><span class="line">    <span class="attr">maxSendMsgSize:</span> <span class="number">104857600</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    VM section</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="attr">vm:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 虚拟机管理系统的端点。对于docker来说，通常可以是以下情况之一</span></span><br><span class="line">    <span class="comment"># unix:///var/run/docker.sock</span></span><br><span class="line">    <span class="comment"># http://localhost:2375</span></span><br><span class="line">    <span class="comment"># https://localhost:2376</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">unix:///var/run/docker.sock</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># docker虚拟机的设置</span></span><br><span class="line">    <span class="attr">docker:</span></span><br><span class="line">        <span class="attr">tls:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">            <span class="attr">ca:</span></span><br><span class="line">                <span class="attr">file:</span> <span class="string">docker/ca.crt</span></span><br><span class="line">            <span class="attr">cert:</span></span><br><span class="line">                <span class="attr">file:</span> <span class="string">docker/tls.crt</span></span><br><span class="line">            <span class="attr">key:</span></span><br><span class="line">                <span class="attr">file:</span> <span class="string">docker/tls.key</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 出于调试目的，启用/禁用链码容器中的标准输出/错误</span></span><br><span class="line">        <span class="attr">attachStdout:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建docker容器的参数</span></span><br><span class="line">        <span class="comment"># 可以使用ipam &amp; dns-server为集群高效地创建容器</span></span><br><span class="line">        <span class="comment"># NetworkMode - sets the networking mode for the container. Supported</span></span><br><span class="line">        <span class="comment"># standard values are: `host`(default),`bridge`,`ipvlan`,`none`.</span></span><br><span class="line">        <span class="comment"># Dns - a list of DNS servers for the container to use.</span></span><br><span class="line">        <span class="comment"># <span class="doctag">Note:</span>  `Privileged` `Binds` `Links` and `PortBindings` properties of</span></span><br><span class="line">        <span class="comment"># Docker Host Config are not supported and will not be used if set.</span></span><br><span class="line">        <span class="comment"># LogConfig - sets the logging driver (Type) and related options</span></span><br><span class="line">        <span class="comment"># (Config) for Docker. For more info,</span></span><br><span class="line">        <span class="comment"># https://docs.docker.com/engine/admin/logging/overview/</span></span><br><span class="line">        <span class="comment"># <span class="doctag">Note:</span> Set LogConfig using Environment Variables is not supported.</span></span><br><span class="line">        <span class="attr">hostConfig:</span></span><br><span class="line">            <span class="attr">NetworkMode:</span> <span class="string">host</span></span><br><span class="line">            <span class="attr">Dns:</span></span><br><span class="line">               <span class="comment"># - 192.168.0.1</span></span><br><span class="line">            <span class="attr">LogConfig:</span></span><br><span class="line">                <span class="attr">Type:</span> <span class="string">json-file</span></span><br><span class="line">                <span class="attr">Config:</span></span><br><span class="line">                    <span class="attr">max-size:</span> <span class="string">&quot;50m&quot;</span></span><br><span class="line">                    <span class="attr">max-file:</span> <span class="string">&quot;5&quot;</span></span><br><span class="line">            <span class="attr">Memory:</span> <span class="number">2147483648</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    Chaincode section</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="attr">chaincode:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 链码存根使用该id向对等方注册正在执行的链码id，</span></span><br><span class="line">    <span class="comment"># 该id通常通过ENV变量提供。安装链码时，会提供“路径”形式的id。</span></span><br><span class="line">    <span class="comment"># “name”用于所有其他请求，可以是任何字符串。</span></span><br><span class="line">    <span class="attr">id:</span></span><br><span class="line">        <span class="attr">path:</span></span><br><span class="line">        <span class="attr">name:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Generic builder environment, suitable for most chaincode types</span></span><br><span class="line">    <span class="attr">builder:</span> <span class="string">$(DOCKER_NS)/fabric-ccenv:$(TWO_DIGIT_VERSION)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Enables/disables force pulling of the base docker images (listed below)</span></span><br><span class="line">    <span class="comment"># during user chaincode instantiation.</span></span><br><span class="line">    <span class="comment"># Useful when using moving image tags (such as :latest)</span></span><br><span class="line">    <span class="attr">pull:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">golang:</span></span><br><span class="line">        <span class="comment"># golang will never need more than baseos</span></span><br><span class="line">        <span class="attr">runtime:</span> <span class="string">$(DOCKER_NS)/fabric-baseos:$(TWO_DIGIT_VERSION)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># whether or not golang chaincode should be linked dynamically</span></span><br><span class="line">        <span class="attr">dynamicLink:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">java:</span></span><br><span class="line">        <span class="comment"># This is an image based on java:openjdk-8 with addition compiler</span></span><br><span class="line">        <span class="comment"># tools added for java shim layer packaging.</span></span><br><span class="line">        <span class="comment"># This image is packed with shim layer libraries that are necessary</span></span><br><span class="line">        <span class="comment"># for Java chaincode runtime.</span></span><br><span class="line">        <span class="attr">runtime:</span> <span class="string">$(DOCKER_NS)/fabric-javaenv:$(TWO_DIGIT_VERSION)</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">node:</span></span><br><span class="line">        <span class="comment"># This is an image based on node:$(NODE_VER)-alpine</span></span><br><span class="line">        <span class="attr">runtime:</span> <span class="string">$(DOCKER_NS)/fabric-nodeenv:$(TWO_DIGIT_VERSION)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># List of directories to treat as external builders and launchers for</span></span><br><span class="line">    <span class="comment"># chaincode. The external builder detection processing will iterate over the</span></span><br><span class="line">    <span class="comment"># builders in the order specified below.</span></span><br><span class="line">    <span class="comment"># To override this property via env variable use CORE_CHAINCODE_EXTERNALBUILDERS: [&#123;name: x, path: dir1&#125;, &#123;name: y, path: dir2&#125;]</span></span><br><span class="line">    <span class="attr">externalBuilders:</span> []</span><br><span class="line">        <span class="comment"># - path: /path/to/directory</span></span><br><span class="line">        <span class="comment">#   name: descriptive-builder-name</span></span><br><span class="line">        <span class="comment">#   propagateEnvironment:</span></span><br><span class="line">        <span class="comment">#      - ENVVAR_NAME_TO_PROPAGATE_FROM_PEER</span></span><br><span class="line">        <span class="comment">#      - GOPROXY</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># The maximum duration to wait for the chaincode build and install process</span></span><br><span class="line">    <span class="comment"># to complete.</span></span><br><span class="line">    <span class="attr">installTimeout:</span> <span class="string">300s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Timeout duration for starting up a container and waiting for Register</span></span><br><span class="line">    <span class="comment"># to come through.</span></span><br><span class="line">    <span class="attr">startuptimeout:</span> <span class="string">300s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Timeout duration for Invoke and Init calls to prevent runaway.</span></span><br><span class="line">    <span class="comment"># This timeout is used by all chaincodes in all the channels, including</span></span><br><span class="line">    <span class="comment"># system chaincodes.</span></span><br><span class="line">    <span class="comment"># Note that during Invoke, if the image is not available (e.g. being</span></span><br><span class="line">    <span class="comment"># cleaned up when in development environment), the peer will automatically</span></span><br><span class="line">    <span class="comment"># build the image, which might take more time. In production environment,</span></span><br><span class="line">    <span class="comment"># the chaincode image is unlikely to be deleted, so the timeout could be</span></span><br><span class="line">    <span class="comment"># reduced accordingly.</span></span><br><span class="line">    <span class="attr">executetimeout:</span> <span class="string">30s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># There are 2 modes: &quot;dev&quot; and &quot;net&quot;.</span></span><br><span class="line">    <span class="comment"># In dev mode, user runs the chaincode after starting peer from</span></span><br><span class="line">    <span class="comment"># command line on local machine.</span></span><br><span class="line">    <span class="comment"># In net mode, peer will run chaincode in a docker container.</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">net</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># keepalive in seconds. In situations where the communication goes through a</span></span><br><span class="line">    <span class="comment"># proxy that does not support keep-alive, this parameter will maintain connection</span></span><br><span class="line">    <span class="comment"># between peer and chaincode.</span></span><br><span class="line">    <span class="comment"># A value &lt;= 0 turns keepalive off</span></span><br><span class="line">    <span class="attr">keepalive:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># enabled system chaincodes</span></span><br><span class="line">    <span class="attr">system:</span></span><br><span class="line">        <span class="attr">_lifecycle:</span> <span class="string">enable</span></span><br><span class="line">        <span class="attr">cscc:</span> <span class="string">enable</span></span><br><span class="line">        <span class="attr">lscc:</span> <span class="string">enable</span></span><br><span class="line">        <span class="attr">qscc:</span> <span class="string">enable</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Logging section for the chaincode container</span></span><br><span class="line">    <span class="attr">logging:</span></span><br><span class="line">      <span class="comment"># Default level for all loggers within the chaincode container</span></span><br><span class="line">      <span class="attr">level:</span>  <span class="string">info</span></span><br><span class="line">      <span class="comment"># Override default level for the &#x27;shim&#x27; logger</span></span><br><span class="line">      <span class="attr">shim:</span>   <span class="string">warning</span></span><br><span class="line">      <span class="comment"># Format for the chaincode container logs</span></span><br><span class="line">      <span class="attr">format:</span> <span class="string">&#x27;<span class="template-variable">%&#123;color&#125;</span><span class="template-variable">%&#123;time:2006-01-02 15:04:05.000 MST&#125;</span> [<span class="template-variable">%&#123;module&#125;</span>] <span class="template-variable">%&#123;shortfunc&#125;</span> -&gt; <span class="template-variable">%&#123;level:.4s&#125;</span> <span class="template-variable">%&#123;id:03x&#125;</span><span class="template-variable">%&#123;color:reset&#125;</span> <span class="template-variable">%&#123;message&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    Ledger section - ledger configuration encompasses both the blockchain</span></span><br><span class="line"><span class="comment">#    and the state</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="attr">ledger:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">blockchain:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">state:</span></span><br><span class="line">    <span class="comment"># stateDatabase - options are &quot;goleveldb&quot;, &quot;CouchDB&quot;</span></span><br><span class="line">    <span class="comment"># goleveldb - default state database stored in goleveldb.</span></span><br><span class="line">    <span class="comment"># CouchDB - store state database in CouchDB</span></span><br><span class="line">    <span class="attr">stateDatabase:</span> <span class="string">goleveldb</span></span><br><span class="line">    <span class="comment"># Limit on the number of records to return per query</span></span><br><span class="line">    <span class="attr">totalQueryLimit:</span> <span class="number">100000</span></span><br><span class="line">    <span class="attr">couchDBConfig:</span></span><br><span class="line">       <span class="comment"># It is recommended to run CouchDB on the same server as the peer, and</span></span><br><span class="line">       <span class="comment"># not map the CouchDB container port to a server port in docker-compose.</span></span><br><span class="line">       <span class="comment"># Otherwise proper security must be provided on the connection between</span></span><br><span class="line">       <span class="comment"># CouchDB client (on the peer) and server.</span></span><br><span class="line">       <span class="attr">couchDBAddress:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:5984</span></span><br><span class="line">       <span class="comment"># This username must have read and write authority on CouchDB</span></span><br><span class="line">       <span class="attr">username:</span></span><br><span class="line">       <span class="comment"># The password is recommended to pass as an environment variable</span></span><br><span class="line">       <span class="comment"># during start up (eg CORE_LEDGER_STATE_COUCHDBCONFIG_PASSWORD).</span></span><br><span class="line">       <span class="comment"># If it is stored here, the file must be access control protected</span></span><br><span class="line">       <span class="comment"># to prevent unintended users from discovering the password.</span></span><br><span class="line">       <span class="attr">password:</span></span><br><span class="line">       <span class="comment"># Number of retries for CouchDB errors</span></span><br><span class="line">       <span class="attr">maxRetries:</span> <span class="number">3</span></span><br><span class="line">       <span class="comment"># Number of retries for CouchDB errors during peer startup.</span></span><br><span class="line">       <span class="comment"># The delay between retries doubles for each attempt.</span></span><br><span class="line">       <span class="comment"># Default of 10 retries results in 11 attempts over 2 minutes.</span></span><br><span class="line">       <span class="attr">maxRetriesOnStartup:</span> <span class="number">10</span></span><br><span class="line">       <span class="comment"># CouchDB request timeout (unit: duration, e.g. 20s)</span></span><br><span class="line">       <span class="attr">requestTimeout:</span> <span class="string">35s</span></span><br><span class="line">       <span class="comment"># Limit on the number of records per each CouchDB query</span></span><br><span class="line">       <span class="comment"># Note that chaincode queries are only bound by totalQueryLimit.</span></span><br><span class="line">       <span class="comment"># Internally the chaincode may execute multiple CouchDB queries,</span></span><br><span class="line">       <span class="comment"># each of size internalQueryLimit.</span></span><br><span class="line">       <span class="attr">internalQueryLimit:</span> <span class="number">1000</span></span><br><span class="line">       <span class="comment"># Limit on the number of records per CouchDB bulk update batch</span></span><br><span class="line">       <span class="attr">maxBatchUpdateSize:</span> <span class="number">1000</span></span><br><span class="line">       <span class="comment"># Warm indexes after every N blocks.</span></span><br><span class="line">       <span class="comment"># This option warms any indexes that have been</span></span><br><span class="line">       <span class="comment"># deployed to CouchDB after every N blocks.</span></span><br><span class="line">       <span class="comment"># A value of 1 will warm indexes after every block commit,</span></span><br><span class="line">       <span class="comment"># to ensure fast selector queries.</span></span><br><span class="line">       <span class="comment"># Increasing the value may improve write efficiency of peer and CouchDB,</span></span><br><span class="line">       <span class="comment"># but may degrade query response time.</span></span><br><span class="line">       <span class="attr">warmIndexesAfterNBlocks:</span> <span class="number">1</span></span><br><span class="line">       <span class="comment"># Create the _global_changes system database</span></span><br><span class="line">       <span class="comment"># This is optional.  Creating the global changes database will require</span></span><br><span class="line">       <span class="comment"># additional system resources to track changes and maintain the database</span></span><br><span class="line">       <span class="attr">createGlobalChangesDB:</span> <span class="literal">false</span></span><br><span class="line">       <span class="comment"># CacheSize denotes the maximum mega bytes (MB) to be allocated for the in-memory state</span></span><br><span class="line">       <span class="comment"># cache. Note that CacheSize needs to be a multiple of 32 MB. If it is not a multiple</span></span><br><span class="line">       <span class="comment"># of 32 MB, the peer would round the size to the next multiple of 32 MB.</span></span><br><span class="line">       <span class="comment"># To disable the cache, 0 MB needs to be assigned to the cacheSize.</span></span><br><span class="line">       <span class="attr">cacheSize:</span> <span class="number">64</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">history:</span></span><br><span class="line">    <span class="comment"># enableHistoryDatabase - options are true or false</span></span><br><span class="line">    <span class="comment"># Indicates if the history of key updates should be stored.</span></span><br><span class="line">    <span class="comment"># All history &#x27;index&#x27; will be stored in goleveldb, regardless if using</span></span><br><span class="line">    <span class="comment"># CouchDB or alternate database for the state.</span></span><br><span class="line">    <span class="attr">enableHistoryDatabase:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">pvtdataStore:</span></span><br><span class="line">    <span class="comment"># the maximum db batch size for converting</span></span><br><span class="line">    <span class="comment"># the ineligible missing data entries to eligible missing data entries</span></span><br><span class="line">    <span class="attr">collElgProcMaxDbBatchSize:</span> <span class="number">5000</span></span><br><span class="line">    <span class="comment"># the minimum duration (in milliseconds) between writing</span></span><br><span class="line">    <span class="comment"># two consecutive db batches for converting the ineligible missing data entries to eligible missing data entries</span></span><br><span class="line">    <span class="attr">collElgProcDbBatchesInterval:</span> <span class="number">1000</span></span><br><span class="line">    <span class="comment"># The missing data entries are classified into two categories:</span></span><br><span class="line">    <span class="comment"># (1) prioritized</span></span><br><span class="line">    <span class="comment"># (2) deprioritized</span></span><br><span class="line">    <span class="comment"># Initially, all missing data are in the prioritized list. When the</span></span><br><span class="line">    <span class="comment"># reconciler is unable to fetch the missing data from other peers,</span></span><br><span class="line">    <span class="comment"># the unreconciled missing data would be moved to the deprioritized list.</span></span><br><span class="line">    <span class="comment"># The reconciler would retry deprioritized missing data after every</span></span><br><span class="line">    <span class="comment"># deprioritizedDataReconcilerInterval (unit: minutes). Note that the</span></span><br><span class="line">    <span class="comment"># interval needs to be greater than the reconcileSleepInterval</span></span><br><span class="line">    <span class="attr">deprioritizedDataReconcilerInterval:</span> <span class="string">60m</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">snapshots:</span></span><br><span class="line">    <span class="comment"># Path on the file system where peer will store ledger snapshots</span></span><br><span class="line">    <span class="attr">rootDir:</span> <span class="string">/var/hyperledger/production/snapshots</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    Operations section</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="attr">operations:</span></span><br><span class="line">    <span class="comment"># host and port for the operations server</span></span><br><span class="line">    <span class="attr">listenAddress:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9443</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># TLS configuration for the operations endpoint</span></span><br><span class="line">    <span class="attr">tls:</span></span><br><span class="line">        <span class="comment"># TLS enabled</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># path to PEM encoded server certificate for the operations server</span></span><br><span class="line">        <span class="attr">cert:</span></span><br><span class="line">            <span class="attr">file:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># path to PEM encoded server key for the operations server</span></span><br><span class="line">        <span class="attr">key:</span></span><br><span class="line">            <span class="attr">file:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># most operations service endpoints require client authentication when TLS</span></span><br><span class="line">        <span class="comment"># is enabled. clientAuthRequired requires client certificate authentication</span></span><br><span class="line">        <span class="comment"># at the TLS layer to access all resources.</span></span><br><span class="line">        <span class="attr">clientAuthRequired:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># paths to PEM encoded ca certificates to trust for client authentication</span></span><br><span class="line">        <span class="attr">clientRootCAs:</span></span><br><span class="line">            <span class="attr">files:</span> []</span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    Metrics section</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="attr">metrics:</span></span><br><span class="line">    <span class="comment"># metrics provider is one of statsd, prometheus, or disabled</span></span><br><span class="line">    <span class="attr">provider:</span> <span class="string">disabled</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># statsd configuration</span></span><br><span class="line">    <span class="attr">statsd:</span></span><br><span class="line">        <span class="comment"># network type: tcp or udp</span></span><br><span class="line">        <span class="attr">network:</span> <span class="string">udp</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># statsd server address</span></span><br><span class="line">        <span class="attr">address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8125</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># the interval at which locally cached counters and gauges are pushed</span></span><br><span class="line">        <span class="comment"># to statsd; timings are pushed immediately</span></span><br><span class="line">        <span class="attr">writeInterval:</span> <span class="string">10s</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># prefix is prepended to all emitted statsd metrics</span></span><br><span class="line">        <span class="attr">prefix:</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-orderer-yaml"><a href="#3-2-orderer-yaml" class="headerlink" title="3.2 orderer.yaml"></a>3.2 orderer.yaml</h4><p>文件：fabric-sample/config/<strong>orderer.yaml</strong></p>
<p>作用：</p>
<ul>
<li>Orderer 节点的各项配置</li>
<li></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Orderer Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 这将控制orderer的类型和配置。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">General:</span></span><br><span class="line">    <span class="comment"># Listen address: The IP on which to bind to listen.</span></span><br><span class="line">    <span class="attr">ListenAddress:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Listen port: The port on which to bind to listen.</span></span><br><span class="line">    <span class="attr">ListenPort:</span> <span class="number">7050</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># TLS: GRPC服务器的TLS设置.</span></span><br><span class="line">    <span class="attr">TLS:</span></span><br><span class="line">        <span class="comment"># 需要服务器端TLS</span></span><br><span class="line">        <span class="attr">Enabled:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># PrivateKey控制TLS证书私钥的文件位置。</span></span><br><span class="line">        <span class="attr">PrivateKey:</span> <span class="string">tls/server.key</span></span><br><span class="line">        <span class="comment"># Certificate 控制服务器TLS证书的文件位置.</span></span><br><span class="line">        <span class="attr">Certificate:</span> <span class="string">tls/server.crt</span></span><br><span class="line">        <span class="comment"># RootCAs包含一个附加根证书列表，用于在出站连接期间验证其他orderer节点的证书。</span></span><br><span class="line">        <span class="comment"># 它不需要设置，但可用于增加每个通道配置的MSP中可用的TLS CA证书集。</span></span><br><span class="line">        <span class="attr">RootCAs:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">tls/ca.crt</span></span><br><span class="line">        <span class="comment"># 为入站连接要求客户端证书/mutual TLS.</span></span><br><span class="line">        <span class="attr">ClientAuthRequired:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># 如果启用了相互TLS，ClientRootCAs将包含用于验证客户端连接证书的其他根证书的列表。</span></span><br><span class="line">				<span class="comment"># 它不需要设置，但可用于增加每个通道配置的MSP中可用的TLS CA证书集。</span></span><br><span class="line">        <span class="attr">ClientRootCAs:</span></span><br><span class="line">    <span class="comment"># Keepalive settings GRPC服务器.</span></span><br><span class="line">    <span class="attr">Keepalive:</span></span><br><span class="line">        <span class="comment"># ServerMinInterval 客户端ping之间允许的最短时间。</span></span><br><span class="line">        <span class="comment"># 如果客户端更频繁地发送ping，服务器将断开它们的连接。</span></span><br><span class="line">        <span class="attr">ServerMinInterval:</span> <span class="string">60s</span></span><br><span class="line">        <span class="comment"># ServerInterval is the time between pings to clients.</span></span><br><span class="line">        <span class="attr">ServerInterval:</span> <span class="string">7200s</span></span><br><span class="line">        <span class="comment"># ServerTimeout is the duration the server waits for a response from</span></span><br><span class="line">        <span class="comment"># a client before closing the connection.</span></span><br><span class="line">        <span class="attr">ServerTimeout:</span> <span class="string">20s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 由于所有节点都应该一致，建议将MaxRecVMGSize和MaxSendMsgSize的默认值保持为100MB</span></span><br><span class="line">    <span class="comment"># GRPC服务器和客户端可以接收的最大消息大小（字节）</span></span><br><span class="line">    <span class="attr">MaxRecvMsgSize:</span> <span class="number">104857600</span></span><br><span class="line">    <span class="comment"># GRPC服务器和客户端可以发送的最大消息大小（字节）</span></span><br><span class="line">    <span class="attr">MaxSendMsgSize:</span> <span class="number">104857600</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 与其他ordering服务节点（如基于Raft的订购服务）通信的ordering服务节点的群集设置。</span></span><br><span class="line">    <span class="attr">Cluster:</span></span><br><span class="line">        <span class="comment"># SendBufferSize is the maximum number of messages in the egress buffer.</span></span><br><span class="line">        <span class="comment"># Consensus messages are dropped if the buffer is full, and transaction</span></span><br><span class="line">        <span class="comment"># messages are waiting for space to be freed.</span></span><br><span class="line">        <span class="attr">SendBufferSize:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ClientCertificate governs the file location of the client TLS certificate</span></span><br><span class="line">        <span class="comment"># used to establish mutual TLS connections with other ordering service nodes.</span></span><br><span class="line">        <span class="comment"># If not set, the server General.TLS.Certificate is re-used.</span></span><br><span class="line">        <span class="attr">ClientCertificate:</span></span><br><span class="line">        <span class="comment"># ClientPrivateKey governs the file location of the private key of the client TLS certificate.</span></span><br><span class="line">        <span class="comment"># If not set, the server General.TLS.PrivateKey is re-used.</span></span><br><span class="line">        <span class="attr">ClientPrivateKey:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># The below 4 properties should be either set together, or be unset together.</span></span><br><span class="line">        <span class="comment"># If they are set, then the orderer node uses a separate listener for intra-cluster</span></span><br><span class="line">        <span class="comment"># communication. If they are unset, then the general orderer listener is used.</span></span><br><span class="line">        <span class="comment"># This is useful if you want to use a different TLS server certificates on the</span></span><br><span class="line">        <span class="comment"># client-facing and the intra-cluster listeners.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ListenPort defines the port on which the cluster listens to connections.</span></span><br><span class="line">        <span class="attr">ListenPort:</span></span><br><span class="line">        <span class="comment"># ListenAddress defines the IP on which to listen to intra-cluster communication.</span></span><br><span class="line">        <span class="attr">ListenAddress:</span></span><br><span class="line">        <span class="comment"># ServerCertificate defines the file location of the server TLS certificate used for intra-cluster</span></span><br><span class="line">        <span class="comment"># communication.</span></span><br><span class="line">        <span class="attr">ServerCertificate:</span></span><br><span class="line">        <span class="comment"># ServerPrivateKey defines the file location of the private key of the TLS certificate.</span></span><br><span class="line">        <span class="attr">ServerPrivateKey:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Bootstrap method: 指定获取引导块系统通道的方法。该选项可以是以下选项之一：</span></span><br><span class="line">    <span class="comment">#   &quot;file&quot; - 包含系统通道的genesis块或config块的文件的路径</span></span><br><span class="line">    <span class="comment">#   &quot;none&quot; - 允许订购方在没有系统通道配置的情况下启动</span></span><br><span class="line">    <span class="attr">BootstrapMethod:</span> <span class="string">file</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Bootstrap file: 包含引导块的文件，用于初始化Order系统通道，引导方法设置为&quot;file&quot;.  </span></span><br><span class="line">    <span class="comment"># 引导文件可以是genesis块，也可以是一些共识方法（如Raft）的后期引导的配置块。</span></span><br><span class="line">    <span class="comment"># 通过更新$FABRIC_CFG_PATH/configtx和使用带有-outputBlock选项的configtxgen命令</span></span><br><span class="line">    <span class="comment"># 生成genesis块。 如果未指定，则默认为文件“genesisblock”（在$FABRIC_CFG_PATH目录中）.</span></span><br><span class="line">    <span class="attr">BootstrapFile:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># LocalMSPDir是查找订购方所需的私有加密资料的地方。</span></span><br><span class="line">    <span class="comment"># 它在这里设置为相对，作为开发环境的默认设置，但应该更改为生产中的实际位置。</span></span><br><span class="line">    <span class="attr">LocalMSPDir:</span> <span class="string">msp</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># LocalMSPID是向MSP管理器注册本地MSP材料的标识。</span></span><br><span class="line">    <span class="comment"># 重要提示：订购方的本地MSP ID需要与订购方系统频道的/channel/orderer配置中定义的</span></span><br><span class="line">    <span class="comment"># 其中一个组织的MSP ID匹配。在提供的示例配置中定义的示例组织的MSP ID为“SampleOrg”。</span></span><br><span class="line">    <span class="attr">LocalMSPID:</span> <span class="string">SampleOrg</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 为Go“pprof”评测启用HTTP服务 as documented at:</span></span><br><span class="line">    <span class="comment"># https://golang.org/pkg/net/http/pprof</span></span><br><span class="line">    <span class="attr">Profile:</span></span><br><span class="line">        <span class="attr">Enabled:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">Address:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:6060</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># BCCSP配置区块链加密服务提供商。</span></span><br><span class="line">    <span class="attr">BCCSP:</span></span><br><span class="line">        <span class="comment"># Default specifies the preferred blockchain crypto service provider</span></span><br><span class="line">        <span class="comment"># to use. If the preferred provider is not available, the software</span></span><br><span class="line">        <span class="comment"># based provider (&quot;SW&quot;) will be used.</span></span><br><span class="line">        <span class="comment"># Valid providers are:</span></span><br><span class="line">        <span class="comment">#  - SW: a software based crypto provider</span></span><br><span class="line">        <span class="comment">#  - PKCS11: a CA hardware security module crypto provider.</span></span><br><span class="line">        <span class="attr">Default:</span> <span class="string">SW</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># SW configures the software based blockchain crypto provider.</span></span><br><span class="line">        <span class="attr">SW:</span></span><br><span class="line">            <span class="comment"># <span class="doctag">TODO:</span> The default Hash and Security level needs refactoring to be</span></span><br><span class="line">            <span class="comment"># fully configurable. Changing these defaults requires coordination</span></span><br><span class="line">            <span class="comment"># SHA2 is hardcoded in several places, not only BCCSP</span></span><br><span class="line">            <span class="attr">Hash:</span> <span class="string">SHA2</span></span><br><span class="line">            <span class="attr">Security:</span> <span class="number">256</span></span><br><span class="line">            <span class="comment"># Location of key store. If this is unset, a location will be</span></span><br><span class="line">            <span class="comment"># chosen using: &#x27;LocalMSPDir&#x27;/keystore</span></span><br><span class="line">            <span class="attr">FileKeyStore:</span></span><br><span class="line">                <span class="attr">KeyStore:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Settings for the PKCS#11 crypto provider (i.e. when DEFAULT: PKCS11)</span></span><br><span class="line">        <span class="attr">PKCS11:</span></span><br><span class="line">            <span class="comment"># Location of the PKCS11 module library</span></span><br><span class="line">            <span class="attr">Library:</span></span><br><span class="line">            <span class="comment"># Token Label</span></span><br><span class="line">            <span class="attr">Label:</span></span><br><span class="line">            <span class="comment"># User PIN</span></span><br><span class="line">            <span class="attr">Pin:</span></span><br><span class="line">            <span class="attr">Hash:</span></span><br><span class="line">            <span class="attr">Security:</span></span><br><span class="line">            <span class="attr">FileKeyStore:</span></span><br><span class="line">                <span class="attr">KeyStore:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 身份验证包含与验证客户端消息相关的配置参数</span></span><br><span class="line">    <span class="attr">Authentication:</span></span><br><span class="line">        <span class="comment"># the acceptable difference between the current server time and the</span></span><br><span class="line">        <span class="comment"># client&#x27;s time as specified in a client request message</span></span><br><span class="line">        <span class="attr">TimeWindow:</span> <span class="string">15m</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   SECTION: File Ledger</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 本节适用于文件分类账FileLedger的配置.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">FileLedger:</span></span><br><span class="line">    <span class="comment"># Location: The directory to store the blocks in.</span></span><br><span class="line">    <span class="attr">Location:</span> <span class="string">/var/hyperledger/production/orderer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   SECTION: Kafka</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 本节适用于基于卡夫卡的orderer的配置，以及它与卡夫卡集群的互动。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Kafka:</span></span><br><span class="line">    <span class="attr">Retry:</span></span><br><span class="line">        <span class="attr">ShortInterval:</span> <span class="string">5s</span></span><br><span class="line">        <span class="attr">ShortTotal:</span> <span class="string">10m</span></span><br><span class="line">        <span class="attr">LongInterval:</span> <span class="string">5m</span></span><br><span class="line">        <span class="attr">LongTotal:</span> <span class="string">12h</span></span><br><span class="line">        <span class="attr">NetworkTimeouts:</span></span><br><span class="line">            <span class="attr">DialTimeout:</span> <span class="string">10s</span></span><br><span class="line">            <span class="attr">ReadTimeout:</span> <span class="string">10s</span></span><br><span class="line">            <span class="attr">WriteTimeout:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">Metadata:</span></span><br><span class="line">            <span class="attr">RetryBackoff:</span> <span class="string">250ms</span></span><br><span class="line">            <span class="attr">RetryMax:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">Producer:</span></span><br><span class="line">            <span class="attr">RetryBackoff:</span> <span class="string">100ms</span></span><br><span class="line">            <span class="attr">RetryMax:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">Consumer:</span></span><br><span class="line">            <span class="attr">RetryBackoff:</span> <span class="string">2s</span></span><br><span class="line">    <span class="attr">Topic:</span></span><br><span class="line">        <span class="attr">ReplicationFactor:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">Verbose:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">TLS:</span></span><br><span class="line">      <span class="attr">Enabled:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">PrivateKey:</span></span><br><span class="line">      <span class="attr">Certificate:</span></span><br><span class="line">      <span class="attr">RootCAs:</span></span><br><span class="line">    <span class="attr">SASLPlain:</span></span><br><span class="line">      <span class="attr">Enabled:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">User:</span></span><br><span class="line">      <span class="attr">Password:</span></span><br><span class="line">    <span class="attr">Version:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Debug Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 这将控制orderer的调试选项</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Debug:</span></span><br><span class="line">    <span class="attr">BroadcastTraceDir:</span></span><br><span class="line">    <span class="attr">DeliverTraceDir:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Operations Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 这将为orderer配置操作服务器端点</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Operations:</span></span><br><span class="line">    <span class="attr">ListenAddress:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8443</span></span><br><span class="line">    <span class="attr">TLS:</span></span><br><span class="line">        <span class="attr">Enabled:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">Certificate:</span></span><br><span class="line">        <span class="attr">PrivateKey:</span></span><br><span class="line">        <span class="attr">ClientAuthRequired:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">ClientRootCAs:</span> []</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Metrics Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 这将为订购方配置metrics集合</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Metrics:</span></span><br><span class="line">    <span class="attr">Provider:</span> <span class="string">disabled</span></span><br><span class="line">    <span class="attr">Statsd:</span></span><br><span class="line">      <span class="attr">Network:</span> <span class="string">udp</span></span><br><span class="line">      <span class="attr">Address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8125</span></span><br><span class="line">      <span class="attr">WriteInterval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">Prefix:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Admin Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 这将为orderer配置Admin服务器端点</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Admin:</span></span><br><span class="line">    <span class="attr">ListenAddress:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9443</span></span><br><span class="line">    <span class="attr">TLS:</span></span><br><span class="line">        <span class="attr">Enabled:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">Certificate:</span></span><br><span class="line">        <span class="attr">PrivateKey:</span></span><br><span class="line">        <span class="attr">ClientAuthRequired:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">ClientRootCAs:</span> []</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Channel participation API Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 这为订购方提供了通道参与API配置。</span></span><br><span class="line"><span class="comment">#   - Channel 参与使用Admin服务的ListenAddress和TLS设置。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">ChannelParticipation:</span></span><br><span class="line">    <span class="attr">Enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">MaxRequestBodySize:</span> <span class="number">1</span> <span class="string">MB</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Consensus Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - 本节包含共识插件的配置选项。它对订购方来说是不透明的，完全取决于一致意见的实现。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Consensus:</span></span><br><span class="line">    <span class="attr">WALDir:</span> <span class="string">/var/hyperledger/production/orderer/etcdraft/wal</span></span><br><span class="line">    <span class="attr">SnapDir:</span> <span class="string">/var/hyperledger/production/orderer/etcdraft/snapshot</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-configtx-yaml"><a href="#3-3-configtx-yaml" class="headerlink" title="3.3 configtx.yaml"></a>3.3 configtx.yaml</h4><blockquote>
<p>Hyperledger Fabric区块链网络运维工具configtxgen用于<strong>生成通道创世块或通道交易的配置文件</strong>，configtx.yaml的内容直接决定了所生成的创世区块的内容。</p>
<p>文件：test-network/configtx/<strong>configtx.yaml</strong></p>
</blockquote>
<p>作用：</p>
<ul>
<li><p>生成启动Orderer 需要的初始区块，并支持检查区块内容</p>
</li>
<li><p>生成创建应用通道需要的配置交易，并支持检查交易内容</p>
</li>
<li><p>生成锚点Peer 的更新配置交易</p>
</li>
<li><p>一般包括六个部分：Organizations 、Capabilities、Application、Orderer、Channel、Profiles </p>
<ul>
<li><p>Organizations配置段用来定义组织机构实体，以便在后续配置中引用。例如，下面的配置文件中，定义了SampleOrg机构，可以分别使用SampleOrg引用其配置</p>
</li>
<li><p>Capabilities段用来定义fabric网络的能力。这是版本v1.0.0引入的一个新的配置段，当与版本v1.0.x的对等节点与排序节点混合组网时不可使用。</p>
<p>Capabilities段定义了fabric程序要加入网络所必须支持的特性。例如，如果添加了一个新的MSP类型，那么更新的程序可能会根据该类型识别并验证签名，但是老版本的程序就没有办法验证这些交易。这可能导致不同版本的fabric程序中维护的世界状态不一致。</p>
<p>因此，通过定义通道的能力，就明确了不满足该能力要求的fabric程序，将无法处理交易，除非升级到新的版本。对于v1.0.x的程序而言，如果在Capabilities段定义了任何能力，即使声明不需要支持这些能力，都会导致其有意崩溃。</p>
</li>
<li><p>Application配置段用来定义要写入创世区块或配置交易的应用参数。</p>
</li>
<li><p>Orderer配置段用来定义要编码写入创世区块或通道交易的排序节点参数。</p>
</li>
<li><p>Channel配置段用来定义要写入创世区块或配置交易的通道参数。</p>
</li>
<li><p>Profiles配置段用来定义用于configtxgen工具的配置入口。包含委员会（consortium）的配置入口可以用来生成排序节点的创世区块。如果在排序节点的创世区块中正确定义了consortium的成员，那么可以仅使用机构成员名称和委员会的名称来生成通道创建请求。</p>
</li>
</ul>
</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lisemi/article/details/94637264">https://blog.csdn.net/lisemi/article/details/94637264</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   ORGANIZATIONS</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   本节定义了可在配置配置文件中引用的组织标识。</span></span><br><span class="line"><span class="comment">#   它是默认的，这部分包含示例配置MSP定义的单一引用。</span></span><br><span class="line"><span class="comment">#   对于生产部署，应该删除这部分配置，并以新网络成员的MSP定义来替代它。</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Organizations:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleOrg使用sampleconfig定义MSP。永远不要使用它但可作为其他定义的模板。</span></span><br><span class="line">    <span class="comment"># 定义Orderer组织【&amp;OrdererOrg 这类语法类似 Go的中的指针及对象地址， 此处是被Profiles 中的 - *OrdererOrg 所引用，以下均为类似做法】</span></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">&amp;SampleOrg</span></span><br><span class="line">				<span class="comment">#名称是在channel配置事务中引用此组织的关键字。可以包括字母数字字符以及点和破折号。</span></span><br><span class="line">        <span class="attr">Name:</span> <span class="string">SampleOrg</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#SkipAsForeign可设置为true，用于组织定义，这些定义将在channel创建期间从orderer系统渠道继承。</span></span><br><span class="line">        <span class="comment">#当一个组织的管理员无法访问其他组织的MSP目录，想要创建一个channel时，这尤其有用。</span></span><br><span class="line">        <span class="comment">#注意：对于块创建中包含的组织，此属性必须始终设置为false。</span></span><br><span class="line">        <span class="attr">SkipAsForeign:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ID是引用该组织MSP定义的键。ID可以包括字母数字字符以及点和破折号</span></span><br><span class="line">        <span class="attr">ID:</span> <span class="string">SampleOrg</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># MSPDir是包含MSP配置的文件系统路径，由cryptogen工具生成的Orderer的 MSP 证书目录路径</span></span><br><span class="line">        <span class="attr">MSPDir:</span> <span class="string">msp</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Policies 定义了配置树的此级别上的策略集</span></span><br><span class="line">        <span class="comment"># 对于组织策略，其规范路径通常是</span></span><br><span class="line">        <span class="comment"># /Channel/&lt;Application|Orderer&gt;/&lt;OrgName&gt;/&lt;PolicyName&gt;</span></span><br><span class="line">        <span class="attr">Policies:</span> <span class="meta">&amp;SampleOrgPolicies</span></span><br><span class="line">            <span class="attr">Readers:</span></span><br><span class="line">                <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">                <span class="comment"># If your MSP is configured with the new NodeOUs, you might</span></span><br><span class="line">                <span class="comment"># want to use a more specific rule like the following:</span></span><br><span class="line">                <span class="comment"># Rule: &quot;OR(&#x27;SampleOrg.admin&#x27;, &#x27;SampleOrg.peer&#x27;, &#x27;SampleOrg.client&#x27;)&quot;</span></span><br><span class="line">            <span class="attr">Writers:</span></span><br><span class="line">                <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">                <span class="comment"># If your MSP is configured with the new NodeOUs, you might</span></span><br><span class="line">                <span class="comment"># want to use a more specific rule like the following:</span></span><br><span class="line">                <span class="comment"># Rule: &quot;OR(&#x27;SampleOrg.admin&#x27;, &#x27;SampleOrg.client&#x27;)&quot;</span></span><br><span class="line">            <span class="attr">Admins:</span></span><br><span class="line">                <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.admin&#x27;)&quot;</span></span><br><span class="line">            <span class="attr">Endorsement:</span></span><br><span class="line">                <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># #OrderEndPoints是该组织运行的所有orderers的列表</span></span><br><span class="line">        <span class="comment"># clients和peers可以连接到这些orderers以分别推送事务和接收数据块。</span></span><br><span class="line">        <span class="attr">OrdererEndpoints:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;127.0.0.1:7050&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># AnchorPeers 定义了可用于跨组织gossip交流的peers的位置。</span></span><br><span class="line">        <span class="comment"># 注意，该值仅在应用程序部分上下文中的genesis block中编码。</span></span><br><span class="line">        <span class="attr">AnchorPeers:</span> <span class="comment"># 定义组织锚节点 用于跨组织 Gossip 通信</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">Host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">              <span class="attr">Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   CAPABILITIES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   本节定义fabric network的功能。这是v1.1.0的一个新概念，</span></span><br><span class="line"><span class="comment">#   不应该在带有v1.0.x版本orderers和peers的混合网络中使用。</span></span><br><span class="line"><span class="comment">#   功能定义了fabric二进制文件中必须提供的特性，以便该二进制文件安全地参与fabric网络。</span></span><br><span class="line"><span class="comment">#   例如，如果添加了新的MSP类型，较新的二进制文件可能会识别并验证来自该类型的签名，</span></span><br><span class="line"><span class="comment">#   而没有此支持的较老的二进制文件将无法验证这些交易。</span></span><br><span class="line"><span class="comment">#   这可能导致不同版本的fabric二进制文件具有不同的世界状态。</span></span><br><span class="line"><span class="comment">#   相反，为通道定义一个功能会通知那些没有这个功能的二进制文件，它们必须停止处理交易，直到它们被升级。</span></span><br><span class="line"><span class="comment">#   对于v1.0.x 版本，如果定义了任何功能(包括关闭所有功能的映射)，v1.0.x版本的节点可能会故意崩溃。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Capabilities:</span></span><br><span class="line">    <span class="comment"># 通道功能同时适用于orderers和peers，并且必须得到双方的支持。</span></span><br><span class="line">    <span class="comment"># 将功能的值设置为true以满足需要。</span></span><br><span class="line">    <span class="attr">Channel:</span> <span class="meta">&amp;ChannelCapabilities</span></span><br><span class="line">        <span class="comment"># ChannelV2.0是一个catchall标志，表示已确定在v2.0上运行的所有order和peer都需要的行为。</span></span><br><span class="line">        <span class="comment"># 但与之前版本中的订购者和对等方不兼容。</span></span><br><span class="line">        <span class="comment"># 在启用V2通道功能之前，请确保通道上的所有订购方和对等方处于V2或更高版本。</span></span><br><span class="line">        <span class="attr">V2_0:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Orderer功能只适用于Orderer，并且可以安全地与以前版本的peer节点一起使用。</span></span><br><span class="line">    <span class="comment"># 将功能的值设置为true以满足需要</span></span><br><span class="line">    <span class="attr">Orderer:</span> <span class="meta">&amp;OrdererCapabilities</span></span><br><span class="line">        <span class="comment"># Orderer的V1.1是一个用来表示确定被在v1.1.x中运行的所有orderers</span></span><br><span class="line">        <span class="comment"># 所需要的行为的catchall标志，但这与以前版本中的orderers不兼容。</span></span><br><span class="line">        <span class="comment"># 在启用V2.0 orderer功能之前，请确保通道上的所有order处于V2或更高版本。</span></span><br><span class="line">        <span class="attr">V2_0:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Application功能只应用于peer网络，并且可以安全地与以前的版本的orderers一起使用。</span></span><br><span class="line">    <span class="comment"># 将功能的值设置为true以满足需要</span></span><br><span class="line">    <span class="attr">Application:</span> <span class="meta">&amp;ApplicationCapabilities</span></span><br><span class="line">        <span class="comment"># Application的V2.0用来启用新的非向后兼容特性fabric V1.3的补丁</span></span><br><span class="line">        <span class="comment"># 在启用V2.0 orderer功能之前，请确保通道上的所有order处于V2或更高版本。</span></span><br><span class="line">        <span class="attr">V2_0:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   APPLICATION</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   本节为Application相关参数，定义要编码到配置交易或创世区块中的值</span></span><br><span class="line"><span class="comment">#   注意，只有在创建channel tx时才会用Application，否则是创建区块</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Application:</span> <span class="meta">&amp;ApplicationDefaults</span></span><br><span class="line">    <span class="attr">ACLs:</span> <span class="string">&amp;ACLsDefault</span> <span class="comment">#自定义被引用的地址</span></span><br><span class="line">        <span class="comment"># This section provides defaults for policies for various resources</span></span><br><span class="line">        <span class="comment"># in the system. These &quot;resources&quot; could be functions on system chaincodes</span></span><br><span class="line">        <span class="comment"># (e.g., &quot;GetBlockByNumber&quot; on the &quot;qscc&quot; system chaincode) or other resources</span></span><br><span class="line">        <span class="comment"># (e.g.,who can receive Block events). This section does NOT specify the resource&#x27;s</span></span><br><span class="line">        <span class="comment"># definition or API, but just the ACL policy for it.</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Users can override these defaults with their own policy mapping by defining the</span></span><br><span class="line">        <span class="comment"># mapping under ACLs in their channel definition</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#---New Lifecycle System Chaincode (_lifecycle) function to policy mapping for access control--#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for _lifecycle&#x27;s &quot;CheckCommitReadiness&quot; function</span></span><br><span class="line">        <span class="attr">_lifecycle/CheckCommitReadiness:</span> <span class="string">/Channel/Application/Writers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for _lifecycle&#x27;s &quot;CommitChaincodeDefinition&quot; function</span></span><br><span class="line">        <span class="attr">_lifecycle/CommitChaincodeDefinition:</span> <span class="string">/Channel/Application/Writers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for _lifecycle&#x27;s &quot;QueryChaincodeDefinition&quot; function</span></span><br><span class="line">        <span class="attr">_lifecycle/QueryChaincodeDefinition:</span> <span class="string">/Channel/Application/Writers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for _lifecycle&#x27;s &quot;QueryChaincodeDefinitions&quot; function</span></span><br><span class="line">        <span class="attr">_lifecycle/QueryChaincodeDefinitions:</span> <span class="string">/Channel/Application/Writers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#---Lifecycle System Chaincode (lscc) function to policy mapping for access control---#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for lscc&#x27;s &quot;getid&quot; function</span></span><br><span class="line">        <span class="attr">lscc/ChaincodeExists:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for lscc&#x27;s &quot;getdepspec&quot; function</span></span><br><span class="line">        <span class="attr">lscc/GetDeploymentSpec:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for lscc&#x27;s &quot;getccdata&quot; function</span></span><br><span class="line">        <span class="attr">lscc/GetChaincodeData:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL Policy for lscc&#x27;s &quot;getchaincodes&quot; function</span></span><br><span class="line">        <span class="attr">lscc/GetInstantiatedChaincodes:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#---Query System Chaincode (qscc) function to policy mapping for access control---#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for qscc&#x27;s &quot;GetChainInfo&quot; function</span></span><br><span class="line">        <span class="attr">qscc/GetChainInfo:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for qscc&#x27;s &quot;GetBlockByNumber&quot; function</span></span><br><span class="line">        <span class="attr">qscc/GetBlockByNumber:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for qscc&#x27;s  &quot;GetBlockByHash&quot; function</span></span><br><span class="line">        <span class="attr">qscc/GetBlockByHash:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for qscc&#x27;s &quot;GetTransactionByID&quot; function</span></span><br><span class="line">        <span class="attr">qscc/GetTransactionByID:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for qscc&#x27;s &quot;GetBlockByTxID&quot; function</span></span><br><span class="line">        <span class="attr">qscc/GetBlockByTxID:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#---Configuration System Chaincode (cscc) function to policy mapping for access control---#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for cscc&#x27;s &quot;GetConfigBlock&quot; function</span></span><br><span class="line">        <span class="attr">cscc/GetConfigBlock:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for cscc&#x27;s &quot;GetChannelConfig&quot; function</span></span><br><span class="line">        <span class="attr">cscc/GetChannelConfig:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#---Miscellaneous peer function to policy mapping for access control---#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for invoking chaincodes on peer</span></span><br><span class="line">        <span class="attr">peer/Propose:</span> <span class="string">/Channel/Application/Writers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for chaincode to chaincode invocation</span></span><br><span class="line">        <span class="attr">peer/ChaincodeToChaincode:</span> <span class="string">/Channel/Application/Writers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#---Events resource to policy mapping for access control###---#</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for sending block events</span></span><br><span class="line">        <span class="attr">event/Block:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ACL policy for sending filtered block events</span></span><br><span class="line">        <span class="attr">event/FilteredBlock:</span> <span class="string">/Channel/Application/Readers</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Organizations是定义为网络应用程序端参与者的组织列表</span></span><br><span class="line">    <span class="attr">Organizations:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Policies定义了在这个配置树级别的策略集</span></span><br><span class="line">    <span class="comment"># 对于组织策略，它们的规范路径通常是</span></span><br><span class="line">    <span class="comment">#   /Channel/Application/&lt;PolicyName&gt;</span></span><br><span class="line">    <span class="attr">Policies:</span> <span class="meta">&amp;ApplicationDefaultPolicies</span></span><br><span class="line">        <span class="attr">LifecycleEndorsement:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Endorsement&quot;</span></span><br><span class="line">        <span class="attr">Endorsement:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Endorsement&quot;</span></span><br><span class="line">        <span class="attr">Readers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Readers&quot;</span></span><br><span class="line">        <span class="attr">Writers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Writers&quot;</span></span><br><span class="line">        <span class="attr">Admins:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Admins&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Capabilities 描述了应用程序级别的功能，</span></span><br><span class="line">    <span class="comment"># 请参阅本文件其他地方的Capabilities部分提供了完整的描述</span></span><br><span class="line">    <span class="attr">Capabilities:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationCapabilities</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   ORDERER</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   本节为orderer相关参数定义要编码到配置交易或创世区块中的值</span></span><br><span class="line"><span class="comment">#   Orderer 默认是 solo 的且不包含任何组织 【主要被 Profiles 部分引用】</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Orderer:</span> <span class="meta">&amp;OrdererDefaults</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Orderer Type: 要启动的Orderer实现类型</span></span><br><span class="line">    <span class="comment"># 可用的类型有“solo”、“kafka”、“etcdraft”.</span></span><br><span class="line">    <span class="attr">OrdererType:</span> <span class="string">solo</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Addresses过去是clients和peers可以连接到的订购方orderer地址列表。</span></span><br><span class="line">    <span class="comment"># 但是，这不允许clients将orderer地址和orderer组织关联起来，这对TLS验证等工作很有用。</span></span><br><span class="line">    <span class="comment"># 现在，指定订购者地址的首选方法是在组织定义中包含OrderEndPoints项</span></span><br><span class="line">    <span class="attr">Addresses:</span></span><br><span class="line">        <span class="comment"># - 127.0.0.1:7050</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 区块打包最大超时时间</span></span><br><span class="line">    <span class="attr">BatchTimeout:</span> <span class="string">2s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 区块打包的最大包含交易数</span></span><br><span class="line">    <span class="attr">BatchSize:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># # 一个区块里最大的交易数</span></span><br><span class="line">        <span class="attr">MaxMessageCount:</span> <span class="number">500</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Absolute Max Bytes: 一个区块的最大字节数</span></span><br><span class="line">        <span class="attr">AbsoluteMaxBytes:</span> <span class="number">10</span> <span class="string">MB</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Preferred Max Bytes: The preferred maximum number of bytes allowed</span></span><br><span class="line">        <span class="comment"># for the serialized messages in a batch. Roughly, this field may be considered</span></span><br><span class="line">        <span class="comment"># the best effort maximum size of a batch. A batch will fill with messages</span></span><br><span class="line">        <span class="comment"># until this size is reached (or the max message count, or batch timeout is</span></span><br><span class="line">        <span class="comment"># exceeded).  If adding a new message to the batch would cause the batch to</span></span><br><span class="line">        <span class="comment"># exceed the preferred max bytes, then the current batch is closed and written</span></span><br><span class="line">        <span class="comment"># to a block, and a new batch containing the new message is created.  If a</span></span><br><span class="line">        <span class="comment"># message larger than the preferred max bytes is received, then its batch</span></span><br><span class="line">        <span class="comment"># will contain only that message.  Because messages may be larger than</span></span><br><span class="line">        <span class="comment"># preferred max bytes (up to AbsoluteMaxBytes), some batches may exceed</span></span><br><span class="line">        <span class="comment"># the preferred max bytes, but will always contain exactly one transaction.</span></span><br><span class="line">        <span class="attr">PreferredMaxBytes:</span> <span class="number">2</span> <span class="string">MB</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Max Channels is the maximum number of channels to allow on the ordering</span></span><br><span class="line">    <span class="comment"># network. When set to 0, this implies no maximum number of channels.</span></span><br><span class="line">    <span class="attr">MaxChannels:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Kafka:</span> <span class="comment"># kafka的 brokens 服务地址 允许有多个</span></span><br><span class="line">        <span class="comment"># Brokers: A list of Kafka brokers to which the orderer connects. Edit</span></span><br><span class="line">        <span class="comment"># this list to identify the brokers of the ordering service.</span></span><br><span class="line">        <span class="comment"># <span class="doctag">NOTE:</span> Use IP:port notation.</span></span><br><span class="line">        <span class="attr">Brokers:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">kafka0:9092</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">kafka1:9092</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">kafka2:9092</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># EtcdRaft defines configuration which must be set when the &quot;etcdraft&quot;</span></span><br><span class="line">    <span class="comment"># orderertype is chosen.</span></span><br><span class="line">    <span class="attr">EtcdRaft:</span></span><br><span class="line">        <span class="comment"># The set of Raft replicas for this network. For the etcd/raft-based</span></span><br><span class="line">        <span class="comment"># implementation, we expect every replica to also be an OSN. Therefore,</span></span><br><span class="line">        <span class="comment"># a subset of the host:port items enumerated in this list should be</span></span><br><span class="line">        <span class="comment"># replicated under the Orderer.Addresses key above.</span></span><br><span class="line">        <span class="attr">Consenters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">Host:</span> <span class="string">raft0.example.com</span></span><br><span class="line">              <span class="attr">Port:</span> <span class="number">7050</span></span><br><span class="line">              <span class="attr">ClientTLSCert:</span> <span class="string">path/to/ClientTLSCert0</span></span><br><span class="line">              <span class="attr">ServerTLSCert:</span> <span class="string">path/to/ServerTLSCert0</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">Host:</span> <span class="string">raft1.example.com</span></span><br><span class="line">              <span class="attr">Port:</span> <span class="number">7050</span></span><br><span class="line">              <span class="attr">ClientTLSCert:</span> <span class="string">path/to/ClientTLSCert1</span></span><br><span class="line">              <span class="attr">ServerTLSCert:</span> <span class="string">path/to/ServerTLSCert1</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">Host:</span> <span class="string">raft2.example.com</span></span><br><span class="line">              <span class="attr">Port:</span> <span class="number">7050</span></span><br><span class="line">              <span class="attr">ClientTLSCert:</span> <span class="string">path/to/ClientTLSCert2</span></span><br><span class="line">              <span class="attr">ServerTLSCert:</span> <span class="string">path/to/ServerTLSCert2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Options to be specified for all the etcd/raft nodes. The values here</span></span><br><span class="line">        <span class="comment"># are the defaults for all new channels and can be modified on a</span></span><br><span class="line">        <span class="comment"># per-channel basis via configuration updates.</span></span><br><span class="line">        <span class="attr">Options:</span></span><br><span class="line">            <span class="comment"># TickInterval is the time interval between two Node.Tick invocations.</span></span><br><span class="line">            <span class="attr">TickInterval:</span> <span class="string">500ms</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ElectionTick is the number of Node.Tick invocations that must pass</span></span><br><span class="line">            <span class="comment"># between elections. That is, if a follower does not receive any</span></span><br><span class="line">            <span class="comment"># message from the leader of current term before ElectionTick has</span></span><br><span class="line">            <span class="comment"># elapsed, it will become candidate and start an election.</span></span><br><span class="line">            <span class="comment"># ElectionTick must be greater than HeartbeatTick.</span></span><br><span class="line">            <span class="attr">ElectionTick:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># HeartbeatTick is the number of Node.Tick invocations that must</span></span><br><span class="line">            <span class="comment"># pass between heartbeats. That is, a leader sends heartbeat</span></span><br><span class="line">            <span class="comment"># messages to maintain its leadership every HeartbeatTick ticks.</span></span><br><span class="line">            <span class="attr">HeartbeatTick:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># MaxInflightBlocks limits the max number of in-flight append messages</span></span><br><span class="line">            <span class="comment"># during optimistic replication phase.</span></span><br><span class="line">            <span class="attr">MaxInflightBlocks:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># SnapshotIntervalSize defines number of bytes per which a snapshot is taken</span></span><br><span class="line">            <span class="attr">SnapshotIntervalSize:</span> <span class="number">16</span> <span class="string">MB</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Organizations是组织的列表，组织被定义为网络的orderer方的参与者</span></span><br><span class="line">    <span class="attr">Organizations:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  Policies定义了在这个配置树级别的策略集</span></span><br><span class="line">    <span class="comment"># 对于Orderer策略，它们的规范路径通常是</span></span><br><span class="line">    <span class="comment"># /Channel/Orderer/&lt;PolicyName&gt;</span></span><br><span class="line">    <span class="attr">Policies:</span></span><br><span class="line">        <span class="attr">Readers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Readers&quot;</span></span><br><span class="line">        <span class="attr">Writers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Writers&quot;</span></span><br><span class="line">        <span class="attr">Admins:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Admins&quot;</span></span><br><span class="line">        <span class="comment"># BlockValidation指定必须包含来自orderer的哪些签名，以便peer对其进行验证。</span></span><br><span class="line">        <span class="attr">BlockValidation:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Writers&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Capabilities describes the orderer level capabilities, see the</span></span><br><span class="line">    <span class="comment"># dedicated Capabilities section elsewhere in this file for a full</span></span><br><span class="line">    <span class="comment"># description</span></span><br><span class="line">    <span class="attr">Capabilities:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererCapabilities</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   CHANNEL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   本节为channel相关参数定义要编码到配置交易或创世区块中的值</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Channel:</span> <span class="meta">&amp;ChannelDefaults</span></span><br><span class="line">    <span class="comment"># Policies定义了在这个配置树级别的策略集</span></span><br><span class="line">    <span class="comment"># 对于Channel策略，它们的规范路径通常是/Channel/&lt;PolicyName&gt;</span></span><br><span class="line">    <span class="attr">Policies:</span></span><br><span class="line">        <span class="comment"># 谁可能调用&#x27;Deliver&#x27; API</span></span><br><span class="line">        <span class="attr">Readers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Readers&quot;</span></span><br><span class="line">        <span class="comment"># 谁可能调用&#x27;Broadcast&#x27; API</span></span><br><span class="line">        <span class="attr">Writers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Writers&quot;</span></span><br><span class="line">        <span class="comment"># 默认，谁可能调用在这个配置级别的元素</span></span><br><span class="line">        <span class="attr">Admins:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Admins&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Capabilities描述通道级功能，有关详细描述，请参阅此文件中其他部分的专用功能部分</span></span><br><span class="line">    <span class="attr">Capabilities:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelCapabilities</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   PROFILES</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   这里可以编码不同的配置概要文件，将其指定为configtxgen工具的参数</span></span><br><span class="line"><span class="comment">#   指定联合体的配置文件将用于生成orderer genesis块。 </span></span><br><span class="line"><span class="comment">#   在orderer genesis模块中定义了正确的联合体成员后，</span></span><br><span class="line"><span class="comment">#   可以仅使用组织成员名称和联盟名称生成channel创建请求</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Profiles:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleSingleMSPSolo defines a configuration which uses the Solo orderer,</span></span><br><span class="line">    <span class="comment"># and contains a single MSP definition (the MSP sampleconfig).</span></span><br><span class="line">    <span class="comment"># The Consortium SampleConsortium has only a single member, SampleOrg.</span></span><br><span class="line">    <span class="attr">SampleSingleMSPSolo:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="meta">*SampleOrg</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="attr">SampleConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="meta">*SampleOrg</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleSingleMSPKafka defines a configuration that differs from the</span></span><br><span class="line">    <span class="comment"># SampleSingleMSPSolo one only in that it uses the Kafka-based orderer.</span></span><br><span class="line">    <span class="attr">SampleSingleMSPKafka:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">OrdererType:</span> <span class="string">kafka</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="meta">*SampleOrg</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="attr">SampleConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="meta">*SampleOrg</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleInsecureSolo defines a configuration which uses the Solo orderer,</span></span><br><span class="line">    <span class="comment"># contains no MSP definitions, and allows all transactions and channel</span></span><br><span class="line">    <span class="comment"># creation requests for the consortium SampleConsortium.</span></span><br><span class="line">    <span class="attr">SampleInsecureSolo:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="attr">SampleConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleInsecureKafka defines a configuration that differs from the</span></span><br><span class="line">    <span class="comment"># SampleInsecureSolo one only in that it uses the Kafka-based orderer.</span></span><br><span class="line">    <span class="attr">SampleInsecureKafka:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">OrdererType:</span> <span class="string">kafka</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="attr">SampleConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleDevModeSolo defines a configuration which uses the Solo orderer,</span></span><br><span class="line">    <span class="comment"># contains the sample MSP as both orderer and consortium member, and</span></span><br><span class="line">    <span class="comment"># requires only basic membership for admin privileges. It also defines</span></span><br><span class="line">    <span class="comment"># an Application on the ordering system channel, which should usually</span></span><br><span class="line">    <span class="comment"># be avoided.</span></span><br><span class="line">    <span class="attr">SampleDevModeSolo:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                  <span class="attr">Policies:</span></span><br><span class="line">                      <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                      <span class="attr">Admins:</span></span><br><span class="line">                          <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                          <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">        <span class="attr">Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                  <span class="attr">Policies:</span></span><br><span class="line">                      <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                      <span class="attr">Admins:</span></span><br><span class="line">                          <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                          <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="attr">SampleConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                      <span class="attr">Policies:</span></span><br><span class="line">                          <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                          <span class="attr">Admins:</span></span><br><span class="line">                              <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                              <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleDevModeKafka defines a configuration that differs from the</span></span><br><span class="line">    <span class="comment"># SampleDevModeSolo one only in that it uses the Kafka-based orderer.</span></span><br><span class="line">    <span class="attr">SampleDevModeKafka:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">OrdererType:</span> <span class="string">kafka</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                  <span class="attr">Policies:</span></span><br><span class="line">                      <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                      <span class="attr">Admins:</span></span><br><span class="line">                          <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                          <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">        <span class="attr">Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                  <span class="attr">Policies:</span></span><br><span class="line">                      <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                      <span class="attr">Admins:</span></span><br><span class="line">                          <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                          <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="attr">SampleConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                      <span class="attr">Policies:</span></span><br><span class="line">                          <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                          <span class="attr">Admins:</span></span><br><span class="line">                              <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                              <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleSingleMSPChannel defines a channel with only the sample org as a</span></span><br><span class="line">    <span class="comment"># member. It is designed to be used in conjunction with SampleSingleMSPSolo</span></span><br><span class="line">    <span class="comment"># and SampleSingleMSPKafka orderer profiles.   Note, for channel creation</span></span><br><span class="line">    <span class="comment"># profiles, only the &#x27;Application&#x27; section and consortium # name are</span></span><br><span class="line">    <span class="comment"># considered.</span></span><br><span class="line">    <span class="attr">SampleSingleMSPChannel:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Consortium:</span> <span class="string">SampleConsortium</span></span><br><span class="line">        <span class="attr">Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleDevModeEtcdRaft defines a configuration that differs from the</span></span><br><span class="line">    <span class="comment"># SampleDevModeSolo one only in that it uses the etcd/raft-based orderer.</span></span><br><span class="line">    <span class="attr">SampleDevModeEtcdRaft:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">OrdererType:</span> <span class="string">etcdraft</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                  <span class="attr">Policies:</span></span><br><span class="line">                      <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                      <span class="attr">Admins:</span></span><br><span class="line">                          <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                          <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">        <span class="attr">Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                  <span class="attr">Policies:</span></span><br><span class="line">                      <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                      <span class="attr">Admins:</span></span><br><span class="line">                          <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                          <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="attr">SampleConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                      <span class="attr">Policies:</span></span><br><span class="line">                          <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                          <span class="attr">Admins:</span></span><br><span class="line">                              <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                              <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleAppChannelInsecureSolo defines an application channel configuration</span></span><br><span class="line">    <span class="comment"># which uses the Solo orderer and contains no MSP definitions. </span></span><br><span class="line">    <span class="attr">SampleAppChannelInsecureSolo:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">        <span class="attr">Application:</span> </span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleAppChannelEtcdRaft defines an application channel configuration </span></span><br><span class="line">    <span class="comment"># that uses the etcd/raft-based orderer.</span></span><br><span class="line">    <span class="attr">SampleAppChannelEtcdRaft:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">OrdererType:</span> <span class="string">etcdraft</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                  <span class="attr">Policies:</span></span><br><span class="line">                      <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                      <span class="attr">Admins:</span></span><br><span class="line">                          <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                          <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line">        <span class="attr">Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrg</span></span><br><span class="line">                  <span class="attr">Policies:</span></span><br><span class="line">                      <span class="string">&lt;&lt;:</span> <span class="meta">*SampleOrgPolicies</span></span><br><span class="line">                      <span class="attr">Admins:</span></span><br><span class="line">                          <span class="attr">Type:</span> <span class="string">Signature</span></span><br><span class="line">                          <span class="attr">Rule:</span> <span class="string">&quot;OR(&#x27;SampleOrg.member&#x27;)&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-4-crypto-config-yaml"><a href="#3-4-crypto-config-yaml" class="headerlink" title="3.4 crypto-config.yaml"></a>3.4 crypto-config.yaml</h4><blockquote>
<p>使用cryptogen工具及 crypto-config.yaml 配置文件，生成整个fabric网络的组织架构及对应的身份证书；在crypto-config.yaml 文件中我们定义了 整个fabric网络的组织结构，然后工具会根据定义的配置生成对应的组织结构及把对应的身份证书放置对应的目录下以便区分使用</p>
<p>文件：/fabric-samples/test-network/organizations/cryptogen</p>
</blockquote>
<blockquote>
<p>创建通道使用什么命令？命令的每个选项含义是什么？需要哪些环境变量？</p>
</blockquote>
<blockquote>
<p> 哪些环境变量决定命令是以什么组织的身份执行的？（MSP）</p>
</blockquote>
<blockquote>
<p>哪些环境变量决定命令连接到什么节点执行？（TLS）</p>
</blockquote>
<blockquote>
<p>系统通道和普通通道有什么区别？两者的作用分别是什么？</p>
</blockquote>
<blockquote>
<p>如何修改普通通道的配置？需要哪些命令？命令的含义及相关选项的含义是什么？普通通道配置有什么内容？</p>
</blockquote>
<blockquote>
<p>锚节点是什么？设置组织的锚节点用什么命令？命令的每个选项含义是什么？需要哪些环境变量？（参考14、15）</p>
</blockquote>
<blockquote>
<p>安装链码需要哪些命令？这些命令的次序和其选项的含义是什么？需要什么环境变量？</p>
</blockquote>
<h3 id="4-更新通道配置"><a href="#4-更新通道配置" class="headerlink" title="4. 更新通道配置"></a>4. 更新通道配置</h3><p>像许多复杂的系统一样，Hyperledger Fabric 网络由一些<strong>结构</strong>及其相关的<strong>过程</strong>组成。</p>
<ul>
<li><strong>Structure</strong>：包括用户（如管理员）、组织、peer 节点、排序节点、CA、智能合约以及应用程序。</li>
<li><strong>Process</strong>：结构相互作用的方式。其中最重要的是 <a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/policies/policies.html">策略</a>，这些规则控制着哪些用户可以在什么条件下执行什么操作。</li>
</ul>
<p>识别区块链网络的结构和管理结构如何相互作用的过程的信息位于<strong>通道配置</strong>中。这些配置由通道成员共同决定，并包含在提交给通道账本的区块中。通道配置可以使用 <code>configtxgen</code> 工具来构建，该工具使用 <code>configtx.yaml</code> 文件作为输入。你可以在此处<a target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric/blob/release-2.0/sampleconfig/configtx.yaml">查看 <code>configtx.yaml</code> 的样例文件</a>。</p>
<p>由于配置位于区块中（第一个区块被称为创世区块，它包含通道的最新配置），因此更新通道配置的过程（比如，通过添加成员来更改结构或者修改通道配置）被称为<strong>配置更新交易</strong>。</p>
<p>在生产网络中，通道的初始化配置由该通道的初始成员在外部决定，同样的，配置更新交易也通常是在外部讨论后由单个通道管理员提出。</p>
<p>通道是高度可配置的，但也有限制。某些与通道相关的内容（例如通道的名称）被确定后就无法再进行修改。而且修改我们在本主题中讨论的某个参数时需要满足通道配置中指定的相关策略。</p>
<p>在本节中，我们将查看一个通道配置示例，并展示那些可以更新的配置参数。</p>
<p>请注意：为简单起见，这里只展示了应用程序通道的配置。排序系统通道的配置与应用程序通道的配置非常相似，但不完全相同。不过当提取和编辑配置时，使用的基本规则、结构是相同的，你可以在<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/updating_capabilities.html">更新通道的功能级别</a>主题中查看相关内容。</p>
<h4 id="4-1-通道配置示例"><a href="#4-1-通道配置示例" class="headerlink" title="4.1 通道配置示例"></a>4.1 通道配置示例</h4><p>官方示例<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/config_update.html">https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/config_update.html</a></p>
<p>这种格式的配置看起来很吓人，但是只要你研究一下你就会发现，它是有逻辑结构的。</p>
<p>例如，让我们看一下关闭了若干标签后的配置。</p>
<p>请注意，这是应用程序通道的配置，而不是排序系统通道的配置。</p>
<p><img src="%E5%AF%92%E5%81%87Fabric.assets/sample_config.png" alt="Sample config simplified"></p>
<p>配置的结构现在应该更清晰了。你可以看到这些配置分组：<code>Channel</code>、<code>Application</code> 和 <code>Orderer</code>，以及与这些分组相关的配置参数（我们将在下一节中详细讨论这些配置参数），还可以看到表示组织的MSP所在的位置。请注意，<code>Channel</code> 配置分组位于 <code>Orderer</code> 下方。</p>
<h4 id="4-2-关于这些参数的更多信息"><a href="#4-2-关于这些参数的更多信息" class="headerlink" title="4.2 关于这些参数的更多信息"></a>4.2 关于这些参数的更多信息</h4><p>见官方文档<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/config_update.html">https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/config_update.html</a></p>
<p>某些配置值是排序系统通道中特有的。</p>
<ul>
<li><strong>Channel creation policy</strong>。 此参数用于定义策略值，该策略值将被设置为在联盟中定义的新通道的 Application group 的 mod_policy。系统将根据策略在新通道中的实例化值对附加到通道创建请求中的签名集进行检查，以确保通道创建是经过授权的。请注意，这个配置值只能在排序系统通道中设置。</li>
<li><strong>Channel restrictions</strong>。 此参数仅在排序系统通道中可编辑。排序节点可以分配的通道总数被定义为 <code>max_count</code>。这在使用弱联盟 <code>ChannelCreation</code> 策略的预生产环境中非常有用。</li>
</ul>
<h4 id="4-3-编辑配置"><a href="#4-3-编辑配置" class="headerlink" title="4.3 编辑配置"></a>4.3 编辑配置</h4><p>更新通道配置共有三步操作，从概念上来讲比较简单：</p>
<ol>
<li>获取最新的通道配置</li>
<li>创建修改后的通道配置</li>
<li>创建配置更新交易</li>
</ol>
<p>但是你将会发现，在这种概念上的简单之外，还伴随着一个有点复杂的过程。因此，有些用户可能选择将提取、转换和确定配置更新范围的过程脚本化。用户还可以选择如何修改通道配置：可以手动修改，也可以使用 <code>jq</code> 之类的工具进行修改。</p>
<p>我们提供了两个教程，这些教程专门用于编辑通道配置以实现特定的目标：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/channel_update_tutorial.html">向通道中添加组织</a>：展示向现有通道添加其他组织的过程。</li>
<li><a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/updating_a_channel.html">更新通道功能</a>：展示如何更新通道功能。</li>
</ul>
<p>在本主题中，我们将展示编辑通道配置的过程，该过程独立于配置更新的最终目标。</p>
<h5 id="4-3-1-为配置更新设置环境变量"><a href="#4-3-1-为配置更新设置环境变量" class="headerlink" title="4.3.1 为配置更新设置环境变量"></a>4.3.1 为配置更新设置环境变量</h5><p>在尝试使用示例命令前，请确保设置以下环境变量，这些环境变量取决于你部署的方式。请注意，必须为每个要更新的通道设置通道名称 <code>CH_NAME</code>，因为通道配置更新只能应用于要更新的通道的配置（排序系统通道除外，因为默认情况下，它的配置会被拷贝到应用程序通道的配置中）。</p>
<ul>
<li><code>CH_NAME</code>：要更新的通道的名称。</li>
<li><code>TLS_ROOT_CA</code>：提出配置更新的组织，其TLS CA的root CA证书的路径。</li>
<li><code>CORE_PEER_LOCALMSPID</code>：MSP的名称。</li>
<li><code>CORE_PEER_MSPCONFIGPATH</code>：组织MSP的绝对路径。</li>
<li><code>ORDERER_CONTAINER</code>：排序节点容器的名称。请注意，在定位排序服务时，你可以定位排序服务中任意一个活动的节点，你的请求将被自动转发给排序服务的 leader 节点。</li>
</ul>
<p>请注意：本主题将为各种要被提取、修改的 JSON 文件和 protobuf 文件提供默认名称（<code>config_block.pb</code>、<code>config_block.json</code>等）。你可以使用任何名字。但需要注意的是，除非你在每次配置更新结束时回过头来清除这些文件，否则在进行其他更新时必须用其他文件名来命名文件。（译者注：请每次更新时尽量使用不同的名字，最好在每次更新结束后备份并删除本次更新产生的 JSON 文件和 protobuf 文件，避免下次更新时产生混淆。可以考虑为文件添加具有明确含义的前缀，如：”add_xxx_org_”。）</p>
<h5 id="4-3-2-步骤-1：提取并转换配置"><a href="#4-3-2-步骤-1：提取并转换配置" class="headerlink" title="4.3.2 步骤 1：提取并转换配置"></a>4.3.2 步骤 1：提取并转换配置</h5><p>更新通道配置的第一步是获取最新的配置区块，这个过程包含三步。首先，我们要获取 protobuf 格式的通道配置并将其写入 <code>config_block.pb</code> 文件。</p>
<p>请确保以下命令是在 peer 容器中进行的。</p>
<p>现在执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config config_block.pb -o $ORDERER_CONTAINER -c $CH_NAME --tls --cafile $TLS_ROOT_CA</span><br></pre></td></tr></table></figure>

<p>接下来，我们要把上述命令得到的 protobuf 版本的通道配置转换为 JSON 版本，并将转换后的内容写入 <code>config_block.json</code> 文件（JSON 文件更易于人们阅读和理解）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input config_block.pb --type common.Block --output config_block.json</span><br></pre></td></tr></table></figure>

<p>最后，为了方便阅读，我们将从配置中排除所有不必要的元数据并重新写入一个新文件。你可以给该文件起任何名字，但在本例中，我们将其命名为 <code>config.json</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq .data.data[0].payload.data.config config_block.json &gt; config.json</span><br></pre></td></tr></table></figure>

<p>现在我们要 copy 一份 <code>config.json</code> 并将其命名为 <code>modified_config.json</code>。<strong>请不要直接编辑 <code>config.json</code></strong> 文件，因为我们将在后面的步骤中计算 <code>config.json</code> 和 <code>modified_config.json</code> 之间的差异。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp config.json modified_config.json</span><br></pre></td></tr></table></figure>

<h5 id="4-3-3-步骤-2：修改配置"><a href="#4-3-3-步骤-2：修改配置" class="headerlink" title="4.3.3 步骤 2：修改配置"></a>4.3.3 步骤 2：修改配置</h5><p>在这一步，你有两种可选的方式来修改配置。</p>
<ol>
<li>用文本编辑器打开 <code>modified_config.json</code> 并进行编辑。有些在线教程描述了如何从没有编辑器的容器中复制文件、编辑文件然后将其放回容器。</li>
<li>使用 <code>jq</code> 完成对配置的编辑。</li>
</ol>
<p>是手动编辑配置还是使用 <code>jq</code> 编辑配置取决于你的实际情况。由于 <code>jq</code> 使用简单而且能编写脚本（当对多个通道进行相同的配置更新时，编写脚本会是一个优势），因此在更新通道时我们推荐使用此种方式。有关如何使用 <code>jq</code> 的示例，请查看<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/updating_a_channel.html#Create-a-capabilities-config-file">更新通道功能</a>，里面展示了多个用 <code>jq</code> 操作 <code>capabilities.json</code> 功能配置文件的命令。如果你不想更新通道的功能，而是要更新其他内容，则必须对其中涉及 <code>jq</code> 命令和 JSON 文件进行相应的修改。</p>
<p>有关通道配置的内容和结构的更多信息，请查看上面的<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/config_update.html#Sample-channel-configuration">通道配置示例</a>。</p>
<h5 id="4-3-4-步骤-3：重新编码并提交配置"><a href="#4-3-4-步骤-3：重新编码并提交配置" class="headerlink" title="4.3.4 步骤 3：重新编码并提交配置"></a>4.3.4 步骤 3：重新编码并提交配置</h5><p>无论你是手动配置的还是使用向 <code>jq</code> 之类的工具进行配置的，除了计算旧配置和新配置之间的差异，你还必须运行与之前提取、确定配置范围相反的过程，然后将配置更新提交给通道上的其他管理员。</p>
<p>首先，我们将 <code>config.json</code> 文件恢复回protobuf格式并将恢复后的内容写入 <code>config.pb</code> 文件。接下来对 <code>modified_config.json</code> 文件执行相同的操作，然后计算两个文件之间的差异，并将差异写入 <code>config_update.pb</code> 文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input config.json --type common.Config --output config.pb</span><br><span class="line"></span><br><span class="line">configtxlator proto_encode --input modified_config.json --type common.Config --output modified_config.pb</span><br><span class="line"></span><br><span class="line">configtxlator compute_update --channel_id $CH_NAME --original config.pb --updated modified_config.pb --output config_update.pb</span><br></pre></td></tr></table></figure>

<p>既然我们已经计算出了旧配置和新配置之间的差异，那么我们现在可以将更新应用于配置中了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input config_update.pb --type common.ConfigUpdate --output config_update.json</span><br><span class="line"></span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;&#x27;$CH_NAME&#x27;&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; config_update_in_envelope.json</span><br><span class="line"></span><br><span class="line">configtxlator proto_encode --input config_update_in_envelope.json --type common.Envelope --output config_update_in_envelope.pb</span><br></pre></td></tr></table></figure>

<p>提交配置更新交易：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel update -f config_update_in_envelope.pb -c $CH_NAME -o $ORDERER_CONTAINER --tls --cafile $TLS_ROOT_CA</span><br></pre></td></tr></table></figure>

<p>我们的配置更新交易表示原始配置和修改后的配置之间的差异，但是排序服务会将其转换为完整的通道配置。</p>
<h4 id="4-4-获取必要的签名"><a href="#4-4-获取必要的签名" class="headerlink" title="4.4 获取必要的签名"></a>4.4 获取必要的签名</h4><p>无论你要修改的是什么内容，在生成新的 protobuf 配置文件后，protobuf 配置文件需要满足相关的策略才会被认为有效，通常（并非总是）需要其他组织的签名。</p>
<p><em>请注意：你可以根据你的应用程序编写收集签名的脚本。一般来说，你收集到的签名可能会比你需要的签名多。</em></p>
<p>获取这些签名的实际过程取决于你是如何设置系统的，不过主要有两种实现方式。Fabric 命令行目前默认使用 “pass it along” 方式。也就是说，提出配置更新的组织的管理员要将更新发送给需要签名的其他人（如另一个管理员）。这个管理员对接收到的配置更新进行签名（或不签名）并把它传递给下一个管理员，以此类推，直到有足够的签名可以提交配置为止。</p>
<p>这种方式的优点是简单——当有足够的签名时，最后一个管理员可以直接提交配置交易（在 Fabric 中，<code>peer channel update</code> 命令默认包含当前组织的签名）。但是这个过程只适用于较小的通道，因为 “pass it along” 方式可能会很耗时。</p>
<p>另一种方式是将更新提交给通道中每个管理员并等待他们返回足够的签名。这些签名会被集中在一起提交。这使创建配置更新的管理员的工作更加困难（他们必须处理每个签名者返回的文件），但对于正在开发 Fabric 管理应用程序的用户来说，这是推荐的工作流程。</p>
<p>配置被添加到账本后，最好将其提取并转换成 JSON 格式以确认所有内容均已被正确添加。确认过程中得到的文件也可以用作最新配置的副本。</p>
<h3 id="5-动态添加"><a href="#5-动态添加" class="headerlink" title="5. 动态添加"></a>5. 动态添加</h3><h4 id="5-1-动态添加组织到联盟"><a href="#5-1-动态添加组织到联盟" class="headerlink" title="5.1 动态添加组织到联盟"></a>5.1 动态添加组织到联盟</h4><h4 id="5-2-如何动态添加组织到通道"><a href="#5-2-如何动态添加组织到通道" class="headerlink" title="5.2 如何动态添加组织到通道"></a>5.2 如何动态添加组织到通道</h4><h4 id="5-3-如何动态添加Orderer到通道"><a href="#5-3-如何动态添加Orderer到通道" class="headerlink" title="5.3 如何动态添加Orderer到通道"></a>5.3 如何动态添加Orderer到通道</h4><h3 id="6-链码"><a href="#6-链码" class="headerlink" title="6. 链码"></a>6. 链码</h3><p>要求：安装链码需要哪些命令？这些命令的次序和其选项的含义是什么？需要什么环境变量？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">mkdir channel-artifacts</span><br><span class="line">FABRIC_CFG_PATH=$PWD/../config/</span><br><span class="line">CHANNEL_NAME=&quot;mychannel&quot;</span><br><span class="line">CC_NAME=&quot;basic&quot;</span><br><span class="line">CC_SRC_PATH=&quot;../asset-transfer-basic/chaincode-go&quot;</span><br><span class="line">CC_SRC_LANGUAGE=&quot;go&quot;</span><br><span class="line">CC_VERSION=&quot;1.0&quot;</span><br><span class="line">CC_SEQUENCE=1</span><br><span class="line">CC_END_POLICY=&quot;NA&quot;</span><br><span class="line">CC_COLL_CONFIG=&quot;NA&quot;</span><br><span class="line">CC_INIT_FCN=&quot;NA&quot;</span><br><span class="line">DELAY=3</span><br><span class="line">MAX_RETRY=5</span><br><span class="line">VERBOSE=false</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在包装之前对链码做一些语言特定的准备</span></span><br><span class="line">CC_RUNTIME_LANGUAGE=golang</span><br><span class="line">pushd $CC_SRC_PATH</span><br><span class="line">GO111MODULE=on go mod vendor</span><br><span class="line">popd</span><br><span class="line"></span><br><span class="line">INIT_REQUIRED=&quot;--init-required&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查是否应该调用init FCN</span></span><br><span class="line">if [ &quot;$CC_INIT_FCN&quot; = &quot;NA&quot; ]; then</span><br><span class="line">  INIT_REQUIRED=&quot;&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ &quot;$CC_END_POLICY&quot; = &quot;NA&quot; ]; then</span><br><span class="line">  CC_END_POLICY=&quot;&quot;</span><br><span class="line">else</span><br><span class="line">  CC_END_POLICY=&quot;--signature-policy $CC_END_POLICY&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ &quot;$CC_COLL_CONFIG&quot; = &quot;NA&quot; ]; then</span><br><span class="line">  CC_COLL_CONFIG=&quot;&quot;</span><br><span class="line">else</span><br><span class="line">  CC_COLL_CONFIG=&quot;--collections-config $CC_COLL_CONFIG&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="bash"> import utils</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> packageChaincode()</span></span><br><span class="line">set -x</span><br><span class="line">peer lifecycle chaincode package $&#123;CC_NAME&#125;.tar.gz --path $&#123;CC_SRC_PATH&#125; --lang $&#123;CC_RUNTIME_LANGUAGE&#125; --label $&#123;CC_NAME&#125;_$&#123;CC_VERSION&#125; &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br><span class="line"><span class="meta">#</span><span class="bash"> Install chaincode on peer0.org1 and peer0.org2</span></span><br><span class="line">ORG=1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> setGlobals <span class="variable">$ORG</span></span></span><br><span class="line">export PEER0_ORG1_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG1_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051  </span><br><span class="line">set -x</span><br><span class="line">peer lifecycle chaincode install $&#123;CC_NAME&#125;.tar.gz &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">ORG=2</span><br><span class="line"><span class="meta">#</span><span class="bash"> setGlobals <span class="variable">$ORG</span></span></span><br><span class="line">export PEER0_ORG2_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG2_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br><span class="line">set -x</span><br><span class="line">peer lifecycle chaincode install $&#123;CC_NAME&#125;.tar.gz &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> query whether the chaincode is installed</span></span><br><span class="line">ORG=1</span><br><span class="line">set -x</span><br><span class="line">peer lifecycle chaincode queryinstalled &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> approve the definition <span class="keyword">for</span> org1</span></span><br><span class="line">ORG=1</span><br><span class="line">export PEER0_ORG1_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG1_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051  </span><br><span class="line">set -x</span><br><span class="line">peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile &quot;$ORDERER_CA&quot; --channelID $CHANNEL_NAME --name $&#123;CC_NAME&#125; --version $&#123;CC_VERSION&#125; --package-id $&#123;PACKAGE_ID&#125; --sequence $&#123;CC_SEQUENCE&#125; $&#123;INIT_REQUIRED&#125; $&#123;CC_END_POLICY&#125; $&#123;CC_COLL_CONFIG&#125; &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># check whether the chaincode definition is ready to be committed</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># expect org1 to have approved and org2 not to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 检查chaincode定义是否已经准备好提交，期望它们都已经被批准</span></span></span><br><span class="line">checkCommitReadiness 1 &quot;\&quot;Org1MSP\&quot;: true&quot; &quot;\&quot;Org2MSP\&quot;: false&quot;</span><br><span class="line">checkCommitReadiness 2 &quot;\&quot;Org1MSP\&quot;: true&quot; &quot;\&quot;Org2MSP\&quot;: false&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># now approve also for org2</span></span></span><br><span class="line">ORG=2</span><br><span class="line">export PEER0_ORG2_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG2_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br><span class="line">set -x</span><br><span class="line">peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile &quot;$ORDERER_CA&quot; --channelID $CHANNEL_NAME --name $&#123;CC_NAME&#125; --version $&#123;CC_VERSION&#125; --package-id $&#123;PACKAGE_ID&#125; --sequence $&#123;CC_SEQUENCE&#125; $&#123;INIT_REQUIRED&#125; $&#123;CC_END_POLICY&#125; $&#123;CC_COLL_CONFIG&#125; &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># check whether the chaincode definition is ready to be committed</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># expect them both to have approved</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 检查chaincode定义是否已经准备好提交，期望它们都已经被批准</span></span></span><br><span class="line">checkCommitReadiness 1 &quot;\&quot;Org1MSP\&quot;: true&quot; &quot;\&quot;Org2MSP\&quot;: true&quot;</span><br><span class="line">checkCommitReadiness 2 &quot;\&quot;Org1MSP\&quot;: true&quot; &quot;\&quot;Org2MSP\&quot;: true&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># now that we know for sure both orgs have approved, commit the definition</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 现在我们确定两个组织都已经批准了，提交定义</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置链码操作的连接参数</span></span><br><span class="line">PEER_CONN_PARMS=()</span><br><span class="line">ORDERER_CA=/root/go/src/github.com/hyperledger/fabric/scripts/fabric-samples/test-network/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">CHANNEL_NAME=mychannel</span><br><span class="line">name=basic</span><br><span class="line">CC_VERSION=&quot;1.0&quot;</span><br><span class="line">CC_SEQUENCE=1</span><br><span class="line"></span><br><span class="line">export PEER0_ORG1_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG1_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051  </span><br><span class="line">PEER_CONN_PARMS=(&quot;$&#123;PEER_CONN_PARMS[@]&#125;&quot; --peerAddresses $CORE_PEER_ADDRESS)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Set path to TLS certificate</span></span></span><br><span class="line">CA=PEER0_ORG1_CA</span><br><span class="line">TLSINFO=(--tlsRootCertFiles &quot;$&#123;!CA&#125;&quot;)</span><br><span class="line">PEER_CONN_PARMS=(&quot;$&#123;PEER_CONN_PARMS[@]&#125;&quot; &quot;$&#123;TLSINFO[@]&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">export PEER0_ORG2_CA=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG2_CA</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br><span class="line">PEER_CONN_PARMS=(&quot;$&#123;PEER_CONN_PARMS[@]&#125;&quot; --peerAddresses $CORE_PEER_ADDRESS)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Set path to TLS certificate</span></span></span><br><span class="line">CA=PEER0_ORG2_CA</span><br><span class="line">TLSINFO=(--tlsRootCertFiles &quot;$&#123;!CA&#125;&quot;)</span><br><span class="line">PEER_CONN_PARMS=(&quot;$&#123;PEER_CONN_PARMS[@]&#125;&quot; &quot;$&#123;TLSINFO[@]&#125;&quot;)</span><br><span class="line"></span><br><span class="line">set -x</span><br><span class="line">peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile &quot;$ORDERER_CA&quot; --channelID $CHANNEL_NAME --name $&#123;CC_NAME&#125; &quot;$&#123;PEER_CONN_PARMS[@]&#125;&quot; --version $&#123;CC_VERSION&#125; --sequence $&#123;CC_SEQUENCE&#125; $&#123;INIT_REQUIRED&#125; $&#123;CC_END_POLICY&#125; $&#123;CC_COLL_CONFIG&#125; &gt;&amp;log.txt</span><br><span class="line">&#123; set +x; &#125; 2&gt;/dev/null</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># query on both orgs to see that the definition committed successfully</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">略</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Invoke the chaincode - this does require that the chaincode have the &#x27;initLedger&#x27; method defined</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 调用链代码——这需要链代码定义了“initLedger”方法</span></span></span><br><span class="line">if [ &quot;$CC_INIT_FCN&quot; = &quot;NA&quot; ]; then</span><br><span class="line">  infoln &quot;Chaincode initialization is not required&quot;</span><br><span class="line">else</span><br><span class="line">  chaincodeInvokeInit 1 2</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>




    </div>

    <div class="about">
        <h1>关于本文</h1>
        <p>本文作者 Berny Wang, 许可由 <a
                target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
    </div>

    
        
    
</article>
        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h4 class="title">Blog</h4>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/projects" class="item">Projects</a>
                
                <a href="/resume" class="item">Resume</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Projects</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/rsa-cli" class="item">RSA CLI</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/hexo-theme-cupertino" class="item">Hexo Theme Cupertino</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/a-calendar" class="item">A Calendar</a>
                
                <a target="_blank" rel="noopener" href="https://github.com/MrWillCom/auto-mirroring-bucket" class="item">Auto Mirroring Bucket</a>
                
            </div>
            
            <div class="group">
                <h4 class="title">Me</h4>
                
                <a target="_blank" rel="noopener" href="https://github.com/bernyw" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://codepen.io/bernyw" class="item">CodePen</a>
                
                <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/ber-16-41" class="item">Patreon</a>
                
                <a target="_blank" rel="noopener" href="https://noc.social/@bernyw" class="item">Mastodon</a>
                
                <a href="mailto:mr.bernyw@outlook.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2022 Berny Wang<br >驱动由 <a href="http://hexo.io/" target="_blank">Hexo</a></span>
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
    </body>
</html>